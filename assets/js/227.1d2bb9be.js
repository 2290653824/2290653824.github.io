(window.webpackJsonp=window.webpackJsonp||[]).push([[227],{550:function(t,_,a){"use strict";a.r(_);var s=a(4),v=Object(s.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h2",{attrs:{id:"_1-介绍"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-介绍"}},[t._v("#")]),t._v(" 1. 介绍")]),t._v(" "),_("p",[t._v("电脑通常都是通过 DHCP 动态获取 IP 地址，大大省去了配 IP 信息繁琐的过程。")]),t._v(" "),_("h2",{attrs:{id:"_2-电脑通过dhcp获取ip的四个步骤"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-电脑通过dhcp获取ip的四个步骤"}},[t._v("#")]),t._v(" 2. 电脑通过DHCP获取IP的四个步骤")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230404115924101.png",alt:"image-20230404115924101"}})]),t._v(" "),_("p",[_("strong",[t._v("DHCP 客户端进程监听的是 68 端口号，DHCP 服务端进程监听的是 67 端口号。")])]),t._v(" "),_("ul",[_("li",[t._v("客户端首先发起 "),_("strong",[t._v("DHCP 发现报文（DHCP DISCOVER）")]),t._v(" 的 IP 数据报，由于客户端没有 IP 地址，也不知道 DHCP 服务器的地址，所以使用的是 UDP "),_("strong",[t._v("广播")]),t._v("通信，其使用的广播目的地址是 255.255.255.255（端口 67） 并且使用 0.0.0.0（端口 68） 作为源 IP 地址。DHCP 客户端将该 IP 数据报传递给链路层，链路层然后将帧广播到所有的网络中设备。")]),t._v(" "),_("li",[t._v("DHCP 服务器收到 DHCP 发现报文时，用 "),_("strong",[t._v("DHCP 提供报文（DHCP OFFER）")]),t._v(" 向客户端做出响应。该报文仍然使用 IP 广播地址 255.255.255.255，该报文信息携带服务器提供可租约的 IP 地址、子网掩码、默认网关、DNS 服务器以及 "),_("strong",[t._v("IP 地址租用期")]),t._v("。")]),t._v(" "),_("li",[t._v("客户端收到一个或多个服务器的 DHCP 提供报文后，从中选择一个服务器，并向选中的服务器发送 "),_("strong",[t._v("DHCP 请求报文（DHCP REQUEST")]),t._v("进行响应，回显配置的参数。")]),t._v(" "),_("li",[t._v("最后，服务端用 "),_("strong",[t._v("DHCP ACK 报文")]),t._v("对 DHCP 请求报文进行响应，应答所要求的参数。")])]),t._v(" "),_("p",[t._v("一旦客户端收到 DHCP ACK 后，交互便完成了，并且客户端能够在租用期内使用 DHCP 服务器分配的 IP 地址。")]),t._v(" "),_("p",[t._v("如果租约的 DHCP IP 地址快期后，客户端会向服务器发送 DHCP 请求报文：")]),t._v(" "),_("ul",[_("li",[t._v("服务器如果同意继续租用，则用 DHCP ACK 报文进行应答，客户端就会延长租期。")]),t._v(" "),_("li",[t._v("服务器如果不同意继续租用，则用 DHCP NACK 报文，客户端就要停止使用租约的 IP 地址。")])]),t._v(" "),_("h2",{attrs:{id:"_3-特点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-特点"}},[t._v("#")]),t._v(" 3. 特点")]),t._v(" "),_("p",[t._v("DHCP 交互中，"),_("strong",[t._v("全程都是使用 UDP 广播通信")]),t._v("。")]),t._v(" "),_("p",[t._v("但是广播的话，只能在某个网段中进行传播，如果DHCP不在同一个网段该怎么办呢？")]),t._v(" "),_("p",[t._v("这个时候就会使用 "),_("strong",[t._v("DHCP 中继代理")])]),t._v(" "),_("h2",{attrs:{id:"_4-dhcp-中继代理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-dhcp-中继代理"}},[t._v("#")]),t._v(" 4. DHCP 中继代理")]),t._v(" "),_("p",[t._v("有了 DHCP 中继代理以后，"),_("strong",[t._v("对不同网段的 IP 地址分配也可以由一个 DHCP 服务器统一进行管理。")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230405233331613.png",alt:"image-20230405233331613"}})]),t._v(" "),_("ul",[_("li",[t._v("DHCP 客户端会向 DHCP 中继代理发送 DHCP 请求包，而 DHCP 中继代理在收到这个广播包以后，再以"),_("strong",[t._v("单播")]),t._v("的形式发给 DHCP 服务器。")]),t._v(" "),_("li",[t._v("服务器端收到该包以后再向 DHCP 中继代理返回应答，并由 DHCP 中继代理将此包广播给 DHCP 客户端 。")])]),t._v(" "),_("p",[t._v("因此，DHCP 服务器即使不在同一个链路上也可以实现统一分配和管理IP地址。")]),t._v(" "),_("h2",{attrs:{id:"_5-我们自己的电脑有设置相应的dhcp服务器吗-我们自己的电脑是怎么获取ip地址的"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-我们自己的电脑有设置相应的dhcp服务器吗-我们自己的电脑是怎么获取ip地址的"}},[t._v("#")]),t._v(" 5. 我们自己的电脑有设置相应的DHCP服务器吗？我们自己的电脑是怎么获取ip地址的")]),t._v(" "),_("p",[t._v("电脑不需要自己手动设置DHCP服务器，电脑会先通过DHCP DISCOVERY去当前网络内广播DHCP发现包，所以电脑会自动根据上面的协议去获取DHCP的服务器，并从DHCP那里去获取对应的数据。")]),t._v(" "),_("h2",{attrs:{id:"_6-家庭中的dhcp"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-家庭中的dhcp"}},[t._v("#")]),t._v(" 6. 家庭中的DHCP")]),t._v(" "),_("p",[t._v("其实我们连接的路由器就包含了DHCP服务，我们可以在路由器上配置相应的ip地址池、子网等，如图所示，是家用路由器的一个配置页面:")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923204343288.png",alt:"image-20230923204343288"}})]),t._v(" "),_("p",[t._v("参考："),_("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1443040",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cloud.tencent.com/developer/article/1443040"),_("OutboundLink")],1)]),t._v(" "),_("h2",{attrs:{id:"抓包实战"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#抓包实战"}},[t._v("#")]),t._v(" . 抓包实战")]),t._v(" "),_("p",[t._v("抓包需要明确的几个点：")]),t._v(" "),_("ol",[_("li",[t._v("在哪个网卡上抓包。")]),t._v(" "),_("li",[t._v("抓什么包？DHCP。")])]),t._v(" "),_("h3",{attrs:{id:"_1明确网卡"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1明确网卡"}},[t._v("#")]),t._v(" ①明确网卡")]),t._v(" "),_("p",[t._v("一般我们电脑连接wifi，会有一个专门的网卡")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923204923975.png",alt:"image-20230923204923975"}})]),t._v(" "),_("p",[t._v("网卡为en0")]),t._v(" "),_("h3",{attrs:{id:"_2抓包"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2抓包"}},[t._v("#")]),t._v(" ②抓包")]),t._v(" "),_("p",[t._v("方法一：使用wireshark监控")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923205724709.png",alt:"image-20230923205724709"}})]),t._v(" "),_("p",[t._v("方法二: 使用命令监控")]),t._v(" "),_("p",[_("code",[t._v("tcpdump -i en0 -w capture.pcap")])]),t._v(" "),_("h3",{attrs:{id:"_3释放dhcp-分配的ip"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3释放dhcp-分配的ip"}},[t._v("#")]),t._v(" ③释放DHCP 分配的ip")]),t._v(" "),_("p",[t._v("window:  "),_("code",[t._v("ifconfig /release")])]),t._v(" "),_("p",[t._v("linux: "),_("code",[t._v("sudo ipconfig set en0 DHCP")])]),t._v(" "),_("h3",{attrs:{id:"_4重新dhcp分配"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4重新dhcp分配"}},[t._v("#")]),t._v(" ④重新DHCP分配")]),t._v(" "),_("p",[t._v("window: "),_("code",[t._v("ifconfig /renew")])]),t._v(" "),_("p",[t._v("linux: "),_("code",[t._v("sudo ipconfig set en0 BOOTP")])]),t._v(" "),_("h3",{attrs:{id:"_5wireshark条件过滤"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5wireshark条件过滤"}},[t._v("#")]),t._v(" ⑤wireshark条件过滤")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923211556220.png",alt:"image-20230923211556220"}})]),t._v(" "),_("h3",{attrs:{id:"_6逐条分析"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6逐条分析"}},[t._v("#")]),t._v(" ⑥逐条分析")]),t._v(" "),_("ul",[_("li",[t._v("DHCP Discovery")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923212122952.png",alt:"image-20230923212122952"}})]),t._v(" "),_("p",[t._v("DHCP使用的是UDP协议，目标地址为广播地址，本地地址为"),_("code",[t._v("0.0.0.0")]),t._v("，向该网络内发送discovery包")]),t._v(" "),_("ul",[_("li",[t._v("DHCP offer")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923212617767.png",alt:"image-20230923212617767"}})]),t._v(" "),_("blockquote",[_("p",[t._v("注意上面的Dst应该为255.255.255.255 ，这里应该是网卡地址没有释放掉，或者做了优化")])]),t._v(" "),_("ul",[_("li",[t._v("DHCP request")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923213015159.png",alt:"image-20230923213015159"}})]),t._v(" "),_("ul",[_("li",[t._v("DHCP Ack")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230923213153253.png",alt:"image-20230923213153253"}})])])}),[],!1,null,null,null);_.default=v.exports}}]);