(window.webpackJsonp=window.webpackJsonp||[]).push([[356],{680:function(s,t,e){"use strict";e.r(t);var a=e(4),n=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"bug1-本地出现有老版本的k8s未卸载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bug1-本地出现有老版本的k8s未卸载"}},[s._v("#")]),s._v(" bug1 （本地出现有老版本的k8s未卸载）")]),s._v(" "),t("p",[s._v("按照文档编写后，通过命令"),t("code",[s._v("kubeadm init --config kubeadm.yaml")]),s._v("初始化集群,出现以下输出：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wait-control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelet to boot up the control plane as static Pods from directory "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" This can take up to 4m0s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Initial "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" of 40s passed.\n\nUnfortunately, an error has occurred:\n        timed out waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the condition\n\nThis error is likely caused by:\n        - The kubelet is not running\n        - The kubelet is unhealthy due to a misconfiguration of the "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" some way "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("required cgroups disabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nIf you are on a systemd-powered system, you can try to troubleshoot the error with the following commands:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'systemctl status kubelet'")]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'journalctl -xeu kubelet'")]),s._v("\n\nAdditionally, a control plane component may have crashed or exited when started by the container runtime.\nTo troubleshoot, list all containers using your preferred container runtimes CLI.\nHere is one example how you may list all running Kubernetes containers by using crictl:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crictl --runtime-endpoint unix:///run/containerd/containerd.sock ps -a | grep kube | grep -v pause'")]),s._v("\n        Once you have found the failing container, you can inspect its logs with:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs CONTAINERID'")]),s._v("\nerror execution phase wait-control-plane: couldn't initialize a Kubernetes cluster\nTo see the stack trace of this error execute with "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--v")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" or higher  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("从日志输出来看，首先抓住重点：")]),s._v(" "),t("p",[t("code",[s._v("The kubelet is not running")])]),s._v(" "),t("p",[s._v("``The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled)`")]),s._v(" "),t("p",[s._v("从这两句来看，我们的kubelet似乎并没有成功启动，让我们看看kubelet的状态？")]),s._v(" "),t("p",[t("code",[s._v("systemctl status kubelet")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@openstackTest-1:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kubelet.service")]),s._v("\n● kubelet.service - kubelet: The Kubernetes Node Agent\n     Loaded: loaded "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/lib/systemd/system/kubelet.service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: enabl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    Drop-In: /etc/systemd/system/kubelet.service.d\n             └─10-kubeadm.conf\n     Active: activating "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("auto-restart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Result: exit-code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Sat "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("-09-02 09:43:"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n       Docs: https://kubernetes.io/docs/home/\n    Process: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("206088")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/kubelet "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_KUBECONFIG_ARGS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KUBELET_CONFIG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n   Main PID: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("206088")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/FAILURE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("可以看出这里我们的kubelet服务一直处于自动重启的一个状态。那么如何查询到更加详细的日志？")]),s._v(" "),t("p",[t("code",[s._v("journalctl -xeu kubelet")])]),s._v(" "),t("p",[s._v("通过该命令，我们定位到以下的日志信息：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Sep 02 09:46:58 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 09:46:58.025261  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),s._v(" cri_stats_provider.go:448"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to get the info of the filesystem with mountpoint"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unable to >\nSep 02 09:46:58 openstackTest-1 kubelet[207581]: E0902 09:46:58.025389  207581 kubelet.go:1431] "')]),s._v("Image garbage collection failed once. Stats initialization may not have completed y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSep 02 09:46:58 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 09:46:58.025703  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),s._v(" server.go:462"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Adding debug handlers to kubelet server"')]),s._v("\nSep 02 09:46:58 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 09:46:58.026158  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),s._v(" fs_resource_analyzer.go:67"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting FS ResourceAnalyzer"')]),s._v("\nSep 02 09:46:58 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 09:46:58.026302  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),s._v(" volume_manager.go:291"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting Kubelet Volume Manager"')]),s._v("\nSep 02 09:46:58 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 09:46:58.026450  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("207581")]),s._v(" kubelet_node_status.go:458"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error getting the current node from lister"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('openstacktest-1\\>\nSep 02 09:46:58 openstackTest-1 kubelet[207581]: I0902 09:46:58.026545  207581 desired_state_of_world_populator.go:151] "')]),s._v("Desired state populator starts to run"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nSep 02 09:46:58 openstackTest-1 kubelet[207581]: I0902 09:46:58.026668  207581 reconciler_new.go:29] "')]),s._v("Reconciler: start to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" state"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nSep 02 09:46:58 openstackTest-1 kubelet[207581]: E0902 09:46:58.027099  207581 server.go:179] "')]),s._v("Failed to listen and serve"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" err="')]),s._v("listen tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10250: bind: address already "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" u"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSep 02 09:46:58 openstackTest-1 systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": kubelet.service: Main process exited, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("code")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/FAILURE\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("从上面的日志可以看出，我们的端口"),t("code",[s._v("10250")]),s._v("被占用。我们来看看是被什么占用了？")]),s._v(" "),t("p",[t("code",[s._v("lsof -i:10250")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("COMMAND     PID "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("   FD   TYPE   DEVICE SIZE/OFF NODE NAME\nkubelet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1095884")]),s._v(" root   18u  IPv6 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81413558")]),s._v("      0t0  TCP *:10250 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LISTEN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("震惊的发现，居然是自己占用了自己的端口？")]),s._v(" "),t("p",[s._v("我kill掉该进程后，过几秒后又会重启一个占用该端口。所以我这边直接使用apt把kubelet、kubectl、kubeadm删除掉。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" remove kubeadm kubectl kubelet\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("删除后，我再看端口是否被占用："),t("code",[s._v("lsof -i:10250")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("COMMAND     PID "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("   FD   TYPE   DEVICE SIZE/OFF NODE NAME\nkubelet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1092384")]),s._v(" root   18u  IPv6 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8144232")]),s._v("      0t0  TCP *:10250 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LISTEN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("依然被占用了，那么这就说明我的系统当中还存在其他的kubelet，老的kubelet一直占用端口，导致新的kubelet无法启动，所以我们的首要目标就是找到老的kubelet进行删除")]),s._v(" "),t("p",[s._v("法1：")]),s._v(" "),t("ol",[t("li",[s._v("使用"),t("code",[s._v("which kubelet")]),s._v("找到对应路径，例如"),t("code",[s._v("/path/to/your/kubectl")]),s._v("。")]),s._v(" "),t("li",[s._v("删除kubectl文件："),t("code",[s._v("sudo rm /path/to/your/kubectl")])]),s._v(" "),t("li",[s._v("确认删除：运行 "),t("code",[s._v("which kubectl")]),s._v(" 以确保 "),t("code",[s._v("kubectl")]),s._v(" 不再出现在路径中。它应该返回空，表示 "),t("code",[s._v("kubectl")]),s._v(" 不再可用。")])]),s._v(" "),t("p",[s._v("法2：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("snap list")]),s._v("检查列表")]),s._v(" "),t("li",[s._v("如果找到 kubelet，请使用 "),t("code",[s._v("snap remove kubelet")]),s._v(" 命令卸载它")]),s._v(" "),t("li",[s._v("重新检查端口："),t("code",[s._v("lsof -i :10250")])])]),s._v(" "),t("p",[s._v("通过以上方法后，成功删除老板本的kubelet等一系列组件")]),s._v(" "),t("blockquote",[t("p",[s._v("bug 1: 系统以前安装过k8s等组件，导致按照本教程进行时，老组件占用了端口，新组件无法顺利安装。")]),s._v(" "),t("p",[s._v("解决办法：定位需要分配的端口是被哪个老组件占用的，删除老组件即可")])]),s._v(" "),t("h2",{attrs:{id:"bug2-无法在公网上监听端口导致"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bug2-无法在公网上监听端口导致"}},[s._v("#")]),s._v(" bug2  （无法在公网上监听端口导致）")]),s._v(" "),t("p",[s._v("上面问题解决过后，我们通过以下命令重新启动我们的k8s集群初始化")]),s._v(" "),t("p",[t("code",[s._v("kubeadm reset")])]),s._v(" "),t("p",[t("code",[s._v("kubeadm init --config kubeadm.yaml")])]),s._v(" "),t("p",[s._v("依然还是出现下面的错误")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wait-control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelet to boot up the control plane as static Pods from directory "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" This can take up to 4m0s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Initial "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" of 40s passed.\n\nUnfortunately, an error has occurred:\n        timed out waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the condition\n\nThis error is likely caused by:\n        - The kubelet is not running\n        - The kubelet is unhealthy due to a misconfiguration of the "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" some way "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("required cgroups disabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nIf you are on a systemd-powered system, you can try to troubleshoot the error with the following commands:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'systemctl status kubelet'")]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'journalctl -xeu kubelet'")]),s._v("\n\nAdditionally, a control plane component may have crashed or exited when started by the container runtime.\nTo troubleshoot, list all containers using your preferred container runtimes CLI.\nHere is one example how you may list all running Kubernetes containers by using crictl:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crictl --runtime-endpoint unix:///run/containerd/containerd.sock ps -a | grep kube | grep -v pause'")]),s._v("\n        Once you have found the failing container, you can inspect its logs with:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs CONTAINERID'")]),s._v("\nerror execution phase wait-control-plane: couldn't initialize a Kubernetes cluster\nTo see the stack trace of this error execute with "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--v")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" or higher  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("我们继续去看看kubelet的日志：")]),s._v(" "),t("p",[t("code",[s._v("journalctl -xeu kubelet")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Sep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:04 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:04.557335  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" kubelet_node_status.go:70"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attempting to register node"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-1"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:04 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:04.558539  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" kubelet_node_status.go:92"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unable to register node with API server"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Post '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("https://122.228.207.18:6443/api/v1/nodes"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(': dial tcp 122.228.207.18:6443: connect: connection refused"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-1"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:05 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:05.521325  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" scope.go:117"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RemoveContainer"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("containerID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1eb15347bbb843aeb0b42368a673afa843da38c3ff382a6a7e1740c765433f8c"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:05 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:05.553499  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" controller.go:146"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to ensure lease exists, will retry"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Get '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("https://122.228.207.18:6443/apis/coordination.k8s.io/v1/namespaces/kube-node-lease/leases/openstacktest-1?timeout=10s"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(': dial tcp 122.228.207.18:6443: connect: connection refused"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("interval")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7s"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:06 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:06.628606  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" eviction_manager.go:258"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Eviction manager: failed to get summary stats"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to get node info: node '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("openstacktest-1"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(' not found"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:10 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:10.521039  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" scope.go:117"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RemoveContainer"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("containerID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0021271dbdddfa281641339a0b8537310e3fabd497ef82ecac15c6643dd86ad5"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:10 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:10.521952  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" pod_workers.go:1300"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error syncing pod, skipping"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("StartContainer"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" for "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("etcd"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" with CrashLoopBackOff: "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("back-off 1m20s restarting failed container=etcd pod=etcd-openstacktest-1_kube-system(6de64f3ef971e99f29e7ad6866a8fb9c)"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pod")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system/etcd-openstacktest-1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("podUID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6de64f3ef971e99f29e7ad6866a8fb9c"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:11 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:11.561894  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" kubelet_node_status.go:70"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attempting to register node"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-1"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:16 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:16.629284  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" eviction_manager.go:258"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Eviction manager: failed to get summary stats"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to get node info: node '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("openstacktest-1"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(' not found"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:17 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:17.278095  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" event.go:289"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Unable to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" event: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'&v1.Event{TypeMeta:v1.TypeMeta{Kind:"", APIVersion:""}, ObjectMeta:v1.ObjectMeta{Name:"openstacktest-1.1780fa204b118de6", GenerateName:"", Namespace:"default", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ManagedFields:[]v1.ManagedFieldsEntry(nil)}, InvolvedObject:v1.ObjectReference{Kind:"Node", Namespace:"", Name:"openstacktest-1", UID:"openstacktest-1", APIVersion:"", ResourceVersion:"", FieldPath:""}, Reason:"Starting", Message:"Starting kubelet.", Source:v1.EventSource{Component:"kubelet", Host:"openstacktest-1"}, FirstTimestamp:time.Date(2023, time.September, 2, 12, 21, 16, 496645606, time.Local), LastTimestamp:time.Date(2023, time.September, 2, 12, 21, 16, 496645606, time.Local), Count:1, Type:"Normal", EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:"", Related:(*v1.ObjectReference)(nil), ReportingController:"kubelet", ReportingInstance:"openstacktest-1"}\'')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Post \"https://122.228.207.18:6443/api/v1/namespaces/default/events\": net/http: TLS handshake timeout'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may retry after sleeping"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:21 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:21.563517  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" kubelet_node_status.go:92"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unable to register node with API server"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Post '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("https://122.228.207.18:6443/api/v1/nodes"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(': net/http: TLS handshake timeout"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-1"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:22 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:22.555826  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" controller.go:146"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Failed to ensure lease exists, will retry"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Get '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("https://122.228.207.18:6443/apis/coordination.k8s.io/v1/namespaces/kube-node-lease/leases/openstacktest-1?timeout=10s"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(': net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("interval")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7s"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:23 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:23.520280  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" scope.go:117"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RemoveContainer"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("containerID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0021271dbdddfa281641339a0b8537310e3fabd497ef82ecac15c6643dd86ad5"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:23 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:23.520743  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" pod_workers.go:1300"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error syncing pod, skipping"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("StartContainer"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" for "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("etcd"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" with CrashLoopBackOff: "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("back-off 1m20s restarting failed container=etcd pod=etcd-openstacktest-1_kube-system(6de64f3ef971e99f29e7ad6866a8fb9c)"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pod")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system/etcd-openstacktest-1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("podUID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6de64f3ef971e99f29e7ad6866a8fb9c"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26.432253  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" certificate_manager.go:562"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" kubernetes.io/kube-apiserver-client-kubelet: Failed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" requesting a signed certificate from the control plane: cannot create certificate signing request: Post "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.18:6443/apis/certificates.k8s.io/v1/certificatesigningrequests"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.10:47642-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18:6443: read: connection reset by peer\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26.629867  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" eviction_manager.go:258"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Eviction manager: failed to get summary stats"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to get node info: node '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("openstacktest-1"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(' not found"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26.957506  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" scope.go:117"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RemoveContainer"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("containerID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1eb15347bbb843aeb0b42368a673afa843da38c3ff382a6a7e1740c765433f8c"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26.960879  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" scope.go:117"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RemoveContainer"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("containerID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b9b93654494444eb242e8fc4e4d2c270b7791705987801a10b4345dac46c25c8"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:26.962111  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" pod_workers.go:1300"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error syncing pod, skipping"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("StartContainer"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" for "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("kube-apiserver"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" with CrashLoopBackOff: "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("back-off 40s restarting failed container=kube-apiserver pod=kube-apiserver-openstacktest-1_kube-system(8149da62ac5e89abb9a86a75fd1b8ca5)"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pod")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system/kube-apiserver-openstacktest-1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("podUID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8149da62ac5e89abb9a86a75fd1b8ca5"')]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:27 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:27.280012  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" event.go:289"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Unable to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" event: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'&v1.Event{TypeMeta:v1.TypeMeta{Kind:"", APIVersion:""}, ObjectMeta:v1.ObjectMeta{Name:"openstacktest-1.1780fa204b118de6", GenerateName:"", Namespace:"default", SelfLink:"", UID:"", ResourceVersion:"", Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:<nil>, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ManagedFields:[]v1.ManagedFieldsEntry(nil)}, InvolvedObject:v1.ObjectReference{Kind:"Node", Namespace:"", Name:"openstacktest-1", UID:"openstacktest-1", APIVersion:"", ResourceVersion:"", FieldPath:""}, Reason:"Starting", Message:"Starting kubelet.", Source:v1.EventSource{Component:"kubelet", Host:"openstacktest-1"}, FirstTimestamp:time.Date(2023, time.September, 2, 12, 21, 16, 496645606, time.Local), LastTimestamp:time.Date(2023, time.September, 2, 12, 21, 16, 496645606, time.Local), Count:1, Type:"Normal", EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:"", Related:(*v1.ObjectReference)(nil), ReportingController:"kubelet", ReportingInstance:"openstacktest-1"}\'')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Post \"https://122.228.207.18:6443/api/v1/namespaces/default/events\": dial tcp 122.228.207.18:6443: connect: connection refused'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may retry after sleeping"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:27 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": W0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:27.435942  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" reflector.go:535"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" vendor/k8s.io/client-go/informers/factory.go:150: failed to list *v1.Service: Get "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.18:6443/api/v1/services?limit=500&resourceVersion=0"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" dial tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18:6443: connect: connection refused - error from a previous attempt: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.10:47696-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18:6443: read: connection reset by peer\nSep 02 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:27 openstackTest-1 kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": E0902 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":23:27.436093  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("242796")]),s._v(" reflector.go:147"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" vendor/k8s.io/client-go/informers/factory.go:150: Failed to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" *v1.Service: failed to list *v1.Service: Get "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.18:6443/api/v1/services?limit=500&resourceVersion=0"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" dial tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18:6443: connect: connection refused - error from a previous attempt: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.10:47696-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18:6443: read: connection reset by peer\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("定位：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unable to register node with API server"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Post '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("https://122.228.207.18:6443/api/v1/nodes"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(': net/http: TLS handshake timeout"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-1"')]),s._v("\n………………\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("从所有的情况来看似乎是6443打不通？难道是防火墙或者对应的安全组没有打开？")]),s._v(" "),t("blockquote",[t("p",[s._v("需要打开对应的端口，物理机设置相关的防火墙，如果是云虚拟机就去对应的供应商打开安全组。打开哪些端口？"),t("a",{attrs:{href:"https://kubernetes.io/docs/reference/ports-and-protocols/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ports and Protocols"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("打开后，还是出现这个错误………………")]),s._v(" "),t("p",[s._v("我们需要一种方法验证这个端口到底通不通。可以使用nc命令。我们重启kubeadm初始化。")]),s._v(" "),t("p",[t("code",[s._v("kubeadm reset")])]),s._v(" "),t("p",[t("code",[s._v("kubeadm init --config kubeadm.yaml")])]),s._v(" "),t("p",[s._v("并在一台主机上调用命令"),t("code",[s._v("nc -vz 122.228.207.18 6443")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("zhengjian@zhengjiandeMacBook-Pro ~/Desktop"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vz")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nConnection to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18 port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("tcp/sun-sr-https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" succeeded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("表示端口开放是成功的，而且确实有应用在监听这个端口。那为什么在日志中调不通这个端口？")]),s._v(" "),t("p",[s._v("隔了几秒钟后我又试试了这个nc命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("zhengjian@zhengjiandeMacBook-Pro ~/Desktop"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vz")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nnc: connectx to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.18 port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tcp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" failed: Connection refused\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("突然，调不通了。这是为什么呢？")]),s._v(" "),t("p",[s._v("可能是监听这个端口的应用启动后又失败了。")]),s._v(" "),t("p",[s._v("那么监听这个端口的到底是什么应用呢？")]),s._v(" "),t("p",[s._v("看官网："),t("a",{attrs:{href:"https://kubernetes.io/docs/reference/ports-and-protocols/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ports and Protocols"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902193904899.png",alt:"image-20230902193904899"}})]),s._v(" "),t("p",[s._v("在k8s中， apiserver是核心组件，如果api-server都启动不了，其他应用是绝对无法使用的。")]),s._v(" "),t("p",[s._v("那么现在我们目标就清晰了："),t("strong",[s._v("定位api-server不能启动的原因")])]),s._v(" "),t("p",[s._v("api-server是由我们的containerd来加载的。我们可以使用相关的api来查看【crictl（Container Runtime Interface Command Line Tool）】")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 查看containerd中容器的运行情况")]),s._v("\ncrictl --runtime-endpoint unix:///run/containerd/containerd.sock "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902194355968.png",alt:"image-20230902194355968"}})]),s._v(" "),t("p",[s._v("看来，我们的api-server确实失败了，我们需要看看api-server失败的原因。使用以下命令：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 查看某个容器具体的启动日志")]),s._v("\ncrictl --runtime-endpoint unix:///run/containerd/containerd.sock logs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("CONTAINERID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs 37439dd94e48e")])]),s._v(" "),t("p",[s._v("结果如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@openstackTest-2:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs ca73661747c3f")]),s._v("\nI0902 06:56:45.402383       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" options.go:220"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" external "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" was not specified, using "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v(".207.7\nI0902 06:56:45.404381       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server.go:148"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Version: v1.28.1\nI0902 06:56:45.404461       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server.go:150"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Golang settings"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOGC")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOMAXPROCS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOTRACEBACK")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\nI0902 06:56:45.733856       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" shared_informer.go:311"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" caches to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" node_authorizer\nI0902 06:56:45.749543       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" plugins.go:158"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Loaded "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" mutating admission controller"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,RuntimeClass,DefaultIngressClass,MutatingAdmissionWebhook.\nI0902 06:56:45.749585       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" plugins.go:161"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Loaded "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" validating admission controller"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" successfully "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the following order: LimitRanger,ServiceAccount,PodSecurity,Priority,PersistentVolumeClaimResize,RuntimeClass,CertificateApproval,CertificateSigning,ClusterTrustBundleAttest,CertificateSubjectRestriction,ValidatingAdmissionPolicy,ValidatingAdmissionWebhook,ResourceQuota.\nI0902 06:56:45.749995       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" instance.go:298"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using reconciler: lease\nW0902 06:56:45.752333       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logging.go:59"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Channel "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 SubChannel #2] grpc: addrConn.createTransport failed to connect to {")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Addr"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2379"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ServerName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attributes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BalancerAttributes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Metadata"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(". Err: connection error: desc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transport: Error while dialing: dial tcp 127.0.0.1:2379: connect: connection refused"')]),s._v("\nW0902 06:56:46.744804       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logging.go:59"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Channel "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3 SubChannel #5] grpc: addrConn.createTransport failed to connect to {")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Addr"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2379"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ServerName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attributes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BalancerAttributes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Metadata"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(". Err: connection error: desc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transport: Error while dialing: dial tcp 127.0.0.1:2379: connect: connection refused"')]),s._v("\nW0902 06:56:46.745307       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logging.go:59"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\n……………………………………\n……………………………………\n\nF0902 06:57:05.752085       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" instance.go:291"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Error creating leases: error creating storage factory: context deadline exceeded\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("定位关键点：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("W0902 06:56:45.752333       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logging.go:59"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Channel "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 SubChannel #2] grpc: addrConn.createTransport failed to connect to {")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Addr"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2379"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ServerName"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attributes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BalancerAttributes"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Metadata"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(". Err: connection error: desc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transport: Error while dialing: dial tcp 127.0.0.1:2379: connect: connection refused"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("看来是监听2379相关的端口服务可能没有启动成功？是什么服务？看文档！")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902194850538.png",alt:"image-20230902194850538"}})]),s._v(" "),t("p",[s._v("这是etcd的端口，看来etcd也没有启动成功：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902194951517.png",alt:"image-20230902194951517"}})]),s._v(" "),t("p",[s._v("那么我们再去etcd日志去看看")]),s._v(" "),t("p",[t("code",[s._v("crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs 37439dd94e48e")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@openstackTest-2:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs 37439dd94e48e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.293956Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embed/config.go:673"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running http and grpc server on single port. This is not recommended for production."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294183Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdmain/etcd.go:73"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running: "')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"args"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--advertise-client-urls=https://122.228.207.7:2379"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cert-file=/etc/kubernetes/pki/etcd/server.crt"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--client-cert-auth=true"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--data-dir=/var/lib/etcd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--experimental-initial-corrupt-check=true"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--experimental-watch-progress-notify-interval=5s"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--initial-advertise-peer-urls=https://122.228.207.7:2380"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--initial-cluster=openstacktest-2=https://122.228.207.7:2380"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--key-file=/etc/kubernetes/pki/etcd/server.key"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--listen-client-urls=https://127.0.0.1:2379,https://122.228.207.7:2379"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--listen-metrics-urls=http://127.0.0.1:2381"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--listen-peer-urls=https://122.228.207.7:2380"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--name=openstacktest-2"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--peer-client-cert-auth=true"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--peer-key-file=/etc/kubernetes/pki/etcd/peer.key"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--snapshot-count=10000"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294331Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embed/config.go:673"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running http and grpc server on single port. This is not recommended for production."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294354Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embed/etcd.go:127"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"configuring peer listeners"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"listen-peer-urls"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.7:2380"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.29444Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embed/etcd.go:495"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"starting with peer TLS"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tls-info"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cert = /etc/kubernetes/pki/etcd/peer.crt, key = /etc/kubernetes/pki/etcd/peer.key, client-cert=, client-key=, trusted-ca = /etc/kubernetes/pki/etcd/ca.crt, client-cert-auth = true, crl-file = "')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cipher-suites"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294684Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embed/etcd.go:376"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"closing etcd server"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-2"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data-dir"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"advertise-peer-urls"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.7:2380"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"advertise-client-urls"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.7:2379"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294705Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"embed/etcd.go:378"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"closed etcd server"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openstacktest-2"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data-dir"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"advertise-peer-urls"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.7:2380"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"advertise-client-urls"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://122.228.207.7:2379"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warn"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294721Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdmain/etcd.go:146"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed to start etcd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"listen tcp 122.228.207.7:2380: bind: cannot assign requested address"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fatal"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-02T06:58:02.294752Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"caller"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdmain/etcd.go:204"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery failed"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"listen tcp 122.228.207.7:2380: bind: cannot assign requested address"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stacktrace"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go.etcd.io/etcd/server/v3/etcdmain.startEtcdOrProxyV2'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("go.etcd.io/etcd/server/v3/etcdmain/etcd.go:204"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("go.etcd.io/etcd/server/v3/etcdmain.Main"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("go.etcd.io/etcd/server/v3/etcdmain/main.go:40"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("main.main"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("go.etcd.io/etcd/server/v3/main.go:31"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("runtime.main"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v('runtime/proc.go:250"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("关键点：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("error"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":"')]),s._v("listen tcp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.228")]),s._v('.207.18:2380: bind: cannot assign requested address"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这个错误表明 "),t("code",[s._v("etcd")]),s._v(" 试图监听 IP 地址 "),t("code",[s._v("122.228.207.18")]),s._v(" 的端口 "),t("code",[s._v("2380")]),s._v("，但无法分配请求的地址。这通常是因为配置中指定的 IP 地址与节点实际的 IP 地址不匹配或不可用。")]),s._v(" "),t("p",[s._v("这就很奇怪了，监听不了端口，我们看看这个端口有被占用吗？")]),s._v(" "),t("p",[t("code",[s._v("lsof -i:2380")])]),s._v(" "),t("p",[s._v("结果别没有被占用，那是什么原因呢？我开始google找答案：")]),s._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://github.com/kubernetes/kubernetes/issues/5128",target:"_blank",rel:"noopener noreferrer"}},[s._v("etcd: listen tcp XX.XX.XX.XX:2380: bind: cannot assign requested address"),t("OutboundLink")],1)])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902200122159.png",alt:"image-20230902200122159"}})]),s._v(" "),t("blockquote",[t("p",[s._v("ifconfig lo up 是什么意思")]),s._v(" "),t("p",[t("code",[s._v("ifconfig")]),s._v(" 命令用于配置和显示网络接口的信息，"),t("code",[s._v("lo")]),s._v(" 是本地回环接口的名称。"),t("code",[s._v("ifconfig lo up")]),s._v(" 的意思是将本地回环接口 ("),t("code",[s._v("lo")]),s._v(") 启用或激活。本地回环接口是一个特殊的网络接口，通常用于本地主机内部的网络通信和自我测试，它对应于 IP 地址 "),t("code",[s._v("127.0.0.1")]),s._v("，也被称为 "),t("code",[s._v("localhost")]),s._v("。")]),s._v(" "),t("p",[s._v("通过运行 "),t("code",[s._v("ifconfig lo up")]),s._v("，你启用了本地回环接口，允许主机内的进程通过 "),t("code",[s._v("127.0.0.1")]),s._v(" 来进行本地通信。这对于许多网络应用程序和服务非常重要，因为它们可以通过本地回环接口与自身或其他在同一主机上运行的服务进行通信，而不需要通过物理网络适配器。")]),s._v(" "),t("p",[s._v("要注意的是，大多数现代 Linux 系统已经自动启用了本地回环接口，因此通常不需要手动运行 "),t("code",[s._v("ifconfig lo up")]),s._v("。")])]),s._v(" "),t("p",[s._v("上面来看是127.0.0.1的网络接口没开，导致端口打开失败吗？那我也会不会是122.228.207.18 对应的网络接口没开？")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("a",{attrs:{href:"https://discuss.kubernetes.io/t/etcd-fails-to-bind-address-vagrant-setup-kubernetes-with-ansible/17511",target:"_blank",rel:"noopener noreferrer"}},[s._v("Etcd Fails to Bind address: Vagrant setup Kubernetes with ansible"),t("OutboundLink")],1)])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902200707636.png",alt:"image-20230902200707636"}})]),s._v(" "),t("p",[s._v("看到这儿展示了网络的相关信息，更加坚定我去使用"),t("code",[s._v("ifconfig")]),s._v("看看")]),s._v(" "),t("p",[s._v("一看大吃一惊")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902200915405.png",alt:"image-20230902200915405"}})]),s._v(" "),t("p",[s._v("相应的122.228.207.18的信息居然没有，只有一个云服务器的私有地址")]),s._v(" "),t("blockquote",[t("p",[s._v("我在云厂商买了个云服务器，有公网ip和私网ip。但是当我用ssh登录到主机，用ifconfig时，相关的内容只有私网ip，没有公网ip，这是怎么回事?")]),s._v(" "),t("ul",[t("li",[s._v("chatGpt:")])]),s._v(" "),t("p",[s._v("如果你在云服务器上使用 "),t("code",[s._v("ifconfig")]),s._v(" 命令时只看到私网 IP 而没有看到公网 IP，这可能是因为云服务器默认情况下可能不会在 "),t("code",[s._v("ifconfig")]),s._v(" 的输出中显示公网 IP 地址。公网 IP 地址通常与外部网络接口关联，而 "),t("code",[s._v("ifconfig")]),s._v(" 通常只显示主机的网络接口信息。")]),s._v(" "),t("p",[s._v("你可以尝试使用其他命令来查看公网 IP 地址，例如 "),t("code",[s._v("curl ifconfig.me")]),s._v(" 或 "),t("code",[s._v("curl ipinfo.io")]),s._v("。这些命令将向外部服务器发出请求，以获取你的公网 IP 地址。另外，你还可以查看网络配置文件，通常在 "),t("code",[s._v("/etc/network/interfaces")]),s._v(" 或 "),t("code",[s._v("/etc/sysconfig/network-scripts/")]),s._v("，以查看服务器的网络配置，其中可能包含有关公网 IP 地址的信息。")]),s._v(" "),t("p",[s._v("如果你使用的是特定云服务提供商的云服务器，还可以查看他们的管理控制台或控制面板，通常可以在那里找到有关服务器的详细信息，包括公网 IP 地址。")]),s._v(" "),t("p",[s._v("请注意，公网 IP 地址通常用于与互联网通信，而私网 IP 地址通常用于与其他云服务器或资源在同一云服务提供商内部进行通信。因此，私网 IP 地址在服务器内部通信和云内部流量方面更常见，而公网 IP 地址则用于对外通信。")])]),s._v(" "),t("p",[s._v("那我直接把kubeadm.yaml中的地址改为这个私有地址吧")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230902201255964.png",alt:"image-20230902201255964"}})]),s._v(" "),t("p",[t("code",[s._v("kubeadm reset")])]),s._v(" "),t("p",[t("code",[s._v("kubeadm init --config kubeadm.yaml")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@openstackTest-2:~/k8s2"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/bin/kubeadm init --config kubeadm.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using Kubernetes version: v1.28.1\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running pre-flight checks\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Pulling images required "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" setting up a Kubernetes cluster\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" This might take a minute or two, depending on the speed of your internet connection\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" You can also perform this action "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" beforehand using "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubeadm config images pull'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using certificateDir folder "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/pki"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ca"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" apiserver serving cert is signed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local openstacktest-2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver-kubelet-client"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front-proxy-ca"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front-proxy-client"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/ca"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/server"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" etcd/server serving cert is signed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost openstacktest-2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.7 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 ::1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/peer"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" etcd/peer serving cert is signed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" DNS names "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost openstacktest-2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" and IPs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.7 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 ::1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd/healthcheck-client"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apiserver-etcd-client"')]),s._v(" certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sa"')]),s._v(" key and public key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using kubeconfig folder "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin.conf"')]),s._v(" kubeconfig "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet.conf"')]),s._v(" kubeconfig "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"controller-manager.conf"')]),s._v(" kubeconfig "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubeconfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scheduler.conf"')]),s._v(" kubeconfig "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" etcd "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using manifest folder "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-apiserver"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-controller-manager"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating static Pod manifest "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-scheduler"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing kubelet environment "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" with flags to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/kubelet/kubeadm-flags.env"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Writing kubelet configuration to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/kubelet/config.yaml"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting the kubelet\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wait-control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelet to boot up the control plane as static Pods from directory "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/manifests"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" This can take up to 4m0s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apiclient"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All control plane components are healthy after "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.005107")]),s._v(" seconds\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Storing the configuration used "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" ConfigMap "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubeadm-config"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-system"')]),s._v(" Namespace\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating a ConfigMap "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubelet-config"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" namespace kube-system with the configuration "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the kubelets "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the cluster\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("upload-certs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Skipping phase. Please see --upload-certs\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mark-control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Marking the "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" openstacktest-2 as control-plane by adding the labels: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mark-control-plane"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Marking the "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" openstacktest-2 as control-plane by adding the taints "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node-role.kubernetes.io/master:PreferNoSchedule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using token: gkklvh.z9it9ichjnqukpw2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configured RBAC rules to allow Node Bootstrap tokens to post CSRs "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" order "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" nodes to get long term certificate credentials\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Configured RBAC rules to allow certificate rotation "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" all "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" client certificates "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the cluster\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bootstrap-token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Creating the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster-info"')]),s._v(" ConfigMap "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-public"')]),s._v(" namespace\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubelet-finalize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Updating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/kubernetes/kubelet.conf"')]),s._v(" to point to a rotatable kubelet client certificate and key\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon: CoreDNS\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n\nAlternatively, "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you are the root user, you can run:\n\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBECONFIG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubectl apply -f [podnetwork].yaml"')]),s._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.7:6443 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" gkklvh.z9it9ichjnqukpw2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --discovery-token-ca-cert-hash sha256:1b50f115c95b80f1f169d5addadb3fa36562e4e9b0fead1f592a77977e3832dc \nroot@openstackTest-2:~/k8s2"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br")])]),t("p",[s._v("顺利初始化。")]),s._v(" "),t("p",[s._v("https://www.gbase8.cn/12320")])])}),[],!1,null,null,null);t.default=n.exports}}]);