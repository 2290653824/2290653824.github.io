(window.webpackJsonp=window.webpackJsonp||[]).push([[351],{675:function(s,a,n){"use strict";n.r(a);var t=n(4),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904093356552.png",alt:"image-20230904093356552"}})]),s._v(" "),a("h2",{attrs:{id:"配置管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置管理"}},[s._v("#")]),s._v(" 配置管理")]),s._v(" "),a("h3",{attrs:{id:"configmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configmap"}},[s._v("#")]),s._v(" ConfigMap")]),s._v(" "),a("h4",{attrs:{id:"创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[s._v("#")]),s._v(" 创建")]),s._v(" "),a("p",[s._v("例如我们先创建一个配置文件db.properties")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Redis.properties")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("将上面的两个文件放到同一个test/中")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1:~/yamlPackage/configMap/test"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nmysql.properties  redis.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("kubectl create configmap <configname> --from-file=<dirpath>")]),s._v(" 基于文件夹进行创建")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1:~/yamlPackage/configMap"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create cm mytestconfig --from-file=test/")]),s._v("\nconfigmap/mytestconfig created\nroot@openstackTest-1:~/yamlPackage/configMap"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get cm")]),s._v("\nNAME               DATA   AGE\nkube-root-ca.crt   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      37h\nmytestconfig       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      5s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("查看详细信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1:~/yamlPackage/configMap"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe cm mytestconfig")]),s._v("\nName:         mytestconfig\nNamespace:    default\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nredis.properties:\n----\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n\nmysql.properties:\n----\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n\n\nBinaryData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\nEvents:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("从上面可以看到我们具体设置的信息，通过文件夹的方式，将某个文件夹下面所有的文件的写进了配置")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("kubectl create cm <cnname> --from-file=key1=filepath --from-file=key2=filepath")]),s._v("基于文件进行创建【key如果不指定，默认使用文件的名字】")])]),s._v(" "),a("p",[s._v("我们创建一个配置文件application.yaml")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("spring:\n\tapplication:\n\t  name: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nserver:\n\tport: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1:~/yamlPackage/configMap"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create cm spring-yaml --from-file=application.yaml=test/spring.yaml")]),s._v("\nconfigmap/spring-yaml created\nroot@openstackTest-1:~/yamlPackage/configMap"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get cm")]),s._v("\nNAME               DATA   AGE\nkube-root-ca.crt   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      37h\nmytestconfig       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      12m\nspring-yaml        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      6s\nroot@openstackTest-1:~/yamlPackage/configMap"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe cm spring-yaml")]),s._v("\nName:         spring-yaml\nNamespace:    default\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\napplication.yaml:\n----\nspring:\n  application:\n    name: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nserver:\n  port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\n\nBinaryData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\nEvents:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("kubectl create cm <cmname> --from-literal=key1=config1 --from-literal=key2=config2")])])]),s._v(" "),a("p",[s._v("当参数比较少时，可以用这个方法")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1:~/k8s1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create cm keyvalueconfig --from-literal=key1=value1 --from-literal=key2=value2")]),s._v("\nconfigmap/keyvalueconfig created\nroot@openstackTest-1:~/k8s1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get cm keyvalueconfig")]),s._v("\nNAME             DATA   AGE\nkeyvalueconfig   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      14s\nroot@openstackTest-1:~/k8s1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe cm keyvalueconfig")]),s._v("\nName:         keyvalueconfig\nNamespace:    default\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nkey2:\n----\nvalue2\nkey1:\n----\nvalue1\n\nBinaryData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\nEvents:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h4",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("p",[s._v("首先我们先创建一个我们想要使用的配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl create cm test-env-config --from-literal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("JAVA_OPTS_TEST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-Xms512m -Xmx512m'")]),s._v(" --from-literal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("APP_NAEM"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("springboot-test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1:~/k8s1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create cm test-env-config --from-literal=JAVA_OPTS_TEST='-Xms512m -Xmx512m' --from-literal=APP_NAEM=springboot-test")]),s._v("\nconfigmap/test-env-config created\nroot@openstackTest-1:~/k8s1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe cm test-env-config")]),s._v("\nName:         test-env-config\nNamespace:    default\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nAPP_NAEM:\n----\nspringboot-test\nJAVA_OPTS_TEST:\n----\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms512m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx512m")]),s._v("\n\nBinaryData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\nEvents:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("实现在容器中打印出对应的配置")]),s._v(" "),a("ul",[a("li",[s._v("创建我们对应的一个容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restartPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Never\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alpine\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env;sleep 3600"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" JAVA_VM_OPTS\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMapKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" JAVA_OPTS_TEST\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" APP\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configMapKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" APP_NAME\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("我们使用命令查看容器的日志：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("root@openstackTest-1 ~/y/pod"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs -f test-env-pod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://10.96.0.1:443\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_SERVICE_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOSTNAME")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test-env-pod\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SHLVL")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_PORT_80_TCP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://10.98.194.204:80\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_VM_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-Xms512m "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx512m")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("APP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("springboot-test\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_PORT_443_TCP_ADDR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_SERVICE_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".194.204\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_PORT_443_TCP_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_PORT_443_TCP_PROTO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_SERVICE_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://10.98.194.204:80\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_SERVICE_PORT_HTTPS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_PORT_443_TCP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://10.96.0.1:443\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_SERVICE_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PWD")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_PORT_80_TCP_ADDR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".194.204\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_PORT_80_TCP_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGINX_SERVICE_PORT_80_TCP_PROTO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("可以看到这个容器确实拿到了我们的对应的数据了。")]),s._v(" "),a("p",[s._v("另一种配置的方式,通过挂载的方式将某个配置文件加载到容器中")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-env-pod\nspec:\n  restartPolicy: Never\n  containers:\n    - name: env-test\n      image: alpine\n      command: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env;sleep 3600"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      imagePullPolicy: IfNotPresent\n      env:\n      - name: JAVA_VM_OPTS\n        valueFrom:\n          configMapKeyRef:\n            name: test-env-config\n            key: JAVA_OPTS_TEST\n      - name: APP\n        valueFrom:\n          configMapKeyRef:\n            name: test-env-config\n            key: APP_NAME\n\t\t\tvolumeMounts:\n\t\t\t- name: db-config\n\t\t\t  mountPath: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/mysql/conf"')]),s._v("\n\t\t\t  readOnly: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\tvolumes: \n\t  - name: db-config\n\t    configMap:\n\t      name: test-dir-config\n\t      items:\n\t      - key: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db.properties"')]),s._v("\n\t        path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db.properties"')]),s._v("\n\trestartPolicy: Never\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("blockquote",[a("ol",[a("li",[a("p",[a("code",[s._v("metadata")]),s._v(": 这是用于定义 Pod 元数据的部分。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("name: test-env-pod")]),s._v(": 这里定义了 Pod 的名称。")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("spec")]),s._v(": 这是用于定义 Pod 规范的部分。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("restartPolicy: Never")]),s._v(': 这表示 Pod 的重启策略是 "Never"，即不会自动重启。一旦容器退出，它将永远保持在非运行状态。')])]),s._v(" "),a("li",[a("p",[a("code",[s._v("containers")]),s._v(": 这是一个容器列表，这里定义了一个容器。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("name: env-test")]),s._v(': 容器的名称是 "env-test"。')]),s._v(" "),a("li",[a("code",[s._v("image: alpine")]),s._v(": 使用 Alpine Linux 镜像作为容器的基础镜像。")]),s._v(" "),a("li",[a("code",[s._v("command")]),s._v(": 定义容器启动时执行的命令。在这里，容器将打印环境变量 ("),a("code",[s._v("env")]),s._v(") 的内容，并然后休眠 3600 秒。")]),s._v(" "),a("li",[a("code",[s._v("imagePullPolicy: IfNotPresent")]),s._v(": 这表示如果本地没有这个容器镜像，才从远程仓库拉取，否则使用本地镜像。")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("env")]),s._v(": 这里定义了容器的环境变量。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("name: JAVA_VM_OPTS")]),s._v(': 环境变量的名称是 "JAVA_VM_OPTS"。')])]),s._v(" "),a("li",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("valueFrom\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v(": 这表示环境变量的值来自于其他资源。")]),s._v(" "),a("ul",[a("li",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("configMapKeyRef\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v(": 环境变量的值是从 ConfigMap 中获取的。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("name: test-env-config")]),s._v(": 这是 ConfigMap 的名称。")]),s._v(" "),a("li",[a("code",[s._v("key: JAVA_OPTS_TEST")]),s._v(': 这是 ConfigMap 中的键，它的值将赋给 "JAVA_VM_OPTS" 变量。')])])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("name: APP")]),s._v(': 另一个环境变量的名称是 "APP"。')])]),s._v(" "),a("li",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("valueFrom\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v(": 同样，这个环境变量的值也来自于 ConfigMap。")]),s._v(" "),a("ul",[a("li",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("configMapKeyRef\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v(": 它引用了同一个 ConfigMap，但使用了不同的键。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("name: test-env-config")]),s._v(": 这是相同的 ConfigMap。")]),s._v(" "),a("li",[a("code",[s._v("key: APP_NAME")]),s._v(': 这是不同的键，其值将赋给 "APP" 变量。')])])])])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("volumes")]),s._v(": 这是一个用于定义卷的部分，这里定义了一个卷。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("name: db-config")]),s._v(': 卷的名称是 "db-config"。')])]),s._v(" "),a("li",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("configMap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v(": 这表示这个卷是一个 ConfigMap 类型的卷。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("name: test-dir-config")]),s._v(": 这是 ConfigMap 的名称，它将被挂载到容器中。")])]),s._v(" "),a("li",[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("items\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v(": 这里定义了 ConfigMap 中的哪些键值对将被挂载到容器中。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('key: "db.properties"')]),s._v(": 这是 ConfigMap 中的键。")]),s._v(" "),a("li",[a("code",[s._v('path: "db.properties"')]),s._v(": 这是挂载到容器中的路径。")])])])])])])]),s._v(" "),a("li",[a("p",[s._v("最后的 "),a("code",[s._v("restartPolicy: Never")]),s._v(' 与之前的相同，表示 Pod 的重启策略是 "Never"，容器退出后不会自动重启。')])])])])])]),s._v(" "),a("h3",{attrs:{id:"secret"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secret"}},[s._v("#")]),s._v(" secret")]),s._v(" "),a("p",[s._v("主要是可以配置一些加密的信息，不过这个加密是base64，加密性不高")]),s._v(" "),a("p",[s._v("创建方式和secret差不多")]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("p",[a("code",[s._v("kubectl create secret generic orig-secret --from-literal=username=admin --from-literal=password=ds@!3-/")])]),s._v(" "),a("p",[s._v("上面创建语句没有问题，但是"),a("code",[s._v("ds@!3-/")]),s._v("这种有特殊字符的数据进行创建，可能会出现一些特殊的问题，导致我们保存的数据不是我们实际想要的数据")]),s._v(" "),a("p",[s._v("更多用在docker私有仓库等。")]),s._v(" "),a("h2",{attrs:{id:"subpath"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#subpath"}},[s._v("#")]),s._v(" subPath")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("subPath")]),s._v(" 是 Kubernetes 中用于挂载卷内部文件或目录到容器的特定路径的设置。它通常在 Pod 的 "),a("code",[s._v("volumes")]),s._v(" 和容器的 "),a("code",[s._v("volumeMounts")]),s._v(" 中使用。")]),s._v(" "),a("p",[s._v("假设你有一个卷（例如 ConfigMap 或者 Secret），其中包含多个文件或目录，而你只想将其中的一部分挂载到容器内的特定路径，你可以使用 "),a("code",[s._v("subPath")]),s._v(" 来实现这一点。")]),s._v(" "),a("p",[s._v("下面是一个示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yamlCopy code\napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: my-image\n    volumeMounts:\n    - name: my-volume\n      mountPath: /path/in/container\n      subPath: my-file.txt\n  volumes:\n  - name: my-volume\n    configMap:\n      name: my-configmap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("在这个示例中，我们有一个 Pod，其中包含一个容器（"),a("code",[s._v("my-container")]),s._v("）和一个卷（"),a("code",[s._v("my-volume")]),s._v("），卷使用了 ConfigMap（"),a("code",[s._v("my-configmap")]),s._v("）。我们希望将 ConfigMap 中的 "),a("code",[s._v("my-file.txt")]),s._v(" 文件挂载到容器中的 "),a("code",[s._v("/path/in/container")]),s._v(" 路径上。这就是通过在容器的 "),a("code",[s._v("volumeMounts")]),s._v(" 中使用 "),a("code",[s._v("subPath")]),s._v(" 来实现的。这将只挂载 ConfigMap 中的 "),a("code",[s._v("my-file.txt")]),s._v(" 文件到指定路径，而不是整个 ConfigMap。")]),s._v(" "),a("p",[s._v("这在某些情况下非常有用，因为你可以选择性地将卷的特定部分挂载到容器中，而不必将整个卷都挂载进来。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904143721193.png",alt:"image-20230904143721193"}})]),s._v(" "),a("p",[s._v("意思就是将我们configMap中的的nginx.conf个文件挂在到容器中/etc/nginx/的目录下。但是这里有一个关键点，挂在时，如果容器中对应的目录存在则覆盖，不存在则新建，这样会导致我们所有的nginx的该目录下原本的文件消失，我们是不想要这样的。")]),s._v(" "),a("p",[s._v("这个时候，我们就要使用到subpath这个概念。")]),s._v(" "),a("ul",[a("li",[s._v("定义volumes时，需要增加items属性，配置key和path，且path的值不能从/开始")]),s._v(" "),a("li",[s._v("在容器内的volumeMounts中增加subpath属性，该值与volumes中的items.path的值相同")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904145206474.png",alt:"image-20230904145206474"}})]),s._v(" "),a("h3",{attrs:{id:"配置的热更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置的热更新"}},[s._v("#")]),s._v(" 配置的热更新")]),s._v(" "),a("p",[s._v("我们通常将配置文件作为configmap然后挂载到pod，那么如果更新configmap中汇的配置，会不会更新到pod中呢？")]),s._v(" "),a("p",[s._v("默认方式：会更新，更新周期是更新时间+缓存时间")]),s._v(" "),a("p",[s._v("subpath: 不会更新")]),s._v(" "),a("p",[s._v("变量形式： 如果pod中的一个变量从condigmap或者secret中得到，同样也不会更新的")]),s._v(" "),a("p",[s._v("对于subpath方式，我们可以取消subpath的使用，将配置文件挂载到一个不存在的目录，避免目录的覆盖，然后利用软链接的形式，将文件链接到目标位置")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904151614412.png",alt:"image-20230904151614412"}})]),s._v(" "),a("p",[s._v("更新方式：")]),s._v(" "),a("ul",[a("li",[s._v("通过edit命令直接修改configmap")]),s._v(" "),a("li",[s._v("通过replace替换")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904152012060.png",alt:"image-20230904152012060"}})]),s._v(" "),a("h3",{attrs:{id:"不可变的secret和condigmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不可变的secret和condigmap"}},[s._v("#")]),s._v(" 不可变的Secret和condigmap")]),s._v(" "),a("p",[s._v("一些线上的配置文件，我们并不想改变，更具有稳定性")]),s._v(" "),a("p",[s._v("对于一些敏感服务的配置文件，在线上有时是不允许修改的，此时在配置configmap时可以设置immutable:true来禁止修改")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904152838042.png",alt:"image-20230904152838042"}})]),s._v(" "),a("h2",{attrs:{id:"容器中的容器卷技术"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器中的容器卷技术"}},[s._v("#")]),s._v(" 容器中的容器卷技术")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("空白目录（EmptyDir）卷示例：")])]),s._v(" "),a("p",[s._v("主要目的不是为了持久化，而是为了管理一个pod上面有多个容器的情况")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904154439331.png",alt:"image-20230904154439331"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: nginx:1.19\n    volumeMounts:\n    - name: my-volume\n      mountPath: /data\n  volumes:\n  - name: my-volume\n    emptyDir: {}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("主机路径（HostPath）卷示例：")])]),s._v(" "),a("blockquote",[a("p",[s._v("将节点上的文件或目录挂在到pod上，此时该目录会变成持久化存储目录，即使pod被删除后重启，也可以重新加载到该目录，该目录下的文件不会丢失")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: nginx:1.19\n    volumeMounts:\n    - name: my-volume\n      mountPath: /data\n  volumes:\n  - name: my-volume\n    hostPath:\n      path: /path/on/host\n      type: Directory\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904153608701.png",alt:"image-20230904153608701"}})])])]),s._v(" "),a("p",[s._v("需要注意的是，我们创建了一个挂载的容器后，我们首先需要知道这个容器挂在到了哪个node节点，对应的node节点上的主机目录才是对应的挂在目录")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904155052921.png",alt:"image-20230904155052921"}})]),s._v(" "),a("p",[s._v("如何进入到一个pod中的指定的一个容器：")]),s._v(" "),a("p",[a("code",[s._v("kubectl exec -it empty-dir-pod -c nginx-emptydir1 -- sh")])]),s._v(" "),a("p",[s._v("可以进入到两个容器中，在对应的目录查看文件的共享")]),s._v(" "),a("p",[s._v("没有持久化的能力，pod被删除，对应的数据最终也会被删除")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("持久卷声明（PersistentVolumeClaim）示例：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: nginx:1.19\n    volumeMounts:\n    - name: my-volume\n      mountPath: /data\n  volumes:\n  - name: my-volume\n    persistentVolumeClaim:\n      claimName: my-pvc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("配置映射（ConfigMap）卷示例：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: nginx:1.19\n    volumeMounts:\n    - name: config-volume\n      mountPath: /etc/config\n  volumes:\n  - name: config-volume\n    configMap:\n      name: my-config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("密钥和证书卷示例：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: nginx:1.19\n    volumeMounts:\n    - name: tls-volume\n      mountPath: /etc/tls\n  volumes:\n  - name: tls-volume\n    secret:\n      secretName: my-tls-secret\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])])]),s._v(" "),a("p",[s._v("这些示例演示了不同类型的容器卷配置，包括空白目录卷、主机路径卷、持久卷声明、配置映射卷以及密钥和证书卷。你可以根据需要选择适当的卷类型并根据你的应用程序要求进行配置。")]),s._v(" "),a("h2",{attrs:{id:"nfs挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nfs挂载"}},[s._v("#")]),s._v(" NFS挂载")]),s._v(" "),a("h3",{attrs:{id:"不同的机器之间使用nfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不同的机器之间使用nfs"}},[s._v("#")]),s._v(" 不同的机器之间使用nfs")]),s._v(" "),a("p",[s._v("nfs卷能将NFS（网络文件系统）挂在到你的pod中，不像empty那样会被删除pod的同时也会删除，nfs卷的内容在pod被删除时会被保存，卷只是被卸载。这意味着nfs卷可以被预先填充数据，并且这些数据可以在pod之间共享")]),s._v(" "),a("p",[s._v("因为会存在网络通信，所以不建议存储在频繁读写的情况，例如不适用于mysql。")]),s._v(" "),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://www.cnblogs.com/Andya/p/14760281.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装和原理教程"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("下载nfs-server，"),a("code",[s._v("apt install nfs-server")])]),s._v(" "),a("p",[s._v("选定一台机器作为服务器，创建目录"),a("code",[s._v("/nfs/ro")]),s._v("和"),a("code",[s._v("/nfs/rw")])]),s._v(" "),a("p",[s._v("配置文件"),a("code",[s._v("/etc/exports")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/nfs/rw "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,no_subtree_check,no_root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/nfs/ro "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,no_subtree_check,no_root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("注意上面的配置，只有对应网段的的机器才可以挂载到这里")]),s._v(" "),a("p",[s._v("重新加载nfs配置"),a("code",[s._v("exportfs -f")])]),s._v(" "),a("p",[s._v("重启服务"),a("code",[s._v("systemctl reload nfs-server")])]),s._v(" "),a("p",[s._v("可以在ro当中写一个文件，便于等会在客户端查看")]),s._v(" "),a("p",[s._v("在客户端安装好"),a("code",[s._v("nfs-utils")])]),s._v(" "),a("p",[a("code",[s._v("apt install nfs-common")])]),s._v(" "),a("p",[s._v("在客户端创建一个用于挂载的目录："),a("code",[s._v("mkdir -p /mnt/nfs/rw/")])]),s._v(" "),a("p",[s._v("挂载："),a("code",[s._v("mount -t nfs 10.10.10.7:/nfs/rw /mnt/nfs/rw")])]),s._v(" "),a("p",[s._v("挂载后查看对应的目录发现有可用的文件")]),s._v(" "),a("h3",{attrs:{id:"在容器中使用nfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在容器中使用nfs"}},[s._v("#")]),s._v(" 在容器中使用nfs")]),s._v(" "),a("p",[s._v("同样是通过volume配置的方式进行运用")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904174456434.png",alt:"image-20230904174456434"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("apiVersion: v1\nkind: pod\nmetadata:\n  name: nfs-test-pod1\nspec:\n  containers:\n  - image: nginx\n    name: test-container\n    volumeMount:\n    - mountPath: /usr/share/nginx/html\n      name: test-volume\n  volumes:\n  - name: test-volume\n    nfs: \n      server: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.7\n      path: /nfs/rw\n      readOnly: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("code",[s._v("curl podip")]),s._v("可以看到返回对应的内容")]),s._v(" "),a("p",[s._v("当我们删除掉这两个pod后，nfs服务器上的资源还是存在的")]),s._v(" "),a("h2",{attrs:{id:"pv和pvc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pv和pvc"}},[s._v("#")]),s._v(" PV和PVC")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904180137431.png",alt:"image-20230904180137431"}})]),s._v(" "),a("p",[s._v("为了解决远程存储的不统一")]),s._v(" "),a("p",[s._v("PV就是对其做一个抽象，屏蔽其底层的细节。")]),s._v(" "),a("p",[s._v("PVC用于描写每个pod服务需要多少的数据资源")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904180748017.png",alt:"image-20230904180748017"}})]),s._v(" "),a("h3",{attrs:{id:"生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期"}},[s._v("#")]),s._v(" 生命周期")]),s._v(" "),a("p",[a("strong",[s._v("构建")])]),s._v(" "),a("ul",[a("li",[s._v("静态构建")])]),s._v(" "),a("p",[s._v("集群管理员创建若干pv卷，这些卷对象带有真实存储的细节信息，并且对集群用户可见，pv卷存在于k8s api中，可以供用户消费")]),s._v(" "),a("ul",[a("li",[s._v("动态构建")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904181202351.png",alt:"image-20230904181202351"}})]),s._v(" "),a("p",[a("strong",[s._v("绑定")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904181424050.png",alt:"image-20230904181424050"}})]),s._v(" "),a("p",[a("strong",[s._v("使用")])]),s._v(" "),a("p",[s._v("pod与pvc关联")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904181458505.png",alt:"image-20230904181458505"}})]),s._v(" "),a("p",[a("strong",[s._v("回收策略")])]),s._v(" "),a("ul",[a("li",[s._v("Retain")]),s._v(" "),a("li",[s._v("delete")]),s._v(" "),a("li",[s._v("recycle")])]),s._v(" "),a("h3",{attrs:{id:"pv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pv"}},[s._v("#")]),s._v(" PV")]),s._v(" "),a("p",[s._v("配置文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904182042073.png",alt:"image-20230904182042073"}})]),s._v(" "),a("p",[s._v("pv的状态")]),s._v(" "),a("p",[s._v("available 空闲：未被绑定")]),s._v(" "),a("p",[s._v("bound 已被pvc绑定")]),s._v(" "),a("p",[s._v("released：PVC被删除，资源已回收，但是被PV未被重新使用")]),s._v(" "),a("p",[s._v("Failed: 自动回收失败")]),s._v(" "),a("h3",{attrs:{id:"pvc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pvc"}},[s._v("#")]),s._v(" PVC")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904183110866.png",alt:"image-20230904183110866"}})]),s._v(" "),a("p",[s._v("创建后，看pvc就可以看到bound状态")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904183155770.png",alt:"image-20230904183155770"}})]),s._v(" "),a("p",[s._v("最后我们再来绑定pod")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230904183349258.png",alt:"image-20230904183349258"}})]),s._v(" "),a("h3",{attrs:{id:"storageclass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storageclass"}},[s._v("#")]),s._v(" storageClass")])])}),[],!1,null,null,null);a.default=e.exports}}]);