(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{382:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"ä¸€-çº¿ç¨‹æ± ç®€ä»‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€-çº¿ç¨‹æ± ç®€ä»‹"}},[s._v("#")]),s._v(" ä¸€.çº¿ç¨‹æ± ç®€ä»‹")]),s._v(" "),t("h3",{attrs:{id:"_1-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "}},[s._v("#")]),s._v(" 1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹è¢«æ— é™åˆ¶åœ°åˆ›å»ºå’Œé”€æ¯ï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜çš„ã€‚çº¿ç¨‹æ± é€šè¿‡é‡ç”¨å·²ç»å­˜åœ¨çš„çº¿ç¨‹èµ„æºï¼Œå‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„æ¬¡æ•°ï¼Œæé«˜äº†æ€§èƒ½")]),s._v(" "),t("h3",{attrs:{id:"_2-çº¿ç¨‹æ± çš„ä¼˜ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-çº¿ç¨‹æ± çš„ä¼˜ç‚¹"}},[s._v("#")]),s._v(" 2. çº¿ç¨‹æ± çš„ä¼˜ç‚¹")]),s._v(" "),t("p",[s._v("â— é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚")]),s._v(" "),t("p",[s._v("â— æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚")]),s._v(" "),t("p",[s._v("â— æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§")]),s._v(" "),t("h3",{attrs:{id:"_3-çº¿ç¨‹æ± ä¸­æ ¸å¿ƒå…³ç³»ç»§æ‰¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-çº¿ç¨‹æ± ä¸­æ ¸å¿ƒå…³ç³»ç»§æ‰¿"}},[s._v("#")]),s._v(" 3. çº¿ç¨‹æ± ä¸­æ ¸å¿ƒå…³ç³»ç»§æ‰¿")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/29475739/1668332189584-789cc0b9-4627-4a8a-b641-de73aed14ae5.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"_4-å¯¹çº¿ç¨‹æ± çš„ç†è§£"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¯¹çº¿ç¨‹æ± çš„ç†è§£"}},[s._v("#")]),s._v(" 4.å¯¹çº¿ç¨‹æ± çš„ç†è§£")]),s._v(" "),t("h4",{attrs:{id:"_1æ¡†æ¶çš„ä¸¤æè°ƒåº¦æ¨¡å‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1æ¡†æ¶çš„ä¸¤æè°ƒåº¦æ¨¡å‹"}},[s._v("#")]),s._v(" â‘ æ¡†æ¶çš„ä¸¤æè°ƒåº¦æ¨¡å‹")]),s._v(" "),t("p",[s._v("åœ¨JVMçº¿ç¨‹æ¨¡å‹ä¸­ï¼Œjavaçº¿ç¨‹è¢«ä¸€å¯¹ä¸€æ˜ å°„ä¸ºæœ¬åœ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚javaçº¿ç¨‹å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæœ¬åœ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚å½“çº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œè¿™ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢å›æ”¶ã€‚æ“ä½œç³»ç»Ÿä¼šè°ƒåº¦æ‰€æœ‰çº¿ç¨‹å¹¶å°†å®ƒä»¬åˆ†é…ç»™å¯ç”¨çš„CPU")]),s._v(" "),t("p",[s._v("åœ¨ä¸Šå±‚ï¼Œjavaå¤šçº¿ç¨‹ç¨‹åºé€šå¸¸æŠŠåº”ç”¨åˆ†è§£ä¸ºè‹¥å¹²ä¸ªä»»åŠ¡ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·çº§çš„è°ƒåº¦å™¨å°†è¿™äº›ä»»åŠ¡æ˜ å°„åˆ°å›ºå®šæ•°é‡çš„çº¿ç¨‹ï¼›åœ¨åº•å±‚ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å°†è¿™äº›çº¿ç¨‹æ˜ å°„åˆ°ç¡¬ä»¶å¤„ç†å™¨ä¸Šã€‚")]),s._v(" "),t("p",[s._v("åº”ç”¨ç¨‹åºé€šè¿‡executoræ¡†æ¶æ§åˆ¶ä¸Šå±‚çš„è°ƒåº¦ï¼Œä¸‹å±‚çš„è°ƒåº¦ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ§åˆ¶ï¼Œä¸‹å±‚çš„è°ƒåº¦ä¸å—åº”ç”¨ç¨‹åºçš„æ§åˆ¶ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/29475739/1668332189701-8441be62-0c2e-4024-8092-e01ae88a150d.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_2æ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2æ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«"}},[s._v("#")]),s._v(" â‘¡æ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«")]),s._v(" "),t("p",[s._v("â€‹       æœ¬è´¨æ²¡æœ‰åŒºåˆ«ï¼Œé€šè¿‡çœ‹æºç çš„è¯ï¼Œå…¶å®å°±æ˜¯æ‰€æœ‰åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¹¶æ²¡æœ‰ä¸€ä¸ªç‰¹å®šçš„æ ‡è¯†å»æ ‡è¯†è¿™ä¸ªçº¿ç¨‹æ˜¯æ ¸å¿ƒçº¿ç¨‹è¿˜æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡workCountå½“å‰çº¿ç¨‹æ•°å»å¯¹æ¯”çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°æ¥çœ‹æ˜¯æ ¸å¿ƒçº¿ç¨‹è¿˜æ˜¯éæ ¸å¿ƒçº¿ç¨‹ã€‚")]),s._v(" "),t("p",[s._v("â€‹       å°±åƒä¸€ä¸ªå¸¸è¯´çš„æ ¸å¿ƒçº¿ç¨‹ä¸ä¼šè‡ªå·±é”€æ¯è€Œéæ ¸å¿ƒçº¿ç¨‹ä¼šè‡ªåŠ¨çº¿ç¨‹ã€‚åœ¨åº•å±‚å½“å‰çº¿ç¨‹ä¼šæ ¹æ®çº¿ç¨‹æ•°å’Œçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°åšå¯¹æ¯”æ¥çœ‹è‡ªå·±è¯¥æ‰§è¡Œæ ¸å¿ƒçº¿ç¨‹çš„é€»è¾‘ï¼ˆå»queueä¸­takeå€¼ï¼‰è¿˜æ˜¯éæ ¸å¿ƒçº¿ç¨‹çš„é€»è¾‘ï¼ˆå»queueä¸­pollå€¼ï¼‰ï¼Œæ‰€ä»¥è¯´æŸä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶æ˜¯å¦æ˜¯æ ¸å¿ƒçº¿ç¨‹éœ€è¦çœ‹å½“å‰çº¿ç¨‹æ•°å’Œæ ¸å¿ƒçº¿ç¨‹æ•°è¿›è¡Œå¯¹æ¯”æ¥çœ‹çš„ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­æ—¢æœ‰å¯èƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¹Ÿæœ‰å¯èƒ½æ˜¯éæ ¸å¿ƒçº¿ç¨‹ã€‚")]),s._v(" "),t("p",[s._v("çœ‹åˆ°è¿™é‡Œ"),t("strong",[s._v("ä½ å¯èƒ½ä¼šè§‰å¾—æ ¸å¿ƒçº¿ç¨‹åœ¨çº¿ç¨‹æ± é‡Œé¢ä¼šæœ‰ç‰¹æ®Šæ ‡è®°")]),s._v("ï¼Ÿå¹¶æ²¡æœ‰ï¼Œä¸è®ºæ˜¯æ ¸å¿ƒè¿˜æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹æ± é‡Œé¢éƒ½æ˜¯ä¸€è§†åŒä»ï¼Œå½“æ·˜æ±°çš„æ—¶å€™ä¸ä¼šç®¡æ˜¯å“ªäº›çº¿ç¨‹ï¼Œåæ­£ç•™ä¸‹æ ¸å¿ƒçº¿ç¨‹æ•°ä¸ªçº¿ç¨‹å³å¯ï¼Œä¸‹æ–‡ä¼šä½œè¯¦è§£ã€‚")]),s._v(" "),t("p",[s._v("çº¿ç¨‹æ± é»˜è®¤é‡‡ç”¨æ‡’åŠ è½½æ¥åˆ›å»ºçº¿ç¨‹")]),s._v(" "),t("h2",{attrs:{id:"äºŒ-çº¿ç¨‹æ± æ ¸å¿ƒæ¦‚å¿µ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒ-çº¿ç¨‹æ± æ ¸å¿ƒæ¦‚å¿µ"}},[s._v("#")]),s._v(" äºŒ. çº¿ç¨‹æ± æ ¸å¿ƒæ¦‚å¿µ")]),s._v(" "),t("h3",{attrs:{id:"_1-çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°"}},[s._v("#")]),s._v(" 1. çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°")]),s._v(" "),t("ul",[t("li",[s._v("**corePoolSize ğŸ˜—*æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¼šä¸€ç›´å­˜æ´»ï¼Œå³ä½¿æ²¡æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼ˆé™¤éallowCoreThreadTimeOutå‚æ•°è®¾ç½®ä¸ºtrueï¼Œè¿™æ ·çš„è¯å³ä½¿æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¼šè¢«è¶…æ—¶é”€æ¯ï¼‰")]),s._v(" "),t("li",[t("strong",[s._v("maximumPoolSize")]),s._v("**ğŸ˜—* å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("workQueue:")]),s._v(" å½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚")])]),s._v(" "),t("p",[s._v("â€‹       ä»‹ç»ä¸€ä¸‹å¸¸è§çš„é˜»å¡é˜Ÿåˆ—ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("LinkedBlockingQueue")]),s._v("é“¾å¼é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé»˜è®¤å¤§å°æ˜¯Integer.MAX_VALUEï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("ArrayBlockingQueue")]),s._v("æ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("SynchronousQueue")]),s._v("åŒæ­¥é˜Ÿåˆ—ï¼Œå†…éƒ¨å®¹é‡ä¸º0ï¼Œæ¯ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚SynchronousQueue ä¹Ÿæ˜¯ä¸€ä¸ªé˜Ÿåˆ—æ¥çš„ï¼Œä½†å®ƒçš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒå†…éƒ¨æ²¡æœ‰å®¹å™¨ï¼Œä¸€ä¸ªç”Ÿäº§çº¿ç¨‹ï¼Œå½“å®ƒç”Ÿäº§äº§å“ï¼ˆå³putçš„æ—¶å€™ï¼‰ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äººæƒ³è¦æ¶ˆè´¹äº§å“(å³å½“å‰æ²¡æœ‰çº¿ç¨‹æ‰§è¡Œtake)ï¼Œæ­¤ç”Ÿäº§çº¿ç¨‹å¿…é¡»é˜»å¡ï¼Œç­‰å¾…ä¸€ä¸ªæ¶ˆè´¹çº¿ç¨‹è°ƒç”¨takeæ“ä½œï¼Œtakeæ“ä½œå°†ä¼šå”¤é†’è¯¥ç”Ÿäº§çº¿ç¨‹ï¼ŒåŒæ—¶æ¶ˆè´¹çº¿ç¨‹ä¼šè·å–ç”Ÿäº§çº¿ç¨‹çš„äº§å“ï¼ˆå³æ•°æ®ä¼ é€’ï¼‰ï¼Œè¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ç§°ä¸ºä¸€æ¬¡é…å¯¹è¿‡ç¨‹(å½“ç„¶ä¹Ÿå¯ä»¥å…ˆtakeåput,åŸç†æ˜¯ä¸€æ ·çš„)ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("DelayQueue")]),s._v("å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´  ã€‚")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("keepAliveTime")]),s._v(":å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† keepAliveTimeæ‰ä¼šè¢«å›æ”¶é”€æ¯ï¼›")])]),s._v(" "),t("p",[s._v("å®ç°åŸç†ï¼šè¿‡é˜»å¡é˜Ÿåˆ— workQueue çš„ poll æ–¹æ³•ï¼Œå½“è¶…è¿‡ keepAliveTime çš„æ—¶å€™åè¿˜æ— æ³•è·å–æ–°çš„ä»»åŠ¡ï¼Œåˆ™è¿”å› nullï¼Œ æœ€ååœ¨ runWorker æ–¹æ³•ä¸­ç»“æŸçº¿ç¨‹æ•´ä¸ªç”Ÿå‘½")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("unit")]),s._v(" : keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("threadFactory")]),s._v(" :executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("handler")]),s._v(" :é¥±å’Œç­–ç•¥ã€‚å…³äºé¥±å’Œç­–ç•¥ä¸‹é¢å•ç‹¬ä»‹ç»ä¸€ä¸‹")])]),s._v(" "),t("p",[s._v("â€‹       â‘ "),t("strong",[s._v("ThreadPoolExecutor.AbortPolicy")]),s._v(" ï¼šæŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚")]),s._v(" "),t("p",[s._v("â€‹       â‘¡"),t("strong",[s._v("ThreadPoolExecutor.CallerRunsPolicy")]),s._v(" ï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨è°ƒç”¨executeæ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œ(run)è¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚å› æ­¤è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ è¦æ±‚ä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚éƒ½è¦è¢«æ‰§è¡Œçš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚ï¼ˆ"),t("strong",[s._v("å¿…é¡»ä¿è¯æ˜¯runningçŠ¶æ€")]),s._v("ï¼‰")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rejectedExecution")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isShutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("â€‹       â‘¢"),t("strong",[s._v("ThreadPoolExecutor.DiscardPolicy")]),s._v(" ï¼šä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚")]),s._v(" "),t("p",[s._v("â€‹       â‘£"),t("strong",[s._v("ThreadPoolExecutor.DiscardOldestPolicy")]),s._v(" ï¼š æ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rejectedExecution")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isShutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_2-ä¸¤ç§å¸¸è§çš„çº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä¸¤ç§å¸¸è§çš„çº¿ç¨‹æ± "}},[s._v("#")]),s._v(" 2.ä¸¤ç§å¸¸è§çš„çº¿ç¨‹æ± ")]),s._v(" "),t("p",[s._v("é€šè¿‡Excutorsæ¥åˆ›å»ºçº¿ç¨‹æ± ")]),s._v(" "),t("h4",{attrs:{id:"_1newcachedthreadpool-é€‚åˆå¤šä¸ªçŸ­æ—¶é—´ä»»åŠ¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1newcachedthreadpool-é€‚åˆå¤šä¸ªçŸ­æ—¶é—´ä»»åŠ¡"}},[s._v("#")]),s._v(" â‘ newCachedThreadPoolï¼šé€‚åˆå¤šä¸ªçŸ­æ—¶é—´ä»»åŠ¡")]),s._v(" "),t("p",[t("strong",[s._v("æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ")])]),s._v(" "),t("p",[s._v("ç†è§£ç¼“å†²çº¿ç¨‹æ± ï¼šåˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œ60så¦‚æœæ²¡æœ‰å¤„ç†ä»»åŠ¡åˆ™ä¼šåˆ é™¤")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newCachedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAX_VALUE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SynchronousQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("è¿è¡Œæµç¨‹ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("æäº¤ä»»åŠ¡è¿›çº¿ç¨‹æ± ã€‚")]),s._v(" "),t("li",[s._v("å› ä¸ºcorePoolSizeä¸º0çš„å…³ç³»ï¼Œä¸åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœ€å¤§ä¸ºInteger.MAX_VALUEã€‚")]),s._v(" "),t("li",[s._v("å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°SynchronousQueueé˜Ÿåˆ—ã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœSynchronousQueueå…¥åˆ—æˆåŠŸï¼Œç­‰å¾…è¢«å½“å‰è¿è¡Œçš„çº¿ç¨‹ç©ºé—²åæ‹‰å–æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ï¼Œç„¶åä»SynchronousQueueæ‹‰å–ä»»åŠ¡å¹¶åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœSynchronousQueueå·²æœ‰ä»»åŠ¡åœ¨ç­‰å¾…ï¼Œå…¥åˆ—æ“ä½œå°†ä¼šé˜»å¡ã€‚é€‚ç”¨åœºæ™¯ï¼š     "),t("strong",[s._v("å½“éœ€è¦æ‰§è¡Œå¾ˆå¤šçŸ­æ—¶é—´çš„ä»»åŠ¡æ—¶")]),s._v("ï¼ŒCacheThreadPoolçš„çº¿ç¨‹å¤ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œ ä¼šæ˜¾è‘—çš„æé«˜æ€§èƒ½ã€‚è€Œä¸”çº¿ç¨‹60såä¼šå›æ”¶ï¼Œæ„å‘³ç€å³ä½¿æ²¡æœ‰ä»»åŠ¡è¿›æ¥ï¼ŒCacheThreadPoolå¹¶ä¸ä¼šå ç”¨å¾ˆå¤šèµ„æºã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_2newfixedthreadpool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2newfixedthreadpool"}},[s._v("#")]),s._v(" â‘¡newFixedThreadPool")]),s._v(" "),t("p",[s._v("å¯é‡å¤å›ºå®šçº¿ç¨‹æ± ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" nThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nThreads"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("æ ¸å¿ƒçº¿ç¨‹æ•°é‡å’Œæ€»çº¿ç¨‹æ•°é‡ç›¸ç­‰ï¼Œéƒ½æ˜¯ä¼ å…¥çš„å‚æ•°nThreadsï¼Œ"),t("strong",[s._v("æ‰€ä»¥åªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œä¸èƒ½åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹")]),s._v("ã€‚å› ä¸ºLinkedBlockingQueueçš„é»˜è®¤å¤§å°æ˜¯Integer.MAX_VALUEï¼Œæ•…å¦‚æœæ ¸å¿ƒçº¿ç¨‹ç©ºé—²ï¼Œåˆ™äº¤ç»™æ ¸å¿ƒçº¿ç¨‹å¤„ç†ï¼›å¦‚æœæ ¸å¿ƒçº¿ç¨‹ä¸ç©ºé—²ï¼Œåˆ™å…¥åˆ—ç­‰å¾…ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹ç©ºé—²ã€‚")]),s._v(" "),t("p",[s._v("ä¸å‰é¢çš„CachedThreadPoolæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")]),s._v(" "),t("ul",[t("li",[s._v("å› ä¸º corePoolSize == maximumPoolSize ï¼Œæ‰€ä»¥FixedThreadPoolåªä¼šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ã€‚ è€ŒCachedThreadPoolå› ä¸ºcorePoolSize=0ï¼Œæ‰€ä»¥åªä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚")]),s._v(" "),t("li",[s._v("åœ¨ getTask() æ–¹æ³•ï¼Œå¦‚æœé˜Ÿåˆ—é‡Œæ²¡æœ‰ä»»åŠ¡å¯å–ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨ LinkedBlockingQueue.take() ï¼Œçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ã€‚ CachedThreadPoolä¼šåœ¨60såæ”¶å›ã€‚")]),s._v(" "),t("li",[s._v("ç”±äºçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼Œä¼šä¸€ç›´å¡åœ¨é˜»å¡ï¼Œæ‰€ä»¥"),t("strong",[s._v("æ²¡æœ‰ä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œ FixedThreadPoolå ç”¨èµ„æºæ›´å¤š")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("éƒ½å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ï¼Œä½†æ˜¯åŸç†ä¸åŒã€‚FixedThreadPoolæ˜¯å› ä¸ºé˜»å¡é˜Ÿåˆ—å¯ä»¥å¾ˆå¤§ï¼ˆæœ€å¤§ä¸ºIntegeræœ€å¤§å€¼ï¼‰ï¼Œæ•…å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ï¼›CachedThreadPoolæ˜¯å› ä¸ºçº¿ç¨‹æ± å¾ˆå¤§ï¼ˆæœ€å¤§ä¸ºIntegeræœ€å¤§å€¼ï¼‰ï¼Œå‡ ä¹ä¸ä¼šå¯¼è‡´çº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œæ•…å‡ ä¹ä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_3newsinglethreadexcutor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3newsinglethreadexcutor"}},[s._v("#")]),s._v(" â‘¢newSingleThreadExcutor")]),s._v(" "),t("p",[s._v("åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newSingleThreadExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizableDelegatedExecutorService")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedBlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼ˆ corePoolSize == maximumPoolSize=1ï¼‰ï¼Œä½¿ç”¨äº†LinkedBlockingQueueï¼ˆå®¹é‡å¾ˆå¤§ï¼‰ï¼Œæ‰€ä»¥ï¼Œ"),t("strong",[s._v("ä¸ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹")]),s._v("ã€‚æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§"),t("strong",[s._v("å…ˆæ¥å…ˆæ‰§è¡Œ")]),s._v("çš„é¡ºåºæ‰§è¡Œã€‚å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹ä¸ç©ºé—²ï¼Œé‚£ä¹ˆæ–°æ¥çš„ä»»åŠ¡ä¼šå­˜å‚¨åœ¨ä»»åŠ¡é˜Ÿåˆ—é‡Œç­‰å¾…æ‰§è¡Œã€‚")]),s._v(" "),t("h4",{attrs:{id:"_4newscheduledthreadpool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4newscheduledthreadpool"}},[s._v("#")]),s._v(" â‘£newScheduledThreadPool")]),s._v(" "),t("p",[s._v("åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScheduledExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newScheduledThreadPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScheduledThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ScheduledThreadPoolExecutor():")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScheduledThreadPoolExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAX_VALUE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DEFAULT_KEEPALIVE_MILLIS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DelayedWorkQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("èƒ½å¤Ÿè¿›è¡Œå®šæ—¶çš„åŸå› ä¹‹ä¸€å°±æ˜¯æœ‰ä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—")]),s._v(" "),t("p",[t("strong",[s._v("newSingleThreadScheduledExecutor() å’Œ newScheduledThreadPool(int corePoolSize)")]),s._v("ï¼Œåˆ›å»ºçš„æ˜¯ä¸ª ScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œ"),t("strong",[s._v("å®šæ—¶æˆ–å‘¨æœŸæ€§")]),s._v("çš„å·¥ä½œè°ƒåº¦ï¼ŒåŒºåˆ«åœ¨äº"),t("strong",[s._v("å•ä¸€å·¥ä½œçº¿ç¨‹è¿˜æ˜¯å¤šä¸ªå·¥ä½œ")]),s._v("çº¿ç¨‹ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_5newworkstealingpool-int-parallelism-ã€äº†è§£ã€‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5newworkstealingpool-int-parallelism-ã€äº†è§£ã€‘"}},[s._v("#")]),s._v(" â‘¤"),t("strong",[s._v("newWorkStealingPool(int parallelism)")]),s._v(" ã€äº†è§£ã€‘")]),s._v(" "),t("p",[s._v("è¿™æ˜¯ä¸€ä¸ªç»å¸¸è¢«äººå¿½ç•¥çš„çº¿ç¨‹æ± ï¼ŒJava 8 æ‰åŠ å…¥è¿™ä¸ªåˆ›å»ºæ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šæ„å»º"),t("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2F9%2Fdocs%2Fapi%2Fjava%2Futil%2Fconcurrent%2FForkJoinPool.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ForkJoinPool"),t("OutboundLink")],1),s._v("ï¼Œåˆ©ç”¨"),t("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FWork_stealing",target:"_blank",rel:"noopener noreferrer"}},[s._v("Work-Stealing"),t("OutboundLink")],1),s._v("ç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåºã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newWorkStealingPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" parallelism"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForkJoinPool")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parallelism"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForkJoinPool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("defaultForkJoinWorkerThreadFactory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"é˜¿é‡Œå·´å·´æ‰‹å†Œä¸å»ºè®®ä½¿ç”¨excutorsæ¥åˆ›å»ºçº¿ç¨‹æ± "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é˜¿é‡Œå·´å·´æ‰‹å†Œä¸å»ºè®®ä½¿ç”¨excutorsæ¥åˆ›å»ºçº¿ç¨‹æ± "}},[s._v("#")]),s._v(" é˜¿é‡Œå·´å·´æ‰‹å†Œä¸å»ºè®®ä½¿ç”¨Excutorsæ¥åˆ›å»ºçº¿ç¨‹æ± ")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("FixedThreadPool"),t("strong",[t("strong",[s._v("å’Œ")])]),s._v("SingleThreadExecutor")]),s._v(" ï¼š å…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUE,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚")]),s._v(" "),t("li",[t("strong",[s._v("CachedThreadPool å’Œ ScheduledThreadPool")]),s._v(" ï¼š å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOM")])]),s._v(" "),t("h3",{attrs:{id:"_3-çº¿ç¨‹æ± çš„çŠ¶æ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-çº¿ç¨‹æ± çš„çŠ¶æ€"}},[s._v("#")]),s._v(" 3. çº¿ç¨‹æ± çš„çŠ¶æ€")]),s._v(" "),t("p",[s._v("ThreadPoolExecutorç±»ä¸­ä½¿ç”¨äº†ä¸€äº›final int ctlå¸¸é‡å˜é‡æ¥è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€ ï¼Œåˆ†åˆ«ä¸ºRUNNINGã€SHUTDOWNã€STOPã€TIDYING ã€TERMINATEDã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),s._v(" ctl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ctlOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RUNNING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//29")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CAPACITY")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//000 1111â€¦â€¦1")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// runState is stored in the high-order bits")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RUNNING")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TIDYING")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TERMINATED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNT_BITS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("çº¿ç¨‹æ± åˆ›å»ºåå¤„äºRUNNINGçŠ¶æ€ã€‚")]),s._v(" "),t("li",[s._v("è°ƒç”¨shutdown()æ–¹æ³•åå¤„äºSHUTDOWNçŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸èƒ½æ¥å—æ–°çš„ä»»åŠ¡ï¼Œæ¸…é™¤ä¸€äº›ç©ºé—²worker,ä¼šç­‰å¾…é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡å®Œæˆã€‚åœ¨å¤„äºåˆ†ç©ºé—²çš„çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚å³åœ¨é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¼šè¢«æ ¸å¿ƒçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼ˆ"),t("strong",[s._v("çº¿ç¨‹æ± æ— æ³•æ¥æ”¶æ–°çš„executeæäº¤çš„ä»»åŠ¡ï¼ˆä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼‰ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œè¢«çº¿ç¨‹æ‹‰å–æ‰§è¡Œ")]),s._v("ï¼‰")]),s._v(" "),t("li",[s._v("è°ƒç”¨shutdownNow()æ–¹æ³•åå¤„äºSTOPçŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸èƒ½æ¥å—æ–°çš„ä»»åŠ¡ï¼Œ"),t("strong",[s._v("ä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨ä¸¢å¼ƒã€‚æ­¤æ—¶ï¼Œpoolsize=0,é˜»å¡é˜Ÿåˆ—çš„sizeä¹Ÿä¸º0ã€‚ï¼ˆ"),t("strong",[t("strong",[s._v("æ­¤æ—¶åœæ­¢æ‰€æœ‰ä»»åŠ¡ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¼šè¿”å›åˆ°ä¸€ä¸ªæ•°ç»„å½“ä¸­")])]),s._v("ï¼‰")])]),s._v(" "),t("li",[s._v("å½“æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ˆæ­¢**ï¼Œctlè®°å½•çš„â€ä»»åŠ¡æ•°é‡â€ä¸º0ï¼Œçº¿ç¨‹æ± ä¼šå˜ä¸ºTIDYINGçŠ¶æ€ã€‚æ¥ç€ä¼šæ‰§è¡Œterminated()å‡½æ•°ã€‚**")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/29475739/1668332189380-d8dc46ed-ea2d-45bd-ae2c-eb32862224b5.png",alt:"img"}})]),s._v(" "),t("p",[s._v("åœ¨ThreadPoolExcutorä¸­æœ‰ä¸€ä¸ªæ§åˆ¶çŠ¶æ€çš„å±æ€§ctlï¼Œä»–æ˜¯ä¸€ä¸ªAtomicIntegerç±»å‹çš„å˜é‡ã€‚")]),s._v(" "),t("p",[s._v("å…¶é«˜3ä½è¡¨ç¤ºå½“å‰çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€")]),s._v(" "),t("p",[s._v("ä½29ä½è¡¨ç¤ºçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°é‡")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CAPACITY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CAPACITY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ctlOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" wc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//CAPACITY  000 11111â€¦â€¦111")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"ä¸‰-æºç è§£è¯»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰-æºç è§£è¯»"}},[s._v("#")]),s._v(" ä¸‰.æºç è§£è¯»")]),s._v(" "),t("p",[s._v("ä»¥ä¸‹æ‰€æœ‰æ–¹æ³•éƒ½ä»…é’ˆå¯¹äºjdk1.8")]),s._v(" "),t("h3",{attrs:{id:"_1execute"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1execute"}},[s._v("#")]),s._v(" â‘ execute()")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœä»»åŠ¡ä¸ºç©ºï¼Œé‚£ç›´æ¥æŠ¥é”™")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NullPointerException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå°±è®©æ ¸å¿ƒçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¤„ç†å¤±è´¥ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œ")]),s._v("\n            c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å°è¯•å°†ä»»åŠ¡æ”¾è¿›å·¥ä½œé˜Ÿåˆ—ä¸­")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRunning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("offer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" recheck "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœisRunningè¿”å›false(çŠ¶æ€æ£€æŸ¥)ï¼Œåˆ™removeè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRunning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("recheck"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//çº¿ç¨‹æ± å¤„äºrunningçŠ¶æ€ï¼Œä½†æ˜¯æ²¡æœ‰çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹ã€‚")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ€ä¹ˆä¼šæ²¡æœ‰çº¿ç¨‹ï¼Ÿ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å› ä¸ºçº¿ç¨‹æ± æ˜¯å…è®¸è®¾ç½®æ ¸å¿ƒçº¿ç¨‹å…è®¸è¶…æ—¶çš„ï¼ˆallowCoreThreadTimeOutï¼‰ï¼Œæ‰€ä»¥è€çˆ·å­åœ¨è¿™é‡Œå†æ¬¡åˆ¤æ–­ï¼Œå¾ˆä¸¥è°¨ï¼Œå¾ˆç»†è…»ã€‚å¦‚æœæ²¡çº¿ç¨‹äº†ï¼Œåˆ™addWorker(null, false);ä¸ºä»€ä¹ˆæ˜¯nullï¼Ÿnullåœ¨addWorkeré‡Œæœ‰åˆ¤æ–­ç”¨å¤„ã€‚")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("recheck"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å·¥ä½œé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™å°è¯•ç”¨éæ ¸å¿ƒçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å·¥ä½œçº¿ç¨‹æ•°å·²ç»è¶…è¿‡äº†çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œè°ƒç”¨æ‹’ç»ç­–ç•¥")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[t("strong",[s._v("åœ¨ä»£ç ä¸­è¿›è¡Œä¸¤æ¬¡isRunningæ£€æŸ¥ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œä¸¤æ¬¡ï¼Ÿ")])]),s._v(" "),t("p",[s._v("åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯æ—¶åˆ»å‘ç”Ÿå˜åŒ–çš„ã€‚å¾ˆæœ‰å¯èƒ½åˆšè·å–çº¿ç¨‹æ± çŠ¶æ€åçº¿ç¨‹æ± çŠ¶æ€å°±æ”¹å˜äº†ã€‚åˆ¤æ–­æ˜¯å¦å°†commandåŠ å…¥workqueueæ˜¯çº¿ç¨‹æ± ä¹‹å‰çš„çŠ¶æ€ã€‚å€˜è‹¥æ²¡æœ‰äºŒæ¬¡æ£€æŸ¥ï¼Œä¸‡ä¸€çº¿ç¨‹æ± å¤„äºé"),t("strong",[s._v("RUNNING")]),s._v("çŠ¶æ€ï¼ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¾ˆæœ‰å¯èƒ½å‘ç”Ÿï¼‰ï¼Œé‚£ä¹ˆcommandæ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ç®€è¿°çº¿ç¨‹æ± å·¥ä½œæµç¨‹")])]),s._v(" "),t("p",[s._v("å…¶å®ä»ä¸Šé¢çš„æºç éƒ¨åˆ†æˆ‘ä»¬å°±å·²ç»å¾ˆå®¹æ˜“çœ‹å‡ºæ¥äº†")]),s._v(" "),t("ol",[t("li",[s._v("å…ˆæ£€æŸ¥ä»»åŠ¡æ˜¯å¦ä¸ºç©ºï¼Œå¦åˆ™ç›´æ¥è¿”å›")]),s._v(" "),t("li",[s._v("çº¿ç¨‹æ€»æ•°é‡ < corePoolSizeï¼Œ"),t("strong",[s._v("æ— è®ºçº¿ç¨‹æ˜¯å¦ç©ºé—²ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡")]),s._v("ï¼ˆè®©æ ¸å¿ƒçº¿ç¨‹æ•°é‡å¿«é€Ÿè¾¾åˆ°corePoolSizeï¼Œåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°é‡ < corePoolSizeæ—¶ï¼‰ã€‚"),t("strong",[s._v("æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚")])]),s._v(" "),t("li",[s._v("çº¿ç¨‹æ€»æ•°é‡ >= corePoolSizeæ—¶ï¼Œæ–°æ¥çš„çº¿ç¨‹ä»»åŠ¡ä¼šè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç„¶åç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹ä¼šä¾æ¬¡å»ç¼“å­˜é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ¥æ‰§è¡Œï¼ˆä½“ç°äº†"),t("strong",[s._v("çº¿ç¨‹å¤ç”¨")]),s._v("ï¼‰ã€‚"),t("strong",[s._v("è¿™ä¸ªé˜¶æ®µè¿˜ä¼šè¿›è¡ŒåŒé‡æ£€æŸ¥ï¼Œé¿å…å› ä¸ºçº¿ç¨‹æ± çŠ¶æ€çš„å˜åŒ–æˆ–å½“å‰çº¿ç¨‹æ± æ— çº¿ç¨‹å¯¼è‡´æ”¾å…¥çš„ä»»åŠ¡ä¸€ç›´æ— æ³•è¢«æ‰§è¡Œ")])]),s._v(" "),t("li",[s._v("å½“ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œè¯´æ˜è¿™ä¸ªæ—¶å€™ä»»åŠ¡å·²ç»å¤šåˆ°çˆ†æ£šï¼Œéœ€è¦ä¸€äº›â€œä¸´æ—¶å·¥â€æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡äº†ã€‚äºæ˜¯ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚"),t("strong",[s._v("æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚")])]),s._v(" "),t("li",[s._v("ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œ ä¸”æ€»çº¿ç¨‹æ•°è¾¾åˆ°äº†maximumPoolSizeï¼Œåˆ™ä¼šé‡‡å–ä¸Šé¢æåˆ°çš„æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/29475739/1668343061662-845e7fbc-e671-4576-ac38-d06d34998ad2.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"_2addworker-runnable-firsttask-boolean-core"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2addworker-runnable-firsttask-boolean-core"}},[s._v("#")]),s._v(" â‘¡addWorker(Runnable firstTask,boolean core)")]),s._v(" "),t("p",[s._v("æ³¨æ„ï¼šè¿™é‡Œå½“ å½“å‰çº¿ç¨‹æ•°<æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œä¸”æœ‰ç©ºé—²çº¿ç¨‹ã€‚ä¸€ä¸ªæ–°ä»»åŠ¡æ¥ä¸´æ—¶ï¼Œæ˜¯ç”¨ç©ºé—²çº¿ç¨‹æ¥æ‰§è¡Œå—ï¼Œè¿˜æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Ÿ")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆï¼š"),t("strong",[s._v("åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹")])]),s._v(" "),t("p",[s._v("è¿™é‡Œè¿˜æœ‰ä¸ªç»†èŠ‚ï¼Œå¦‚æœçº¿ç¨‹æ•°å·²ç»è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆæ–°å¢åŠ çš„ä»»åŠ¡åªä¼šå¾€ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢å¡ï¼Œä¸ä¼šç›´æ¥ç»™äºˆæŸä¸ªçº¿ç¨‹ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œ"),t("strong",[s._v("æ–°å¢æœ€å¤§çº¿ç¨‹æ•°çš„çº¿ç¨‹æ—¶ï¼Œä»»åŠ¡æ˜¯å¯ä»¥ç›´æ¥ç»™äºˆæ–°å»ºçš„çº¿ç¨‹æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯å…¥é˜Ÿ")]),s._v("ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        retry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è§ä¸‹æ–‡è¯¦è§£1")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                   firstTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§å®¹é‡æˆ–è€…çº¿ç¨‹æ•°è¶…è¿‡äº†è®¾ç½®çš„çº¿ç¨‹æ•°ï¼Œåˆ™returnï¼Œè¿™ä¸ªä¸‰ç›®è¡¨è¾¾å¼ç§’å•Šï¼Œçœäº†å¤šå°‘if elseçš„ä»£ç ")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CAPACITY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                    wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("core "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" corePoolSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" maximumPoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//CASçš„æ–¹å¼å°†çº¿ç¨‹æ•°+1ï¼Œä¹Ÿå°±æ˜¯ctlå˜é‡çš„ä½29ä½ã€‚")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndIncrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v(" retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n                c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Re-read ctl")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" rs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œè‹¥æ²¡æœ‰å˜åŒ–åˆ™ç»§ç»­CASã€‚")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v(" retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœCASå¤±è´¥ä¸”çŠ¶æ€å‘ç”Ÿæ‹œå¹´è¯ï¼Œå°±è¿›è¡Œè‡ªæ—‹åˆ°retryå¼€å§‹ï¼Œå› ä¸ºctlä¸€ç›´åœ¨å˜åŒ–ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯ctlåœ¨æ­£ç¡®çš„æ‰§è¡Œé€»è¾‘ä¹‹å†…")]),s._v("\n               \n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ€»ç»“ï¼šå…ˆæ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œåˆç†åï¼Œå»æ£€æŸ¥çº¿ç¨‹æ•°çš„çŠ¶æ€ï¼Œåˆç†åå»è®¾ç½®workæ•°é‡+1ï¼Œå³å·¥ä½œçº¿ç¨‹æ•°+1")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¸ŠåŠéƒ¨åˆ†å…¶å®å°±æ˜¯è¿›è¡ŒçŠ¶æ€çš„åˆ¤æ–­å’Œctlçš„å˜æ›´ï¼Œæ˜¯å‡†å¤‡åŠ¨ä½œï¼Œä¸‹é¢çš„éƒ¨åˆ†å°±æ˜¯çœŸæ­£è¿›è¡Œä»»åŠ¡æ‰§è¡Œ")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" workerStarted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" workerAdded "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å°†ä»»åŠ¡è¿›è¡Œå°è£…")]),s._v("\n            w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ·»åŠ ä¸€ä¸ªæ–°çš„è¿˜æœªå¼€å§‹çš„çº¿ç¨‹")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¸Šé”çš„ç›®çš„æ˜¯ä¿è¯workers.add(worker)æ–¹æ³•åœ¨å¤šçº¿ç¨‹æ“ä½œæ—¶å€™æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    \n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    \n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å†æ¬¡æ£€æŸ¥å½“å‰çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦ç¬¦åˆæ‰§è¡Œæ¡ä»¶")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" firstTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœçº¿ç¨‹å·²ç»è¢«startè¿‡äº†ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œä¸å…è®¸é‡å¤è°ƒç”¨start")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isAlive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n                            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IllegalThreadStateException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        \n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ·»åŠ ä»»åŠ¡åˆ°HashSetä»»åŠ¡é˜Ÿåˆ—")]),s._v("\n                        workers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" workers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœworkersçš„é•¿åº¦ï¼ˆä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ï¼‰å¤§äºé˜ˆå€¼ï¼Œåˆ™æ›´æ–°é˜ˆå€¼ã€‚")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" largestPoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            largestPoolSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        workerAdded "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä»¥ä¸Šï¼šå¦‚æœçº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯RUNNINGæˆ–è€…çº¿ç¨‹æ± çŠ¶æ€æ˜¯SHUTDOWNä½†æ˜¯ä»»åŠ¡æ˜¯nullçš„è¯ï¼ˆexecuteç¬¬äºŒæ­¥æ‰§è¡Œä¼šæ˜¯nullï¼‰ï¼Œåˆ™æ·»åŠ ä»»åŠ¡åˆ°workersï¼Œä¸”æ ‡è®°workerAdded = true;ä»£è¡¨ä»»åŠ¡æ·»åŠ æˆåŠŸã€‚æœ€åfinallyé‡Œè§£é”")]),s._v("\n                \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//çœŸæ­£çš„å¼€å¯çº¿ç¨‹")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("workerAdded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    workerStarted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ€»ç»“ï¼šå°†ä»»åŠ¡å°è£…æˆworkï¼Œå¹¶å†æ¬¡åˆ¤æ–­poolçŠ¶æ€ï¼Œæœ€åä½¿ç”¨lockå°†workæ·»åŠ è¿›workersé›†åˆä¸­ï¼Œå¹¶çœŸæ­£çš„å¼€å¯çº¿ç¨‹")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" workerStarted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorkerFailed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n    \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" workerStarted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br")])]),t("p",[s._v("è¯¦è§£1")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                   firstTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("ç»“è®ºï¼š")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æœçº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ä¸”ä¸æ˜¯SHUTDOWNçŠ¶æ€ï¼Œåˆ™ç›´æ¥return falseã€‚å¤–å±‚çš„executeä¸åšå¤„ç†æˆ–æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ï¼ˆæ˜¯stopçŠ¶æ€ï¼Œé‚£ä¹ˆç›´æ¥å°±å¯ä»¥ä¸æ·»åŠ äº†ï¼‰")]),s._v(" "),t("li",[s._v("å¦‚æœçº¿ç¨‹æ± æ˜¯SHUTDOWNçŠ¶æ€ï¼Œä¸”æ­¤æ¬¡æœ‰æäº¤æ–°çš„ä»»åŠ¡è¿‡æ¥ï¼ˆæœ€å¤–å±‚æœ‰å–åæ“ä½œï¼‰ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—æ˜¯ç©ºï¼Œåˆ™return falseï¼Œå¤–å±‚çš„executeä¸åšå¤„ç†æˆ–æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ï¼ˆshutdownçŠ¶æ€ä¸å¤„ç†æ–°ä»»åŠ¡ï¼‰")])]),s._v(" "),t("p",[s._v("é—®é¢˜è§£ç­”ï¼š")]),s._v(" "),t("p",[s._v("é—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆå«æ­¤æ¬¡æœ‰æäº¤æ–°çš„ä»»åŠ¡ï¼Ÿ")]),s._v(" "),t("p",[s._v("åœ¨executeæ–¹æ³•é‡Œè°ƒç”¨addWorkerçš„åœ°æ–¹æœ‰ä¸‰ä¸ªï¼š")]),s._v(" "),t("ul",[t("li",[s._v("å¼€å¯æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ŒaddWorker(command, true);")]),s._v(" "),t("li",[s._v("æ ¸å¿ƒçº¿ç¨‹æ»¡äº†ï¼Œä»»åŠ¡é˜Ÿåˆ—æ·»åŠ æˆåŠŸäº†ï¼Œä½†æ˜¯æ ¸å¿ƒçº¿ç¨‹éƒ½è¶…æ—¶äº†ï¼Œå¯¼è‡´çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ä¸º0ï¼ŒaddWorker(null, false);")]),s._v(" "),t("li",[s._v("æ ¸å¿ƒçº¿ç¨‹æ»¡äº†ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ã€‚åˆ™å¼€å¯éæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼ŒaddWorker(command, false);æ‰€ä»¥åœ¨executeä¸­ï¼Œç¬¬2æ­¥å°±å«æ²¡æœ‰æäº¤æ–°çš„ä»»åŠ¡è¿‡æ¥ï¼Œç¬¬1å’Œ3ä¸¤æ­¥å°±å«æœ‰æäº¤æ–°ä»»åŠ¡è¿‡æ¥ï¼Œæ‰€ä»¥æ˜¯åœ¨executeé‡Œæ§åˆ¶çš„ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_3workerç±»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3workerç±»"}},[s._v("#")]),s._v(" â‘¢Workerç±»")]),s._v(" "),t("p",[s._v("Workerä¸»è¦ç”¨æ¥å°è£…çº¿ç¨‹å’Œä»»åŠ¡")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Workerç±»éƒ¨åˆ†æºç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractQueuedSynchronizer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// inhibit interrupts until runWorker")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firstTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThreadFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å…¶ä½™ä»£ç ç•¥...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("Workerç±»å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥Workerä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„ä»»åŠ¡å°±æ˜¯è‡ªå·±ã€‚å½“ä»»åŠ¡æ‰§è¡Œæ—¶å°±ä¼šè°ƒç”¨")]),s._v(" "),t("h3",{attrs:{id:"_4addworkerfailed"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4addworkerfailed"}},[s._v("#")]),s._v(" â‘£addWorkerFailed")]),s._v(" "),t("p",[s._v("å¦‚æœæ·»åŠ ä»»åŠ¡çš„æµç¨‹ä¸­å¤±è´¥äº†æˆ–è€…æ·»åŠ æˆåŠŸäº†ï¼Œä½†æ˜¯æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹å¯åŠ¨å¤±è´¥äº†ï¼Œåˆ™èµ°å¤±è´¥çš„ç­–ç•¥ã€‚é‚£å¤±è´¥çš„ç­–ç•¥åˆ°åº•æ˜¯å•¥å‘¢ï¼Ÿ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorkerFailed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            workers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryTerminate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("å¾ˆç®€å•ï¼Œå°±æ˜¯è¦æŠŠä»»åŠ¡ç§»é™¤ï¼ˆå› ä¸ºå¯èƒ½æ·»åŠ æˆåŠŸäº†ï¼Œåªæ˜¯çº¿ç¨‹å¯åŠ¨å¤±è´¥äº†ï¼Œæ‰€ä»¥è¦removeæ‰ï¼‰ï¼Œè¿˜éœ€è¦å°†çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°-1ï¼ˆctlå˜é‡çš„ä½29ä½ï¼ŒCASçš„æ–¹å¼è¿›è¡Œå‡ä¸€ï¼‰ã€‚")]),s._v(" "),t("p",[s._v("ä¸Šé”çš„ç›®çš„å¾ˆæ¸…æ¥šäº†å§ï¼Ÿworkers.remove(w)æ˜¯å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦ä¸Šé”")]),s._v(" "),t("h3",{attrs:{id:"_5runworker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5runworker"}},[s._v("#")]),s._v(" â‘¤"),t("strong",[s._v("runWorker")])]),s._v(" "),t("p",[s._v("runWorkæ–¹æ³•æ˜¯åœ¨workerä¸­çš„runæ–¹æ³•è°ƒç”¨çš„ï¼Œå³çº¿ç¨‹çœŸæ­£æ‰§è¡Œçš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³•ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" wt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firstTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å“ªå„¿æ¥çš„è§£é”ï¼Ÿè¯·çœ‹è¯¦è§£1")]),s._v("\n        w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" completedAbruptly "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¿™é‡Œçš„å¾ªç¯ä½“é€»è¾‘éå¸¸é‡è¦ï¼Œè¯·çœ‹ è¯¦æƒ…2")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTask")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n               \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* ä¸­æ–­åˆ¤æ–­ï¼š\n                 *\n                 * çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¤§äºç­‰äºSTOPçš„è¯ï¼ˆæ‰§è¡Œäº†shutdownNowï¼‰ï¼Œ\n                 * å¹¶ä¸”ä½ æ²¡æœ‰è¢«ä¸­æ–­è¿‡çš„è¯ï¼ˆ!wt.isInterrupted()ï¼‰ï¼Œåˆ™è®©çº¿ç¨‹ä¸­æ–­ï¼Œ\n                 * ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹æ± çŠ¶æ€éƒ½æ˜¯å¤§äºç­‰äºSTOPçš„äº†ï¼Œé‚£ä¹ˆè®¾ç½®ä¸­æ–­æ ‡è®°ä½ï¼Œå‘Šè¯‰è¿™ä¸ªçº¿ç¨‹è¯´ï¼š\n                 * ä½ å°å­åˆ«æ‰¾äº‹å•Šï¼Œä½ èµ¶ç´§ç»™æˆ‘å›æ¥ï¼Œä½ è¢«å¼€é™¤ï¼ˆä¸­æ–­ï¼‰äº†ã€‚\n */")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å…¶å®ä¹Ÿå°±æ˜¯ï¼šå¦‚æœæ­¤æ—¶çš„çº¿ç¨‹æ± çŠ¶æ€å·²ç»æ˜¯stopäº†ï¼ˆæ¯”shutdownè¿˜å±é™©ï¼‰ï¼Œæ­¤æ—¶å°±")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åº”è¯¥é©¬ä¸Šä¸­æ–­å½“å‰çº¿ç¨‹ã€‚å› ä¸ºstopçŠ¶æ€è¦æ±‚çš„æ˜¯é©¬ä¸Šåœæ‰æ‰€æœ‰çš„çº¿ç¨‹è¿è¡ŒçŠ¶æ€")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateAtLeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateAtLeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("wt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isInterrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    wt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                \n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    \n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åœ¨çº¿ç¨‹ä»»åŠ¡å¼€å§‹æ‰§è¡Œå‰åšä¸€äº›å¤„ç†ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°æ–¹æ³•ã€‚æ¨¡æ¿æ–¹æ³•ã€‚éœ€è¦ ")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ³¨æ„çš„åœ°æ–¹æ˜¯ä»–åªè¢«try finallyåŒ…èµ·æ¥äº†ï¼Œæ²¡æœ‰catchï¼Œä¹Ÿå°±æ˜¯è¯´å¼‚å¸¸")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¼šè¢«åï¼Œå³ä½¿æŠ¥é”™ï¼Œå¦‚æœç”¨æˆ·ä¸åšcatchæ•è·çš„è¯ï¼Œé‚£ä¹ˆå°†ä¸ä¼šå½±å“çº¿ç¨‹ä¸‹")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é¢çš„å·¥ä½œã€‚è¿™å¾ˆå…³é”®ï¼Œå¯¹ä¸‹é¢çš„completedAbruptlyæœ‰å†³å®šæ€§çš„ä½œç”¨ã€‚")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("beforeExecute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    \n                    \n                    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" thrown "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    \n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä½ æäº¤åˆ°çº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡ï¼Œä¸”æ•è·å¼‚å¸¸ã€‚")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        thrown "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        thrown "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        thrown "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åœ¨çº¿ç¨‹ä»»åŠ¡å¼€å§‹æ‰§è¡Œå®Œååšä¸€äº›å¤„ç†ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°æ–¹æ³•ã€‚æ¨¡æ¿æ–¹æ³•ã€‚éœ€è¦  ")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ³¨æ„çš„åœ°æ–¹æ˜¯ä»–åªè¢«try finallyåŒ…èµ·æ¥äº†ï¼ˆæŒ‡çš„æ˜¯ç¬¬äºŒå±‚çš„tryï¼‰ï¼Œæ²¡æœ‰catchï¼Œä¹Ÿå°±æ˜¯è¯´å¼‚å¸¸")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¼šè¢«åï¼Œå³ä½¿æŠ¥é”™ï¼Œå¦‚æœç”¨æˆ·ä¸åšcatchæ•è·çš„è¯ï¼Œé‚£ä¹ˆå°†ä¸ä¼šå½±å“çº¿ç¨‹ä¸‹")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é¢çš„å·¥ä½œã€‚è¿™å¾ˆå…³é”®ï¼Œå¯¹ä¸‹é¢çš„completedAbruptlyæœ‰å†³å®šæ€§çš„ä½œç”¨ã€‚")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("afterExecute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" thrown"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    \n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é¦–å…ˆå¯ä»¥å‘ç°ä¹Ÿæ²¡æœ‰è¢«catchæ•è·ã€‚å…¶æ¬¡å°±æ˜¯ä¸€äº›è¾…åŠ©å·¥ä½œï¼Œæ¯”å¦‚taskå¼„æˆnullæ¥è¾…åŠ©æœ€å¤–å±‚çš„whileå¾ªç¯ï¼Œå®Œæˆçš„ä»»åŠ¡æ•°+1ï¼Œè§£é”çš„å·¥ä½œã€‚")]),s._v("\n\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å‰©ä½™æ²¡è®²çš„ä»£ç è¿˜æœ‰æœ€åä¸€æ®µï¼Œé‚£å°±æ˜¯ï¼šprocessWorkerExitï¼Œå†è¯´è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œå¿…é¡»çœ‹ä¸‹å‰é¢æåˆ°ä¸¤æ¬¡çš„completedAbruptlyæ˜¯ä¸ªä»€ä¹ˆé¬¼ã€‚")]),s._v("\n                    task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("completedTasks"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¾ˆç®€å•ï¼Œå¦‚æœä»»åŠ¡æ­£å¸¸å¾—åˆ°æ‰§è¡Œï¼Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸ï¼Œä»–å°±æ˜¯falseï¼Œå¦‚æœä¸­é€”å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£å°±æ˜¯trueã€‚å…·ä½“å«ä¹‰æ˜¯æ˜¯å¦å‘ç”Ÿäº†ä¸­æ–­ï¼Œè€Œä¸”è¿™ä¸ªä¸­æ–­è¿˜æ˜¯ç”¨æˆ·è‡ªå·±ä¸­æ–­çš„ï¼Œå› ä¸ºæ¯”å¦‚beforeExecuteã€afterExecuteå•¥çš„éƒ½æ˜¯é‡æ–°æ‰å¯èƒ½å‘ç”Ÿå¼‚å¸¸ã€‚è¿™é‡Œå°±ä½“ç°äº†ä¸¤ä¸ªå¯é‡å†™å‡½æ•°çš„ä½œç”¨ï¼Œå³ç”¨æˆ·è®¾ç½®completedAbruptly")]),s._v("\n            completedAbruptly "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯·çœ‹ è¯¦æƒ…3")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processWorkerExit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" completedAbruptly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br")])]),t("p",[s._v("è¯¦è§£1è§£é”ï¼Ÿå¯æœ‰åœ¨å“ªå„¿åŠ é”ï¼Ÿ")]),s._v(" "),t("p",[s._v("ç­”æ¡ˆï¼šè¿™ä¸ªä¸Wokerç±»ä¸­çš„æ–¹æ³•æœ‰å…³")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å“¦è±ï¼Œç»§æ‰¿äº†AQS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractQueuedSynchronizer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®AQSæ˜¯stateä¸º-1ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä¸è®©ä¸­æ–­ã€‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®ä»»åŠ¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firstTask "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" firstTask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºçº¿ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThreadFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("å¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“æ„é€ å™¨é‡Œé¢å¹²äº†ä¸‰ä»¶äº‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œåªå…³æ³¨ç¬¬ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯setState(-1);ï¼Œstateæ˜¯AQSçš„å˜é‡ï¼Œ-1å•¥æ„æ€ï¼Ÿæ²¡å•¥æ„æ€ï¼Œå¾ˆç®€å•ï¼Œå°±æ˜¯è¯´æˆ‘è¿™ä¸ªä»»åŠ¡ä¸å¯ä»¥è¢«ä¸­æ–­ã€‚é‚£ä¸ºå•¥è¦è¿™ä¹ˆè®¾ç½®ï¼ŸåºŸè¯ï¼Œä½ éƒ½æ²¡å¼€å§‹æ‰§è¡Œå‘¢ï¼Œä½ åªæ˜¯newä¸€ä¸ªä»»åŠ¡å‡ºæ¥ï¼Œçº¿ç¨‹éƒ½æ²¡å¯åŠ¨ï¼Œæ€ä¹ˆå¯èƒ½å…è®¸ä¸­æ–­å‘¢ï¼Ÿæç„¶å¤§æ‚Ÿâ€¦ï¼")]),s._v(" "),t("p",[s._v("é‚£å†çœ‹unlockå¹²äº†å•¥ï¼Ÿ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ç‹—æ—¥çš„â€¦ï¼è°ƒç”¨AQSçš„releaseæ–¹æ³•ï¼Œç»™stateé‡Šæ”¾1ï¼Œä¹Ÿå°±æ˜¯è¯´unlockåstateå˜æˆäº†0ï¼Œé€šä¿—ç‚¹å°±æ˜¯ï¼šæˆ‘ç°åœ¨ä»»åŠ¡å¾—åˆ°äº†æ‰§è¡Œï¼Œæˆ‘è¦è®©ä»–å…è®¸ä¸­æ–­äº†ï¼Œæ€ä¹ˆå…è®¸ï¼Ÿå½“ç„¶æ˜¯state=0ï¼Œè¿™éƒ½æ˜¯AQSçš„çŸ¥è¯†ï¼")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ä¸ºå•¥Workerè¦ç»§æ‰¿AQSï¼Ÿå› ä¸ºä»–å·§å¦™çš„è¿ç”¨äº†AQSçš„ä¸­æ–­ã€‚")]),s._v(" "),t("p",[s._v("è¯¦æƒ…2whileå¾ªç¯æ‹¿ä»»åŠ¡")]),s._v(" "),t("p",[s._v("taskä¸€ä¸Šæ¥å°±æ˜¯w.firstTask;ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨addWorkeræ–¹æ³•é‡ŒåŒ…è£…åœ¨Workeré‡Œçš„ä»»åŠ¡ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šä¸æ˜¯nullï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œwhileå¾ªç¯ä½“ï¼Œæ‰§è¡Œå®Œåå†finallyé‡Œç»™taskå¼„æˆäº†nullã€‚æ‰€ä»¥è¿™ä¸ªæ¡ä»¶ä»…åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¸ºtrueï¼Œå› ä¸ºæ¯æ¬¡finallyéƒ½ä¼šæŠŠtaskå¼„æˆnullã€‚")]),s._v(" "),t("p",[s._v("task = getTask()ï¼šä»é˜Ÿåˆ—é‡Œå–ä»»åŠ¡ï¼Œå–å‡ºæ¥åèµ‹å€¼ç»™taskï¼Œå¦‚æœé˜Ÿåˆ—é‡Œæœ‰ä»»åŠ¡å°±æ‰§è¡Œå¾ªç¯ä½“ï¼Œæ‰§è¡Œå®Œæˆåä¼šç»™ä»»åŠ¡ä»é˜Ÿåˆ—é‡Œremoveæ‰ï¼Œå¦‚æœgetTaskè·å–ä¸åˆ°ä»»åŠ¡åˆ™ä¼šé˜»å¡ï¼Œå› ä¸ºåº•å±‚æ˜¯"),t("code",[s._v("BlockingQueue<Runnable>")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("è¯¦æƒ…3processWorkerExit")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processWorkerExit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" completedAbruptly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†æŠ¥é”™ï¼Œåˆ™CASçš„æ–¹å¼æŠŠä»»åŠ¡æ•°-1ã€‚ctlçš„ä½29ä½ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("completedAbruptly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CASçš„æ–¹å¼å°†ä»»åŠ¡æ•°-1ã€‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸Šé” ä¿è¯å°†ä»»åŠ¡ç§»é™¤é˜Ÿåˆ—çš„çº¿ç¨‹å®‰å…¨ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        completedTaskCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("completedTasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†ä»»åŠ¡ç§»é™¤é˜Ÿåˆ—ï¼Œå› ä¸ºä»»åŠ¡å·²ç»æ‰§è¡Œå®Œäº†å˜›")]),s._v("\n        workers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è§£é”")]),s._v("\n        mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é’©å­å‡½æ•°,åœ¨çº¿ç¨‹æ‰§è¡Œä¸­å› é”™è¯¯è¿˜è°ƒç”¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryTerminate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n     * ä¸‹é¢è¿™æ®µä»£ç çš„å«ä¹‰æ˜¯å¦‚æœçº¿ç¨‹æ± æ˜¯RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€çš„è¯ï¼Œ\n     * ä¸”ä»»åŠ¡é¡ºåˆ©å®Œæˆï¼ˆcompletedAbruptly=falseï¼‰çš„è¯ï¼Œé‚£ä¹ˆåˆ¤æ–­æ˜¯å¦è®¾ç½®äº†å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶\n     * å¦‚æœå…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ç­‰äºç©ºçš„è¯ï¼Œé‚£ä¹ˆå¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚\n     * \n     * ä¸€è¨€ä»¥è”½ä¹‹ï¼šå¦‚æœçº¿ç¨‹æ± æ˜¯RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€çš„è¯ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸æ˜¯ç©ºï¼Œé‚£ä¹ˆè‡³å°‘ä¿è¯çº¿ç¨‹æ± ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateLessThan")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("completedAbruptly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" min "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" allowCoreThreadTimeOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                min "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" min"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[s._v("ä¸Šé¢å°†äº†è¿™ä¹ˆå¤šï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹runWorker")]),s._v(" "),t("ul",[t("li",[s._v("å…ˆunlockè°ƒç”¨AQSçš„releaseæ–¹æ³•ï¼Œè®©ä»»åŠ¡å¯ä¸­æ–­ã€‚ï¼ˆå› ä¸ºä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼Œå¯ä»¥ä¸­æ–­äº†ï¼‰")]),s._v(" "),t("li",[s._v("whileå¾ªç¯æ‹¿ä»»åŠ¡ï¼Œæ²¡ä»»åŠ¡å°±é˜»å¡ï¼Œé‡‡å–çš„BlockingQueueçš„é˜»å¡api")]),s._v(" "),t("li",[s._v("ä¸­æ–­åˆ¤æ–­ï¼Œçº¿ç¨‹æ± çŠ¶æ€æ˜¯å¤§äºç­‰äºSTOPçš„è¯ï¼ˆæ‰§è¡Œäº†shutdownNowï¼‰ï¼Œå°±è®©çº¿ç¨‹ä¸­æ–­")]),s._v(" "),t("li",[s._v("çº¿ç¨‹æ‰§è¡Œå‰ä¼šå…ˆæ‰§è¡ŒbeforeExecuteï¼Œå¯é‡å†™")]),s._v(" "),t("li",[s._v("çœŸæ­£çš„ä»»åŠ¡æ‰§è¡Œ")]),s._v(" "),t("li",[s._v("çº¿ç¨‹æ‰§è¡Œå‰ä¼šå…ˆæ‰§è¡ŒafterExecuteï¼Œå¯é‡å†™")]),s._v(" "),t("li",[s._v("æ‰§è¡Œå®Œæˆåå°†ä»»åŠ¡ä»workersé‡Œremoveæ‰")]),s._v(" "),t("li",[s._v("å¦‚æœçº¿ç¨‹æ± æ˜¯RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€çš„è¯ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸æ˜¯ç©ºï¼Œé‚£ä¹ˆè‡³å°‘ä¿è¯çº¿ç¨‹æ± ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡")])]),s._v(" "),t("h3",{attrs:{id:"_6gettask-çº¿ç¨‹è·å–ä»»åŠ¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6gettask-çº¿ç¨‹è·å–ä»»åŠ¡"}},[s._v("#")]),s._v(" â‘¥getTask çº¿ç¨‹è·å–ä»»åŠ¡")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTask")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" timedOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯¦è§£1")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" timed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" allowCoreThreadTimeOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" corePoolSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" maximumPoolSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" timedOut"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndDecrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯¦æƒ…2")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n                    workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keepAliveTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NANOSECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n                    workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æŒ‡å®šæ—¶é—´è·å–å¤±è´¥ï¼Œr==null")]),s._v("\n                timedOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                timedOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("è¯¦è§£1timed")]),s._v(" "),t("p",[s._v("boolean timed = allowCoreThreadTimeOut || wc > corePoolSize;")]),s._v(" "),t("ul",[t("li",[s._v("å¦‚æœè®¾ç½®äº†æ ¸å¿ƒçº¿ç¨‹å…è®¸è¶…æ—¶çš„è¯ï¼Œåˆ™timed=trueï¼Œåä¹‹falseã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœçº¿ç¨‹æ± ä¸­æ´»è·ƒçº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™timed=trueï¼Œåä¹‹falseã€‚")])]),s._v(" "),t("p",[s._v("timedå¹²å•¥ç”¨çš„ï¼Ÿä¸æ˜¯å‚»å­çš„è¯éƒ½è¯¥çœ‹å‡ºæ¥äº†ï¼Œé‡Šæ”¾çº¿ç¨‹ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´éæ ¸å¿ƒçº¿ç¨‹ï¼ˆå¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°äº†ï¼‰è¦è¢«é‡Šæ”¾ï¼Œå…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶çš„è¯ä¹Ÿè¦è¢«é‡Šæ”¾ã€‚")]),s._v(" "),t("p",[s._v("è¯¦æƒ…2é‡Šæ”¾çº¿ç¨‹")]),s._v(" "),t("p",[s._v("Runnable r = timed ?workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS)  :workQueue.take();")]),s._v(" "),t("p",[s._v("å¦‚æœtimedæ˜¯trueï¼Œé‚£ä¹ˆèµ°workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS)ä¹Ÿå°±æ˜¯è®¾ç½®è·å–ä»»åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œåˆ°æ—¶é—´åè¿˜æ²¡è·å–åˆ°ä»»åŠ¡çš„è¯åˆ™ä¼štimeOut=trueã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯¦æƒ…2")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n                 workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keepAliveTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NANOSECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n                 workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æŒ‡å®šæ—¶é—´è·å–å¤±è´¥ï¼Œr==null")]),s._v("\n                timedOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                timedOut "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("timeOut=trueçš„è¯ï¼ŒgetTaskæœ‰ä¸ªåˆ¤æ–­ä¼šè®©å…¶è·³å‡ºå¾ªç¯ï¼Œçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¹Ÿè‡ªç„¶è€Œç„¶çš„éšä¹‹ç»“æŸã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" maximumPoolSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" timedOut"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndDecrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("åä¹‹å¦‚æœtimedæ˜¯falseçš„è¯ï¼Œé‚£ä¹ˆä¼šæ‰§è¡ŒworkQueue.take();ä¸å¸¦è¶…æ—¶æ—¶é—´çš„ï¼Œåˆ™ä¸€ç›´é˜»å¡ç­‰å¾…æœ‰ç»“æœè¿”å›ã€‚")]),s._v(" "),t("p",[s._v("å…¶å®å°±æ˜¯ï¼š"),t("strong",[s._v("ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœtimedæ˜¯trueçš„è¯ï¼Œåˆ™è°ƒç”¨é˜»å¡é˜Ÿåˆ—çš„pollæ–¹æ³•é˜»å¡ä¸€æ®µæ—¶é—´è·å–ä»»åŠ¡ï¼Œè¿™æ®µæ—¶é—´æ²¡ä»»åŠ¡çš„è¯ï¼Œåˆ™è¶…æ—¶è®¾ç½®timeOut=trueï¼Œç»“æŸç”Ÿå‘½å‘¨æœŸã€‚å¦åˆ™è°ƒç”¨take()æ–¹æ³•ä¸€ç›´é˜»å¡ç­‰å¾…ä»»åŠ¡åˆ°æ¥ï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¸ºä»€ä¹ˆèƒ½ä¸€ç›´å­˜æ´»çš„åŸå› ã€‚")])]),s._v(" "),t("p",[s._v("ä¹Ÿå°±æ˜¯ä¼šæ ¹æ®allowCoreThreadTimeOutæ˜¯å¦ä¸ºçœŸï¼Œå¦‚æœä¸ºçœŸï¼Œè¡¨ç¤ºæ ¸å¿ƒçº¿ç¨‹ä¸éæ ¸å¿ƒçº¿ç¨‹ä¸€æ ·ï¼Œåªè¦è¶…æ—¶å°±ä¼šåˆ é™¤å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±é€šè¿‡poll(time)çš„æ–¹å¼å»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå¦‚æœä¸ºfalseï¼Œè¡¨ç¤ºæ ¸å¿ƒçº¿ç¨‹ä¸ä¼šä¸»åŠ¨åˆ é™¤ï¼Œé‚£ä¹ˆå½“å‰å°±éœ€è¦åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ•°æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœå¤§äºåˆ™ç”¨poll(time)ï¼Œå¦‚æœå°äºï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å±äºæ ¸å¿ƒçº¿ç¨‹çš„èŒƒç•´ï¼Œåˆ™æ‰ç”¨takeæ°¸ä¹…ç­‰å¾…")]),s._v(" "),t("h3",{attrs:{id:"_7shutdonw"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7shutdonw"}},[s._v("#")]),s._v(" â‘¦shutdonw()")]),s._v(" "),t("p",[s._v("CASå°†çº¿ç¨‹æ± çŠ¶æ€è®¾ä¸ºSHUTDOWN->éå†ç©ºé—²çº¿ç¨‹å¹¶è¿›è¡Œä¸­æ–­->è°ƒç”¨é’©å­æ–¹æ³•->tryTerminate")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åŠ é”ï¼šé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶shutdown")]),s._v("\n        mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkShutdownAccess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//JVMæƒé™ç›¸å…³ï¼Œå¯ä»¥ä¸çœ‹")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("advanceRunState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯¦è§£1")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIdleWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯¦è§£2")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é’©å­å‡½æ•°ï¼Œé»˜è®¤æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œæ¨¡æ¿æ–¹æ³•ï¼ŒæŒ‰éœ€é‡å†™ã€‚å°±æ˜¯åœ¨çº¿ç¨‹æ± shutdownåå¯ä»¥è‡ª             //å®šä¹‰ä¸€äº›æ“ä½œã€‚æ¯”å¦‚ScheduledThreadPoolExecutoræ˜¯ThreadPoolExecutorçš„            //å­ç±»ï¼Œä»–å°±é‡å†™äº†onShutdownæ–¹æ³•æ¥åšä¸€äº›è‡ªå®šä¹‰çš„äº‹æƒ…")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("onShutdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryTerminate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯·çœ‹ è¯¦æƒ…4")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("è¯¦è§£1 advanceRunState(SHUTDOWN) :å°±æ˜¯é€šè¿‡CASè‡ªæ—‹çš„æ–¹å¼ç»™çº¿ç¨‹æ± çŠ¶æ€è®¾ç½®ä¸ºSHUTDOWNã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("advanceRunState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" targetState"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateAtLeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" targetState"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ctlOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("targetState"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("å¾ˆç®€å•ï¼Œå°±æ˜¯æ¯”å¤§å°ã€‚åœ¨è¿™é‡Œå°±æ˜¯æˆ‘åˆ¤æ–­æˆ‘çº¿ç¨‹æ± ç›®å‰çš„çŠ¶æ€æ˜¯ä¸æ˜¯å¤§äºç­‰äºä¼ é€’è¿›æ¥çš„çº¿ç¨‹æ± çŠ¶æ€ï¼ˆSHUTDOWNï¼‰ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ± çŠ¶æ€æ¯”SHUTDOWNè¿˜å¤§ï¼Œé‚£å°±ç›´æ¥æ˜¯trueï¼Œæ²¡å¿…è¦è¿›è¡Œåé¢çš„CASäº†ï¼Œç›´æ¥breakå°±å®Œäº‹äº†ã€‚")]),s._v(" "),t("p",[s._v("è¯¦è§£2 interruptIdleWorkers()")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIdleWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIdleWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * trueï¼šåªä¸­æ–­å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œ falseï¼šforå¾ªç¯éå†å…¨éƒ¨çº¿ç¨‹ï¼Œé€ä¸ªä¸­æ–­ï¼Œæ— ä¸€å¹¸å…ã€‚\n * å¯ä»¥çœ‹åˆ°if (onlyOne) break;ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯trueï¼Œç¬¬ä¸€è½®foråå°±breakäº†ï¼Œåªä¸­æ–­ä¸€ä¸ªã€‚\n **/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIdleWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" onlyOne"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é˜²æ­¢å¹¶å‘")]),s._v("\n        mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¾ˆç®€å•ï¼Œå°±æ˜¯éå†å½“å‰çº¿ç¨‹æ± çš„å…¨éƒ¨ä»»åŠ¡ï¼Œç„¶åè·å–ä»»åŠ¡çš„çº¿ç¨‹ï¼Œé€ä¸ªè¿›è¡Œinterruptä¸­æ–­ã€‚")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" workers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯·çœ‹ è¯¦æƒ…3 é‡ç‚¹ï¼ï¼")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isInterrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityException")]),s._v(" ignore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("onlyOne"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æœ€åå°±æ˜¯ä¸­æ–­å’Œfinallyè§£é”å•¦ã€‚")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è§£é”è¿˜æœ‰ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼šå°±æ˜¯éœ€è¦è§£workerçš„é”ï¼š")]),s._v("\n            mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("è¯¦æƒ…3ï¼šif (!t.isInterrupted() && w.tryLock()) {...}")]),s._v(" "),t("p",[s._v("å¾ˆå·§å¦™ï¼ŒtryLockæ‰¿ä¸Šå¯ä¸‹ï¼Œå·§å¦™çš„ä¸€é€¼ï¼")]),s._v(" "),t("p",[s._v("é¦–å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯è¢«ä¸­æ–­è¿‡äº†ï¼Œå¦‚æœå·²ç»è¢«ä¸­æ–­äº†ï¼Œåˆ™ä¸‹ä¸€è½®å¾ªç¯ï¼Œå¦‚æœæ²¡è¢«ä¸­æ–­ä¸”w.tryLock()æˆåŠŸï¼Œåˆ™è¿›è¡Œä¸­æ–­ã€‚")]),s._v(" "),t("p",[s._v("w.tryLock()æ˜¯ä½•æ„ï¼Ÿä¸‹é¢åˆ†æä¹Ÿè¡¨æ˜Workerä¸ºå•¥è¦ç»§æ‰¿AQSäº†ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" unused"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSetState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setExclusiveOwnerThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("å¯ä»¥çœ‹åˆ°tryLockå¾ˆç®€å•ï¼Œå°±å¹²ä¸€ä»¶äº‹ï¼Œå°±æ˜¯å°†stateè®¾ç½®ä¸º1ï¼Œå¦‚æœè®¾ç½®å¤±è´¥ï¼Œåˆ™return falseï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šèµ°åˆ°ifé‡Œé¢ï¼Œä¸ä¼šè¿›è¡Œä¸­æ–­çº¿ç¨‹ã€‚å¦‚æœè®¾ç½®æˆåŠŸäº†åˆ™è¿›è¡Œä¸­æ–­çº¿ç¨‹ã€‚"),t("strong",[s._v("è¿™ä¸ªtryLockæ˜¯ç‚¹ç›ä¹‹ç¬”ï¼Œç”¨äºåˆ¤æ–­æ­¤çº¿ç¨‹æ˜¯ä¸æ˜¯ç©ºé—²çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ç©ºé—²çº¿ç¨‹åˆ™è¿›è¡Œä¸­æ–­ï¼Œå› ä¸ºçº¿ç¨‹æ± SHUTDOWNäº†å˜›ï¼Œç©ºé—²çº¿ç¨‹è‚¯å®šè¦å›æ”¶ã€‚")])]),s._v(" "),t("p",[s._v("ä»€ä¹ˆæƒ…å†µä¸‹tryLockä¼šå¤±è´¥ï¼Ÿ")]),s._v(" "),t("p",[s._v("è¿™è¦å›æº¯åˆ°runWorkeræ–¹æ³•ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runWorker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTask")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("çœ‹åˆ°äº†æ²¡ï¼Œæˆ‘å…ˆgetTask()é˜»å¡å¼è·å–ä»»åŠ¡ï¼Œå¦‚æœæ²¡è·å–åˆ°ï¼Œè‚¯å®šæ˜¯é˜»å¡äº†ï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œåˆ™ç»™è¿™ä¸ªä»»åŠ¡ä¸Šé”ï¼Œä¸Šé”è§£é”éƒ½å¹²å˜›äº†ï¼Ÿ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("acquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("ç¥ä»–å¦ˆé€»è¾‘ï¼Œå°±æ˜¯ç»™state+1ï¼Œstate-1çš„æ“ä½œã€‚å¤§å½»å¤§æ‚Ÿï¼Œå¦‚æœå½“å‰çº¿ç¨‹è·å–åˆ°äº†ä»»åŠ¡ï¼Œåˆ™interruptIdleWorkers#tryLockè‚¯å®šå¤±è´¥ï¼Œå› ä¸ºè·å–åˆ°ä»»åŠ¡åå·²ç»æŠ¢å é”äº†ï¼Œä»£è¡¨å½“å‰workeråˆ°çº¿ç¨‹æ˜¯æ´»è·ƒçº¿ç¨‹ï¼Œä¸æ˜¯ç©ºé—²çº¿ç¨‹ï¼Œä¸å¯è¢«ä¸­æ–­ã€‚å¦‚æœæ²¡è·å–ä»»åŠ¡ï¼Œé˜»å¡åœ¨getTaské‚£é‡Œäº†ï¼Œé‚£è‚¯å®šæ˜¯æ²¡ä¸Šé”çš„ï¼Œé‚£tryLockè‚¯å®šä¼šè¿”å›trueï¼Œä»£è¡¨è¿™ä¸ªçº¿ç¨‹æ•°ç©ºé—²çº¿ç¨‹ï¼Œå¯ä»¥è¢«ä¸­æ–­ã€‚"),t("strong",[s._v("ä¸­æ–­çº¿ç¨‹åï¼Œæ­¤çº¿ç¨‹åœ¨getTaskä¼šç«‹å³ä¸åœ¨é˜»å¡ï¼Œå‘ç”ŸInterruptedExceptionï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç»ˆæ­¢é‚£äº›æ­£åœ¨æ‰§è¡ŒworkQueue.take()æ–¹æ³•çš„å·¥ä½œçº¿ç¨‹")]),s._v(".")]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ–¹æ³•å°±æ˜¯ï¼šä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼Œå¾ˆåˆç†ï¼Œå› ä¸ºéƒ½SHUTDOWNäº†ï¼Œä¸æ¥æ”¶æ–°ä»»åŠ¡äº†ï¼Œç©ºé—²çš„çº¿ç¨‹æ²¡å•¥ç”¨äº†ã€‚**ä½†æ˜¯æ€ä¹ˆç¡®å®šå½“å‰çº¿ç¨‹æ˜¯ä¸æ˜¯ç©ºé—²çº¿ç¨‹çš„ï¼Œè¿™å°±å¾ˆå·§å¦™ï¼Œå·§å¦™çš„è¿ç”¨äº†AQSçš„stateçŠ¶æ€ä½ã€‚åœ¨runWorkeré‡Œæ‰¿ä¸Šå¯ä¸‹ã€‚åªæ˜¯ä¸­æ–­äº†ç©ºé—²çº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—æ˜¯é¥±æ»¡çŠ¶æ€ï¼Œçº¿ç¨‹å¿™ä¸è¿‡æ¥çš„è¯å°±ä¸ä¼šä¸­æ–­ä»»ä½•çº¿ç¨‹ï¼Œ ä¼šç­‰æ‰§è¡Œå®Œworkersç­‰ä»»åŠ¡ã€‚**è¿™å°±æ˜¯SHUTDOWNã€‚")]),s._v(" "),t("p",[s._v("æ€»ç»“ï¼šåœ¨workeråˆšåˆšåˆ›å»ºæ—¶ï¼Œå…¶state=-1ï¼Œå½“çœŸæ­£çš„åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œå…¶state=0ï¼Œå½“å…¶çœŸæ­£çš„æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œstate=1ï¼Œç©ºé—²çº¿ç¨‹æ—¶ï¼Œå…¶state=0ã€‚shutdownä¼šæ‰“æ–­æ‰€æœ‰state=0çš„ç©ºé—²çº¿ç¨‹")]),s._v(" "),t("h3",{attrs:{id:"_8shutdownnow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8shutdownnow"}},[s._v("#")]),s._v(" "),t("strong",[s._v("â‘§shutdownNow()")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdownNow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é˜²æ­¢å¹¶å‘é—®é¢˜")]),s._v("\n        mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¯å¿½ç•¥")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkShutdownAccess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è®¾ç½®çŠ¶æ€ä½ä¸ºstop")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("advanceRunState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯·çœ‹ è¯¦è§£1")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯·çœ‹ è¯¦è§£2")]),s._v("\n            tasks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("drainQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryTerminate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("è¯¦è§£1interruptWorkers();")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¾ªç¯å…¨éƒ¨ä»»åŠ¡ï¼Œé€ä¸ªä¸­æ–­ã€‚")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker")]),s._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" workers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                w"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIfStarted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIfStarted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åªè¦çº¿ç¨‹çŠ¶æ€æ˜¯å¤§äºç­‰äº0çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´è°ƒç”¨äº†çº¿ç¨‹çš„startæ–¹æ³•ï¼Œå› ä¸ºnew Workerçš„æ—¶å€™state=-1ï¼Œå½“startæ—¶ï¼Œstate=0ï¼‰ï¼Œ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ï¼Œé‚£å°±ä¸­æ–­ï¼Œ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isInterrupted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interrupt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityException")]),s._v(" ignore"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("ä¸å†åƒshutdowné‚£ä¹ˆå‹å¥½ï¼Œåªä¸­æ–­ç©ºé—²çº¿ç¨‹ï¼ŒshutdownNowçš„interruptWorkersä¼šä¸­æ–­å…¨éƒ¨çº¿ç¨‹ã€‚å¤§æ¦‚åŸç†å°±æ˜¯ï¼šå¾ªç¯éå†çº¿ç¨‹æ± ä¸­çš„å…¨éƒ¨ä»»åŠ¡ï¼Œå¦‚æœè¿™äº›ä»»åŠ¡çš„çº¿ç¨‹çŠ¶æ€æ˜¯å¤§äºç­‰äº0çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´è°ƒç”¨äº†çº¿ç¨‹çš„startæ–¹æ³•ï¼Œå› ä¸ºnew Workerçš„æ—¶å€™state=-1ï¼‰ï¼Œä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ï¼Œé‚£å°±ä¸­æ–­ï¼Œä¸­æ–­ågetTaskä¼šæŠ›å‡ºä¸€ä¸ªä¸­æ–­å¼‚å¸¸ï¼Œé¡ºå¸¦å¯ä»¥åœæ­¢é‚£äº›æ­£åœ¨æ‰§è¡ŒworkQueue.take()æ–¹æ³•çš„å·¥ä½œçº¿ç¨‹ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ç²—æš´ï¼")]),s._v(" "),t("p",[s._v("è¯¦è§£2drainQueue()")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("drainQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å½“å‰çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockingQueue")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" q "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœ€ç»ˆè¿”å›çš„ç»“æœ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" taskList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ”¾åˆ°ArrayList<Runnable>é‡Œé¢ï¼Œæ¯æ”¾æˆåŠŸä¸€ä¸ªå°±ä»qä¸­ç§»é™¤ä¸€ä¸ª")]),s._v("\n  q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("drainTo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("taskList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ‰§è¡Œå®ŒdrainToåï¼Œqè¿˜ä¸æ˜¯ç©ºçš„ï¼Œè¿™æ˜¯å•¥æƒ…å†µï¼Ÿ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. ä¸Šé¢æŠ¥é”™äº†ï¼ŒæŒ‰é“ç†æ¥è®²æŠ¥é”™åå°±è·³å‡ºæ–¹æ³•äº†ï¼Œæ‰€ä»¥ä¸æ˜¯æ­¤ç§å¯èƒ½ã€‚")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. ä¸ºäº†å»¶è¿Ÿé˜Ÿåˆ—æ¥çš„ï¼Œå»¶è¿Ÿé˜Ÿåˆ—æ²¡æœ‰æ”¾è¿›å»ArrayList<Runnable>åå°†ä»»åŠ¡ä»è€é˜Ÿåˆ—ç§»é™¤çš„æ“ä½œï¼Œæ‰€ä»¥å»¶è¿Ÿé˜Ÿåˆ—çš„è¯å°±æ‰‹åŠ¨for")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toArray")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        taskList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿”å›æœ€ç»ˆçš„ä»»åŠ¡List")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" taskList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("çœ‹æ³¨é‡Šå°±è¡Œäº†ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š")]),s._v(" "),t("p",[s._v("1.ç›´æ¥è¿”å›"),t("code",[s._v("BlockingQueue<Runnable>")]),s._v("ä¸è¡Œå˜›ï¼Ÿä¸ºå•¥è¿˜è¦è½¬æˆArrayListè¿”å›ï¼Ÿ")]),s._v(" "),t("p",[s._v("shutdownNowåè‚¯å®šè¦æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—çš„ï¼Œshutdownä¸éœ€è¦æ¸…ç©ºæ˜¯å› ä¸ºä»–éƒ½ä¼šæ‰§è¡Œå®Œã€‚æ‰€ä»¥è¾¹æ¸…ç©ºè¾¹æ”¾åˆ°ä¸€ä¸ªListé‡Œï¼Œç»Ÿä¸€è¿”å›ç±»å‹ã€‚")]),s._v(" "),t("p",[s._v("2.éƒ½drainToäº†ï¼Œä¸ºå•¥è¿˜è¦å†æ¬¡åˆ¤ç©ºï¼Œæ‰‹åŠ¨remove/addï¼Ÿ")]),s._v(" "),t("p",[s._v("å› ä¸ºçº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯ç”¨æˆ·è‡ªå®šä¹‰ä¼ å‚çš„ï¼Œé˜Ÿåˆ—ä¸åŒï¼ŒdrainToçš„å®ç°æ–¹æ¡ˆä¸åŒï¼Œå¦‚æœæ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„è¯æ˜¯ä¸å…·å¤‡åˆ é™¤åŠŸèƒ½çš„ï¼Œæ‰€ä»¥æ‰‹åŠ¨remove/addã€‚")]),s._v(" "),t("p",[s._v("å°æ€»ç»“ï¼š")]),s._v(" "),t("p",[s._v("å’Œshutdownå¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š")]),s._v(" "),t("ul",[t("li",[s._v("shutdownNowæ²¡æœ‰onShutdowné’©å­å‡½æ•°ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯å› ä¸ºshutdownNowä»£è¡¨å¾ˆç´§æ€¥ï¼Œæˆ‘æŠŠæœªå®Œæˆçš„ä»»åŠ¡éƒ½ç»™ä½ ï¼Œç´§æ€¥å…³é—­å°±è¡Œäº†ï¼Œä¸æ”¯æŒé’©å­ã€‚è€Œshutdownæ¯”è¾ƒä¼˜é›…ï¼Œä¸ç´§ä¸æ…¢çš„ï¼Œæ”¯æŒé’©å­è‡ªå®šä¹‰ä¸€äº›ä¸œè¥¿ã€‚")]),s._v(" "),t("li",[s._v("shutdownNowä¸­æ–­å…¨éƒ¨çº¿ç¨‹ï¼Œshutdownåªä¸­æ–­ç©ºé—²çº¿ç¨‹ï¼Œå¿™ç€çš„çº¿ç¨‹ä¼šç­‰å¤„ç†å®Œä»»åŠ¡åœ¨ä¸­æ–­ã€‚")]),s._v(" "),t("li",[s._v("shutdownæ²¡æœ‰è¿”å›å€¼ï¼ŒshutdownNowä¼šæŠŠå½“å‰ä»»åŠ¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡è½¬æˆ"),t("code",[s._v("ArrayList<Runnable>")]),s._v("è¿”å›å›å»ã€‚")]),s._v(" "),t("li",[s._v("shutdownæ”¯æŒonShutdowné’©å­å‡½æ•°ï¼ŒshutdownNowä¸æ”¯æŒã€‚")]),s._v(" "),t("li",[s._v("shutdownç»™çº¿ç¨‹æ± çŠ¶æ€è®¾ç½®ä¸ºSHUTDOWNï¼ŒshutdownNowç»™çº¿ç¨‹æ± çŠ¶æ€è®¾ç½®ä¸ºSTOPã€‚")]),s._v(" "),t("li",[s._v("shutdownç»ˆç»“çš„åªæ˜¯ç©ºé—²çº¿ç¨‹ï¼Œéç©ºé—²çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼ˆå¯èƒ½è¿˜ä¼šå»æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼‰")])]),s._v(" "),t("p",[s._v("åœ¨getTaskä¸­")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STOP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrementWorkerCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nä»…å½“rs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v("ï¼Œæ˜¯ä¸ä¼šç›´æ¥è¿”å›"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("çš„ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹è¿˜å¯ä»¥ç»§ç»­åˆ°é˜Ÿåˆ—ä¸­æ‹¿åˆ°æ•°æ®\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_9tryterminate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9tryterminate"}},[s._v("#")]),s._v(" "),t("strong",[s._v("â‘¨tryTerminate()")])]),s._v(" "),t("p",[s._v("è¿™ä¸ªæ–¹æ³•å°±å¹²äº†ä¸€ä»¶äº‹ï¼šè®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºTERMINATEDçŠ¶æ€ä¸”å”¤é†’è°ƒç”¨ awaitTermination() æ–¹æ³•çš„çº¿ç¨‹ã€‚")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryTerminate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è‡ªæ—‹")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è·å–æœ€æ–°ctlå€¼")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ¡ä»¶ä¸€ï¼šisRunning(c)  æˆç«‹ï¼Œç›´æ¥è¿”å›å°±è¡Œï¼Œçº¿ç¨‹æ± å¾ˆæ­£å¸¸ï¼")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ¡ä»¶äºŒï¼šrunStateAtLeast(c, TIDYING) è¯´æ˜ å·²ç»æœ‰å…¶å®ƒçº¿ç¨‹ åœ¨æ‰§è¡Œ TIDYING -> TERMINATEDçŠ¶æ€äº†,å½“å‰çº¿ç¨‹ç›´æ¥å›å»ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ¡ä»¶ä¸‰ï¼š(runStateOf(c) == SHUTDOWN && ! workQueue.isEmpty())")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//SHUTDOWNç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œç›´æ¥å›å»ã€‚å¾—ç­‰é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¤„ç†å®Œæ¯•åï¼Œå†è½¬åŒ–çŠ¶æ€ã€‚")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRunning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateAtLeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TIDYING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHUTDOWN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" workQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ¡ä»¶æˆç«‹ï¼šå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ > 0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("workerCountOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸­æ–­ä¸€ä¸ªç©ºé—²çº¿ç¨‹ï¼Œæ³¨æ„æ˜¯ä¸€ä¸ªï¼Œä¸æ˜¯å…¨éƒ¨ï¼Œå› ä¸ºONL_YONEæ˜¯trueï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä¸­æ–­ä¿¡å·,å”¤é†’é˜»å¡çš„çº¿ç¨‹(getTask()é˜»å¡çš„) ")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¸ºä»€ä¹ˆåªä¸­æ–­å…¶ä¸­ä¸€ä¸ªç©ºé—²çº¿ç¨‹è€Œä¸æ˜¯å…¨éƒ¨å‘¢ï¼Ÿ")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åŸå› å°±æ˜¯å› ä¸ºtryTerminateæ–¹æ³•ä¸æ˜¯åªæœ‰åœ¨shutdownçš„æ—¶å€™æ‰ä¼šè°ƒç”¨ï¼Œè€Œæ˜¯åœ¨è¿è¡Œå®Œä»»åŠ¡å")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//processWorkerExité‡Œé¢ä¹Ÿä¼šè°ƒç”¨ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰§è¡Œå®Œä»»åŠ¡éƒ½ä¼šè°ƒç”¨ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¸­æ–­å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ã€‚")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("interruptIdleWorkers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ONLY_ONE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è·å–çº¿ç¨‹æ± å…¨å±€é”")]),s._v("\n    mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºTIDYINGçŠ¶æ€ã€‚")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ctlOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TIDYING")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è°ƒç”¨é’©å­æ–¹æ³•ï¼Œé»˜è®¤ç©ºæ–¹æ³•ï¼Œéœ€è¦è‡ªå·±é‡å†™ã€‚")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("terminated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºTERMINATEDçŠ¶æ€ã€‚")]),s._v("\n          ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ctlOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TERMINATED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å”¤é†’è°ƒç”¨ awaitTermination() æ–¹æ³•çš„çº¿ç¨‹ã€‚")]),s._v("\n          termination"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("signalAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//é‡Šæ”¾çº¿ç¨‹æ± å…¨å±€é”ã€‚")]),s._v("\n      mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br")])]),t("h3",{attrs:{id:"_10awaittermination"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10awaittermination"}},[s._v("#")]),s._v(" â‘©awaitTermination()")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awaitTermination")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" nanos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),s._v(" mainLock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœå½“å‰çº¿ç¨‹æ± çŠ¶æ€å¤§äºç­‰äºTERMINATEDäº†ï¼Œä¹Ÿå°±æ˜¯è¯´å·²ç»è¢«terminatedäº†ï¼Œåˆ™ç›´æ¥è¿”å›true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateAtLeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TERMINATED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœè¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œå·²ç»è¶…æ—¶ï¼Œåˆ™è¿”å›false")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nanos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡ç½®è·ç¦»è¶…æ—¶æ—¶é—´çš„å‰©ä½™æ—¶é•¿")]),s._v("\n      nanos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" termination"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awaitNanos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nanos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    mainLock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runStateAtLeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("åœ¨è¿™é‡Œå°±æ˜¯å¦‚æœå½“å‰çº¿ç¨‹æ± çŠ¶æ€å¤§äºç­‰äºTERMINATEDäº†ï¼Œä¹Ÿå°±æ˜¯è¯´å·²ç»è¢«terminatedäº†ï¼Œåˆ™ç›´æ¥è¿”å›trueã€‚")]),s._v(" "),t("p",[s._v("å¦‚æœè¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œå·²è¶…æ—¶ï¼Œåˆ™è¿”å›falseï¼Œå¦åˆ™å°±ç­‰å¾…ï¼Œé‡ç½®è·ç¦»è¶…æ—¶æ—¶é—´çš„å‰©ä½™æ—¶é•¿ã€‚åŒæ—¶awaitNanosä¹Ÿä¼šè¢«tryTerminationå”¤é†’ã€‚")]),s._v(" "),t("h2",{attrs:{id:"å››-å…¶ä»–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››-å…¶ä»–"}},[s._v("#")]),s._v(" å››.å…¶ä»–")]),s._v(" "),t("h3",{attrs:{id:"_1-æ³¨æ„æœ‰è¿”å›å€¼çš„ä»»åŠ¡æäº¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ³¨æ„æœ‰è¿”å›å€¼çš„ä»»åŠ¡æäº¤"}},[s._v("#")]),s._v(" 1. æ³¨æ„æœ‰è¿”å›å€¼çš„ä»»åŠ¡æäº¤")]),s._v(" "),t("p",[s._v("executeæäº¤çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œå‡ºç°äº†å¼‚å¸¸ï¼Œæ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°æ§åˆ¶å°çš„ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/29475739/1668346308510-8cdd3118-6c48-47b7-a758-71050a29e361.png",alt:"img"}})]),s._v(" "),t("p",[s._v("ä½†æ˜¯å¯¹äºsubmitæäº¤å¯¹çš„ä»»åŠ¡ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå¦‚æœä¸å»è·å¾—ç»“æœFutureï¼Œå¼‚å¸¸å°±ä¼šè¢«åæ‰ï¼Œä¸ä¼šæ‰“å°åˆ°æ§åˆ¶å°ï¼ï¼ï¼"),t("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/29475739/1668346385307-a424056a-2858-43bf-8393-0ce475f90020.png",alt:"img"}})]),s._v(" "),t("p",[s._v("è¿™é‡Œæ˜¯FutureTaské‡Œçš„runæ–¹æ³•ï¼Œç†æ¸…æ¥šæœ‰è¿”å›å€¼å’Œæ²¡æœ‰è¿”å›å€¼çš„ä¸œè¥¿æ‰§è¡Œçš„æ˜¯å“ªä¸ªrunæ–¹æ³•")]),s._v(" "),t("h3",{attrs:{id:"_2-å…³äºçº¿ç¨‹æ± ä¸ºä»€ä¹ˆè®¾è®¡æˆè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹åæ”¾å…¥é˜»å¡é˜Ÿåˆ—"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å…³äºçº¿ç¨‹æ± ä¸ºä»€ä¹ˆè®¾è®¡æˆè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹åæ”¾å…¥é˜»å¡é˜Ÿåˆ—"}},[s._v("#")]),s._v(" 2. å…³äºçº¿ç¨‹æ± ä¸ºä»€ä¹ˆè®¾è®¡æˆè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹åæ”¾å…¥é˜»å¡é˜Ÿåˆ—")]),s._v(" "),t("p",[s._v("åŸå§‹ç‰ˆæœ¬çš„tomcatå¯èƒ½æ›´å€¾å‘äºcpuå¯†é›†å‹ï¼Œ")]),s._v(" "),t("p",[s._v("cpuå¯†é›†å‹æ˜¯å»ºè®® æ ¸å¿ƒçº¿ç¨‹æ•°=cpuæ•°+1çš„ï¼Œè€Œä¸”cpuå¯†é›†å‹ä¸å»ºè®®å‡ºç°åˆ›å»ºçº¿ç¨‹ã€åˆ‡æ¢çº¿ç¨‹ç­‰ï¼Œå› ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹äºcpuå¯†é›†å‹æ¥è¯´æ€§èƒ½æŸè€—æ˜¯æå¤§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å…ˆæ”¾å…¥é˜Ÿåˆ—ç­‰æ ¸å¿ƒçº¿ç¨‹å¤„ç†å¥½äº†åœ¨æ¥é˜Ÿåˆ—æ‹¿ä»»åŠ¡ï¼Œå‡å°‘çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—")]),s._v(" "),t("p",[s._v("ä½†æ˜¯å¦‚æœæ˜¯ioå¯†é›†å‹æ€ä¹ˆåŠå‘¢ï¼Ÿé€šå¸¸æ˜¯è®¾ç½®æ ¸å¿ƒ çº¿ç¨‹æ•°ä¸ºcpuæ•°*2,å› ä¸ºæ­¤æ—¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹äºioå¯†é›†å‹æ¥è¯´å¹¶ä¸æ˜¯æ¶ˆè€—å¾ˆå¤šï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„çº¿ç¨‹æ¥å‹æ¦¨cpuå’Œç­‰å¾…io")]),s._v(" "),t("p",[s._v("tomcatå°±æ˜¯ä¸€ä¸ªioå¯†é›†å‹ï¼Œå…¶å¯¹åŸç”Ÿçš„tomcatè¿›è¡Œäº†ä¿®æ”¹")]),s._v(" "),t("h3",{attrs:{id:"_3-scheduledthreadpoolexecutorè§£æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-scheduledthreadpoolexecutorè§£æ"}},[s._v("#")]),s._v(" 3.ScheduledThreadPoolExecutorè§£æ")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" ä¸»è¦ç”¨æ¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œä»»åŠ¡ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚")]),s._v(" è¿™ä¸ªåœ¨å®é™…é¡¹ç›®ä¸­åŸºæœ¬ä¸ä¼šè¢«ç”¨åˆ°ï¼Œä¹Ÿä¸æ¨èä½¿ç”¨ï¼Œå¤§å®¶åªéœ€è¦ç®€å•äº†è§£ä¸€ä¸‹å®ƒçš„æ€æƒ³å³å¯ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_1ä»‹ç»"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1ä»‹ç»"}},[s._v("#")]),s._v(" â‘ ä»‹ç»")]),s._v(" "),t("p",[t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" ä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ— "),t("code",[s._v("DelayQueue")]),s._v(" å°è£…äº†ä¸€ä¸ª "),t("code",[s._v("PriorityQueue")]),s._v("ï¼Œ"),t("code",[s._v("PriorityQueue")]),s._v(" ä¼šå¯¹é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œæ’åºï¼Œæ‰§è¡Œæ‰€éœ€æ—¶é—´çŸ­çš„æ”¾åœ¨å‰é¢å…ˆè¢«æ‰§è¡Œ("),t("code",[s._v("ScheduledFutureTask")]),s._v(" çš„ "),t("code",[s._v("time")]),s._v(" å˜é‡å°çš„å…ˆæ‰§è¡Œ)ï¼Œå¦‚æœæ‰§è¡Œæ‰€éœ€æ—¶é—´ç›¸åŒåˆ™å…ˆæäº¤çš„ä»»åŠ¡å°†è¢«å…ˆæ‰§è¡Œ("),t("code",[s._v("ScheduledFutureTask")]),s._v(" çš„ "),t("code",[s._v("squenceNumber")]),s._v(" å˜é‡å°çš„å…ˆæ‰§è¡Œ)ã€‚")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" å’Œ "),t("code",[s._v("Timer")]),s._v(" çš„æ¯”è¾ƒï¼š")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Timer")]),s._v(" å¯¹ç³»ç»Ÿæ—¶é’Ÿçš„å˜åŒ–æ•æ„Ÿï¼Œ"),t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v("ä¸æ˜¯ï¼›")]),s._v(" "),t("li",[t("code",[s._v("Timer")]),s._v(" åªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ï¼Œå› æ­¤é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡å¯ä»¥å»¶è¿Ÿå…¶ä»–ä»»åŠ¡ã€‚ "),t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" å¯ä»¥é…ç½®ä»»æ„æ•°é‡çš„çº¿ç¨‹ã€‚ æ­¤å¤–ï¼Œå¦‚æœä½ æƒ³ï¼ˆé€šè¿‡æä¾› ThreadFactoryï¼‰ï¼Œä½ å¯ä»¥å®Œå…¨æ§åˆ¶åˆ›å»ºçš„çº¿ç¨‹;")]),s._v(" "),t("li",[s._v("åœ¨"),t("code",[s._v("TimerTask")]),s._v(" ä¸­æŠ›å‡ºçš„è¿è¡Œæ—¶å¼‚å¸¸ä¼šæ€æ­»ä¸€ä¸ªçº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ "),t("code",[s._v("Timer")]),s._v(" æ­»æœº:-( ...å³è®¡åˆ’ä»»åŠ¡å°†ä¸å†è¿è¡Œã€‚"),t("code",[s._v("ScheduledThreadExecutor")]),s._v(" ä¸ä»…æ•è·è¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿˜å…è®¸æ‚¨åœ¨éœ€è¦æ—¶å¤„ç†å®ƒä»¬ï¼ˆé€šè¿‡é‡å†™ "),t("code",[s._v("afterExecute")]),s._v(" æ–¹æ³•"),t("code",[s._v("ThreadPoolExecutor")]),s._v("ï¼‰ã€‚æŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡å°†è¢«å–æ¶ˆï¼Œä½†å…¶ä»–ä»»åŠ¡å°†ç»§ç»­è¿è¡Œã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("ç»¼ä¸Šï¼Œåœ¨ JDK1.5 ä¹‹åï¼Œä½ æ²¡æœ‰ç†ç”±å†ä½¿ç”¨ Timer è¿›è¡Œä»»åŠ¡è°ƒåº¦äº†ã€‚")])]),s._v(" "),t("blockquote",[t("p",[s._v("å…³äºå®šæ—¶ä»»åŠ¡çš„è¯¦ç»†ä»‹ç»ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥åœ¨ JavaGuide çš„é¡¹ç›®é¦–é¡µæœç´¢â€œå®šæ—¶ä»»åŠ¡â€æ‰¾åˆ°å¯¹åº”çš„åŸåˆ›å†…å®¹ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_2-è¿è¡Œæœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-è¿è¡Œæœºåˆ¶"}},[s._v("#")]),s._v(" â‘¡ è¿è¡Œæœºåˆ¶")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20221226171409729.png",alt:"image-20221226171409729"}})]),s._v(" "),t("p",[t("strong",[t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" çš„æ‰§è¡Œä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š")])]),s._v(" "),t("ol",[t("li",[s._v("å½“è°ƒç”¨ "),t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" çš„ "),t("strong",[t("code",[s._v("scheduleAtFixedRate()")])]),s._v(" æ–¹æ³•æˆ–è€… "),t("strong",[t("code",[s._v("scheduleWithFixedDelay()")])]),s._v(" æ–¹æ³•æ—¶ï¼Œä¼šå‘ "),t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" çš„ "),t("strong",[t("code",[s._v("DelayQueue")])]),s._v(" æ·»åŠ ä¸€ä¸ªå®ç°äº† "),t("strong",[t("code",[s._v("RunnableScheduledFuture")])]),s._v(" æ¥å£çš„ "),t("strong",[t("code",[s._v("ScheduledFutureTask")])]),s._v(" ã€‚")]),s._v(" "),t("li",[s._v("çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä» "),t("code",[s._v("DelayQueue")]),s._v(" ä¸­è·å– "),t("code",[s._v("ScheduledFutureTask")]),s._v("ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ã€‚")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("ScheduledThreadPoolExecutor")]),s._v(" ä¸ºäº†å®ç°å‘¨æœŸæ€§çš„æ‰§è¡Œä»»åŠ¡ï¼Œå¯¹ "),t("code",[s._v("ThreadPoolExecutor")]),s._v("åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼š")])]),s._v(" "),t("ul",[t("li",[s._v("ä½¿ç”¨ "),t("strong",[t("code",[s._v("DelayQueue")])]),s._v(" ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼›")]),s._v(" "),t("li",[s._v("è·å–ä»»åŠ¡çš„æ–¹ä¸åŒ")]),s._v(" "),t("li",[s._v("æ‰§è¡Œå‘¨æœŸä»»åŠ¡åï¼Œå¢åŠ äº†é¢å¤–çš„å¤„ç†")])]),s._v(" "),t("h4",{attrs:{id:"_3scheduledthreadpoolexecutor-æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„æ­¥éª¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3scheduledthreadpoolexecutor-æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„æ­¥éª¤"}},[s._v("#")]),s._v(" â‘¢ScheduledThreadPoolExecutor æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„æ­¥éª¤")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20221226171448798.png",alt:"image-20221226171448798"}})]),s._v(" "),t("ol",[t("li",[s._v("çº¿ç¨‹ 1 ä» "),t("code",[s._v("DelayQueue")]),s._v(" ä¸­è·å–å·²åˆ°æœŸçš„ "),t("code",[s._v("ScheduledFutureTaskï¼ˆDelayQueue.take()ï¼‰")]),s._v("ã€‚åˆ°æœŸä»»åŠ¡æ˜¯æŒ‡ "),t("code",[s._v("ScheduledFutureTask")]),s._v("çš„ time å¤§äºç­‰äºå½“å‰ç³»ç»Ÿçš„æ—¶é—´ï¼›")]),s._v(" "),t("li",[s._v("çº¿ç¨‹ 1 æ‰§è¡Œè¿™ä¸ª "),t("code",[s._v("ScheduledFutureTask")]),s._v("ï¼›")]),s._v(" "),t("li",[s._v("çº¿ç¨‹ 1 ä¿®æ”¹ "),t("code",[s._v("ScheduledFutureTask")]),s._v(" çš„ time å˜é‡ä¸ºä¸‹æ¬¡å°†è¦è¢«æ‰§è¡Œçš„æ—¶é—´ï¼›")]),s._v(" "),t("li",[s._v("çº¿ç¨‹ 1 æŠŠè¿™ä¸ªä¿®æ”¹ time ä¹‹åçš„ "),t("code",[s._v("ScheduledFutureTask")]),s._v(" æ”¾å› "),t("code",[s._v("DelayQueue")]),s._v(" ä¸­ï¼ˆ"),t("code",[s._v("DelayQueue.add()")]),s._v(")")])]),s._v(" "),t("p",[s._v("å‚è€ƒï¼š")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.51cto.com/search/user?uid=12122623&q=ThreadPoolExecutor",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ‹†è§£ThreadPoolExecuto"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://book.douban.com/subject/26591326/",target:"_blank",rel:"noopener noreferrer"}},[s._v("javaå¹¶å‘ç¼–ç¨‹"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://redspider.gitbook.io/concurrent/di-san-pian-jdk-gong-ju-pian/12",target:"_blank",rel:"noopener noreferrer"}},[s._v("çº¿ç¨‹æ± åŸç†"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);