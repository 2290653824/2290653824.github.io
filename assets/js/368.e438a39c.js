(window.webpackJsonp=window.webpackJsonp||[]).push([[368],{693:function(t,a,e){"use strict";e.r(a);var i=e(4),n=Object(i.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("CA证书是电子商务认证授权机构（CA, Certificate Authority），也称为电子商务认证中心，是负责发放和管理数字证书的权威机构，并作为电子商务交易中受信任的第三方，承担"),a("a",{attrs:{href:"https://so.csdn.net/so/search?q=%E5%85%AC%E9%92%A5&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[t._v("公钥"),a("OutboundLink")],1),t._v("体系中公钥的合法性检验的责任。")]),t._v(" "),a("p",[t._v("浏览器拿到服务端的数字证书后，要怎么校验数字证书的真实性呢？")]),t._v(" "),a("h3",{attrs:{id:"数字证书和-ca-机构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数字证书和-ca-机构"}},[t._v("#")]),t._v(" "),a("strong",[t._v("数字证书和 CA 机构")])]),t._v(" "),a("p",[t._v("在说校验数字证书是否可信的过程前，我们先来看看数字证书是什么，一个数字证书通常包含了：")]),t._v(" "),a("ul",[a("li",[t._v("公钥；")]),t._v(" "),a("li",[t._v("持有者信息；")]),t._v(" "),a("li",[t._v("证书认证机构（CA）的信息；")]),t._v(" "),a("li",[t._v("CA 对这份文件的数字签名及使用的算法；")]),t._v(" "),a("li",[t._v("证书有效期；")]),t._v(" "),a("li",[t._v("还有一些其他额外信息；")])]),t._v(" "),a("p",[t._v("那数字证书的作用，是用来认证公钥持有者的身份，以防止第三方进行冒充。说简单些，证书就是用来告诉客户端，该服务端是否是合法的，因为只有证书合法，才代表服务端身份是可信的。\n我们用证书来认证公钥持有者的身份（服务端的身份），那证书又是怎么来的？又该怎么认证证书呢？\n为了让服务端的公钥被大家信任，服务端的证书都是由 CA （"),a("em",[t._v("Certificate Authority")]),t._v("，证书认证机构）签名的，CA 就是网络世界里的公安局、公证中心，具有极高的可信度，所以由它来给各个公钥签名，信任的一方签发的证书，那必然证书也是被信任的。\n之所以要签名，"),a("strong",[t._v("是因为签名的作用可以避免中间人在获取证书时对证书内容的篡改")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("证书签发流程和验证流程")]),t._v(" "),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2023/png/29475739/1697609588884-8c918215-d790-42bd-879f-75c076c0c8d6.png#averageHue=%23f5f2e9&clientId=u65740272-783e-4&from=paste&height=200&id=ua1e39c1a&originHeight=399&originWidth=720&originalType=binary&ratio=2&rotation=0&showTitle=false&size=178760&status=done&style=none&taskId=u986d5358-87be-4c78-8bcd-494e20e4e54&title=&width=360",alt:"image.png"}}),t._v("\nCA 签发证书的过程，如上图左边部分：")]),t._v(" "),a("ul",[a("li",[t._v("首先 CA 会把持有者的公钥、用途、颁发者、有效时间等信息打成一个包，然后对这些信息进行 Hash 计算，得到一个 Hash 值；")]),t._v(" "),a("li",[t._v("然后 CA 会使用自己的私钥将该 Hash 值加密，生成 Certificate Signature，也就是 CA 对证书做了签名；")]),t._v(" "),a("li",[t._v("最后将 Certificate Signature 添加在文件证书上，形成数字证书；")])]),t._v(" "),a("p",[t._v("客户端校验服务端的数字证书的过程，如上图右边部分：")]),t._v(" "),a("ul",[a("li",[t._v("首先客户端会使用同样的 Hash 算法获取该证书的 Hash 值 H1；")]),t._v(" "),a("li",[t._v("通常浏览器和操作系统中集成了 CA 的公钥信息，浏览器收到证书后可以使用 CA 的公钥解密 Certificate Signature 内容，得到一个 Hash 值 H2 ；")]),t._v(" "),a("li",[t._v("最后比较 H1 和 H2，如果值相同，则为可信赖的证书，否则则认为证书不可信。")])]),t._v(" "),a("h3",{attrs:{id:"证书链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书链"}},[t._v("#")]),t._v(" "),a("strong",[t._v("证书链")])]),t._v(" "),a("p",[t._v("但事实上，证书的验证过程中还存在一个证书信任链的问题，因为我们向 CA 申请的证书一般不是根证书签发的，而是由中间证书签发的，比如百度的证书，从下图你可以看到，证书的层级有三级：\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2023/png/29475739/1697609709597-1ea4cb52-976c-4681-aaa7-2b6311f68a87.png#averageHue=%23e9e9e9&clientId=u65740272-783e-4&from=paste&id=uff31890f&originHeight=217&originWidth=567&originalType=url&ratio=2&rotation=0&showTitle=false&size=74466&status=done&style=none&taskId=u612453ec-c3a3-49ae-a10b-019cca74781&title=",alt:"image.png"}}),t._v("\n对于这种三级层级关系的证书的验证过程如下：")]),t._v(" "),a("ul",[a("li",[t._v("客户端收到 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 的证书后，发现这个证书的签发者不是根证书，就无法根据本地已有的根证书中的公钥去验证 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 证书是否可信。于是，客户端根据 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 证书中的签发者，找到该证书的颁发机构是 “GlobalSign Organization Validation CA - SHA256 - G2”，然后向 CA 请求该中间证书。")]),t._v(" "),a("li",[t._v("请求到证书后发现 “GlobalSign Organization Validation CA - SHA256 - G2” 证书是由 “GlobalSign Root CA” 签发的，由于 “GlobalSign Root CA” 没有再上级签发机构，说明它是根证书，也就是自签证书。应用软件会检查此证书有否已预载于根证书清单上，如果有，则可以利用根证书中的公钥去验证 “GlobalSign Organization Validation CA - SHA256 - G2” 证书，如果发现验证通过，就认为该中间证书是可信的。")]),t._v(" "),a("li",[t._v("“GlobalSign Organization Validation CA - SHA256 - G2” 证书被信任后，可以使用 “GlobalSign Organization Validation CA - SHA256 - G2” 证书中的公钥去验证 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 证书的可信性，如果验证通过，就可以信任 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 证书。")])]),t._v(" "),a("p",[t._v("在这四个步骤中，最开始客户端只信任根证书 GlobalSign Root CA 证书的，然后 “GlobalSign Root CA” 证书信任 “GlobalSign Organization Validation CA - SHA256 - G2” 证书，而 “GlobalSign Organization Validation CA - SHA256 - G2” 证书又信任 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 证书，于是客户端也信任 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 证书。\n总括来说，由于用户信任 GlobalSign，所以由 GlobalSign 所担保的 "),a("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//baidu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://baidu.com"),a("OutboundLink")],1),t._v(" 可以被信任，另外由于用户信任操作系统或浏览器的软件商，所以由软件商预载了根证书的 GlobalSign 都可被信任。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2023/png/29475739/1697609709604-da4ade6e-7995-4dec-b755-adfa498969be.png#averageHue=%23fbf5f1&clientId=u65740272-783e-4&from=paste&id=u0d41adec&originHeight=891&originWidth=707&originalType=url&ratio=2&rotation=0&showTitle=false&size=171203&status=done&style=none&taskId=u2666cab4-f238-4c7a-a1e7-addbe8d6912&title=",alt:"image.png"}}),t._v("\n操作系统里一般都会内置一些根证书，比如我的 MAC 电脑里内置的根证书有这么多：\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2023/png/29475739/1697609709503-777c9ddf-a0aa-4a7c-89df-ea41426268a0.png#averageHue=%2371a0d7&clientId=u65740272-783e-4&from=paste&id=u10d89b81&originHeight=443&originWidth=720&originalType=url&ratio=2&rotation=0&showTitle=false&status=done&style=none&taskId=u2a3898ba-bff0-42ea-91f3-2f52849f541&title=",alt:""}})]),t._v(" "),a("p",[t._v("这样的一层层地验证就构成了一条信任链路，整个证书信任链验证流程如下图所示：\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2023/png/29475739/1697609709617-c5ec51e2-3d14-4b9a-a300-c1964bc5335a.png#averageHue=%23efedde&clientId=u65740272-783e-4&from=paste&id=ua37fe849&originHeight=330&originWidth=1080&originalType=url&ratio=2&rotation=0&showTitle=false&size=161479&status=done&style=none&taskId=udb54acfc-bf1d-4ed1-9820-971231aae35&title=",alt:"image.png"}})]),t._v(" "),a("h3",{attrs:{id:"为什么会存在证书链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么会存在证书链"}},[t._v("#")]),t._v(" 为什么会存在证书链")]),t._v(" "),a("p",[t._v("最后一个问题，为什么需要证书链这么麻烦的流程？Root CA 为什么不直接颁发证书，而是要搞那么多中间层级呢？\n这是为了确保根证书的绝对安全性，将根证书隔离地越严格越好，不然根证书如果失守了，那么整个信任链都会有问题。")]),t._v(" "),a("p",[t._v("参考：\n"),a("a",{attrs:{href:"https://www.cnblogs.com/TvvT-kevin/p/15578459.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器如何验证HTTPS证书的合法性？ "),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/m0_61979385/article/details/121994149",target:"_blank",rel:"noopener noreferrer"}},[t._v("CA证书的签发流程详情"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);