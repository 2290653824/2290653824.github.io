(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{539:function(t,v,s){"use strict";s.r(v);var _=s(4),r=Object(_.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"dns-是什么"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dns-是什么"}},[t._v("#")]),t._v(" DNS 是什么")]),t._v(" "),v("p",[t._v("使用域名，人们可以将复杂的IP地址通过域名来记忆。DNS可以将域名网址自动转换为具体的ip地址。")]),t._v(" "),v("p",[t._v("DNS以逗号进行分割，代表了不同层次之间的界限。"),v("strong",[t._v("其中越靠右边的位置所表示的层级越高")])]),t._v(" "),v("h2",{attrs:{id:"dns-分层"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dns-分层"}},[t._v("#")]),t._v(" DNS 分层")]),t._v(" "),v("p",[t._v("域名层级呈现一个树的结构。最高处叫做根域名。根域名的下一次就是顶级域名(eg:com)")]),t._v(" "),v("p",[t._v("具体如下：")]),t._v(" "),v("ul",[v("li",[t._v("根 DNS 服务器")]),t._v(" "),v("li",[t._v("顶级域 DNS 服务器（com）")]),t._v(" "),v("li",[t._v("权威 DNS 服务器（server.com）")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230406210949582.png",alt:"image-20230406210949582"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230406205443623.png",alt:"image-20230406205443623"}})]),t._v(" "),v("p",[t._v("根域的 DNS 服务器信息保存在互联网中所有的 DNS 服务器中。这样一来，任何 DNS 服务器就都可以找到并访问根域 DNS 服务器了。")]),t._v(" "),v("p",[t._v("因此，客户端只要能够找到任意一台 DNS 服务器，就可以通过它找到根域 DNS 服务器，然后再一路顺藤摸瓜找到位于下层的某台目标 DNS 服务器。")]),t._v(" "),v("h2",{attrs:{id:"dns流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dns流程"}},[t._v("#")]),t._v(" DNS流程")]),t._v(" "),v("p",[t._v("浏览器首先看一下自己的缓存里有没有域名与地址的映射关系，如果没有就向操作系统的缓存要，还没有就检查本机域名解析文件 "),v("code",[t._v("hosts")]),t._v("，如果还是没有，就会 DNS 服务器进行查询，查询的过程如下：")]),t._v(" "),v("ol",[v("li",[t._v("客户端首先会发出一个 DNS 请求，问 www.server.com 的 IP 是啥，并发给本地 DNS 服务器（也就是客户端的 TCP/IP 设置中填写的 DNS 服务器地址）。")]),t._v(" "),v("li",[t._v("本地域名服务器收到客户端的请求后，如果缓存里的表格能找到 www.server.com，则它直接返回 IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“老大， 能告诉我 www.server.com 的 IP 地址吗？” 根域名服务器是最高层次的，它不直接用于域名解析，但能指明一条道路。")]),t._v(" "),v("li",[t._v("根 DNS 收到来自本地 DNS 的请求后，发现后置是 .com，说：“www.server.com 这个域名归 .com 区域管理”，我给你 .com 顶级域名服务器地址给你，你去问问它吧。”")]),t._v(" "),v("li",[t._v("本地 DNS 收到顶级域名服务器的地址后，发起请求问“老二， 你能告诉我 www.server.com 的 IP 地址吗？”")]),t._v(" "),v("li",[t._v("顶级域名服务器说：“我给你负责 www.server.com 区域的权威 DNS 服务器的地址，你去问它应该能问到”。")]),t._v(" "),v("li",[t._v("本地 DNS 于是转向问权威 DNS 服务器：“老三，www.server.com对应的IP是啥呀？” server.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。")]),t._v(" "),v("li",[t._v("权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。")]),t._v(" "),v("li",[t._v("本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。")])]),t._v(" "),v("p",[t._v("以上流程是以迭代的方式进行的。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/undefinedimage-20230406210617385.png",alt:"image-20230406210617385"}})]),t._v(" "),v("p",[t._v("还有一种方式是通过递归的方式进行的。")]),t._v(" "),v("p",[t._v("​\t当局部DNS服务器自己不能回答客户机的DNS查询时，它就需要向其他DNS服务器进行查询。此时有两种方式，如图所示的是递归方式。局部DNS服务器自己负责向其他DNS服务器进行查询，一般是先向该域名的根域服务器查询，再由根域名服务器一级级向下查询。最后得到的查询结果返回给局部DNS服务器，再由局部DNS服务器返回给客户端。")]),t._v(" "),v("h2",{attrs:{id:"迭代和递归的区别"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#迭代和递归的区别"}},[t._v("#")]),t._v(" 迭代和递归的区别")]),t._v(" "),v("p",[v("strong",[t._v("递归")]),t._v("：客户端只发一次请求，要求对方给出最终结果。返回的结果只有两种：查询成功或查询失败。\n"),v("strong",[t._v("迭代")]),t._v("：又称为“重指引”。客户端发出一次请求，对方如果没有"),v("strong",[t._v("授权回答")]),t._v("（向dns服务器查询一个域名，刚好这个域名是本服务器负责，返回的结果就是授权回答），它就会返回一个能解答这个查询的其它名称服务器列表，客户端会再向返回的列表中发出请求，直到找到最终负责所查域名的名称服务器，从它得到最终结果。\n"),v("strong",[t._v("客户端-本地dns服务端")]),t._v("：这部分属于"),v("strong",[t._v("递归")]),t._v("查询。\n"),v("strong",[t._v("本地dns服务端-外网")]),t._v("：这部分属于"),v("strong",[t._v("迭代")]),t._v("查询。（不启用转发模式）")]),t._v(" "),v("h2",{attrs:{id:"关于dig命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#关于dig命令"}},[t._v("#")]),t._v(" 关于dig命令")]),t._v(" "),v("p",[t._v("dig @server name type")]),t._v(" "),v("p",[t._v("@server: 指定域名服务器\nname:指定查询请求资源的域名\ntype:指定查询类型，如A、CNAME、SRV、MX、SIG等，如果不指定type，默认为A")]),t._v(" "),v("p",[t._v("查询某个域名解析的全过程:(此时为迭代查询)\n$ dig @8.8.8.8  163.com +trace")]),t._v(" "),v("p",[v("a",{attrs:{href:"https://developer.aliyun.com/article/418787",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.aliyun.com/article/418787"),v("OutboundLink")],1)]),t._v(" "),v("h2",{attrs:{id:"dns解析为什么使用udp"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dns解析为什么使用udp"}},[t._v("#")]),t._v(" DNS解析为什么使用UDP")]),t._v(" "),v("h3",{attrs:{id:"dns在进行区域传输的时候使用tcp协议-其它时候则使用udp协议"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dns在进行区域传输的时候使用tcp协议-其它时候则使用udp协议"}},[t._v("#")]),t._v(" DNS在进行区域传输的时候使用TCP协议，其它时候则使用UDP协议；")]),t._v(" "),v("p",[t._v("DNS的规范规定了2种类型的DNS服务器，一个叫主DNS服务器，一个叫辅助DNS服务器。在一个区中主DNS服务器从自己本机的数据文件中读取该区的DNS数据信息，而辅助DNS服务器则从区的主DNS服务器中读取该区的DNS数据信息。当一个辅助DNS服务器启动时，它需要与主DNS服务器通信，并加载数据信息，这就叫做区传送（zone transfer）。")]),t._v(" "),v("p",[t._v("区域传输是DNS的事务，对准确性要求比较高，而且会产生大于512字节的数据包，因此使用TCP协议。")]),t._v(" "),v("h3",{attrs:{id:"为什么既使用tcp又使用udp"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#为什么既使用tcp又使用udp"}},[t._v("#")]),t._v(" 为什么既使用TCP又使用UDP？")]),t._v(" "),v("p",[t._v("首先了解一下TCP与UDP传送字节的长度限制。")]),t._v(" "),v("p",[v("em",[t._v("UDP报文的最大长度为512字节，而TCP则允许报文长度超过512字节")]),t._v("。当DNS查询超过512字节时，协议的TC标志出现删除标志，这时则使用TCP发送。通常传统的UDP报文一般不会大于512字节。")]),t._v(" "),v("h3",{attrs:{id:"区域传送时使用tcp-主要有一下两点考虑"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#区域传送时使用tcp-主要有一下两点考虑"}},[t._v("#")]),t._v(" 区域传送时使用TCP，主要有一下两点考虑")]),t._v(" "),v("ol",[v("li",[t._v("辅域名服务器会定时（一般时3小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，则会执行一次区域传送，进行数据同步。区域传送将使用TCP而不是UDP，因为数据同步传送的数据量比一个请求和应答的数据量要多得多。")]),t._v(" "),v("li",[t._v("TCP是一种可靠的连接，保证了数据的准确性。")])]),t._v(" "),v("h3",{attrs:{id:"域名解析时使用udp协议"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#域名解析时使用udp协议"}},[t._v("#")]),t._v(" 域名解析时使用UDP协议")]),t._v(" "),v("p",[t._v("客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可。不用经过TCP三次握手，这样DNS服务器负载更低，响应更快。虽然从理论上说，客户端也可以指定向DNS服务器查询的时候使用TCP，但事实上，很多DNS服务器进行配置的时候，仅支持UDP查询包。")]),t._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),v("p",[t._v("大多数情况下，DNS解析请求和响应都很小，使用UDP协议更加高效，虽然没有TCP可靠，但是速度快，消耗的系统资源更少，非常适合少量数据包的传输。\n一些DNS事务，比如区域传输或其他附加查询，可能会产生大于512字节的数据包，因此使用TCP更加可靠，使用TCP会减少丢包和重新发包的情况，因此更加可靠与高效。")])])}),[],!1,null,null,null);v.default=r.exports}}]);