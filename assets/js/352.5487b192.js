(window.webpackJsonp=window.webpackJsonp||[]).push([[352],{673:function(t,e,s){"use strict";s.r(e);var a=s(4),v=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"污点和容忍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#污点和容忍"}},[t._v("#")]),t._v(" 污点和容忍")]),t._v(" "),e("p",[t._v("与节点调度相关")]),t._v(" "),e("p",[t._v("污点：例如我们在node1上面有污点，那么pod或者其他任务就不会被调度到node1上面，而是到其他的节点上面去。")]),t._v(" "),e("p",[t._v("容忍：某个任务上面可以配置容忍，如果我们容忍了node1上面的污点，我们就可以在node1上面进行调度")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230905105446112.png",alt:"image-20230905105446112"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230905105652069.png",alt:"image-20230905105652069"}})]),t._v(" "),e("h2",{attrs:{id:"污点基本应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#污点基本应用"}},[t._v("#")]),t._v(" 污点基本应用")]),t._v(" "),e("p",[t._v("为节点打上污点：")]),t._v(" "),e("p",[e("code",[t._v("kubectl taint node k8s-master key=value:NoSchedule")])]),t._v(" "),e("p",[t._v("污点造成的影响")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("NoSchedule：如果某个pod不能容忍该节点的污点，那么pod就无法调度到该节点")])]),t._v(" "),e("li",[e("p",[t._v("NoExecute：")])])]),t._v(" "),e("p",[t._v("如果pod不能忍受这类污点，pod会马上被驱逐")]),t._v(" "),e("p",[t._v("如果pod能容忍这类污点，但是在容忍度上没有指定tolerationSeconds，则pod还会一直在这个节点上运行")]),t._v(" "),e("p",[t._v("如果指定了tolerationSeconds，则pod还能在这个节点上继续运行这个指定的时间长度。")]),t._v(" "),e("p",[t._v("移除污点")]),t._v(" "),e("p",[e("code",[t._v("kubectl taint node k8s-master key=value:NoSchedule")])]),t._v(" "),e("p",[t._v("查看污点")]),t._v(" "),e("p",[t._v("只能通过 "),e("code",[t._v("kubectl describe node node1")]),t._v(" 才可以")]),t._v(" "),e("h2",{attrs:{id:"容忍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#容忍"}},[t._v("#")]),t._v(" 容忍")]),t._v(" "),e("p",[t._v("标注在pod上的，当pod被调度时，如果没有配置容忍，则该pod不会被调度到有污点的节点上，只有该pod上标注了满足某个节点的所有污点，则会被调度到这些节点")]),t._v(" "),e("p",[t._v("如何配置容忍：")]),t._v(" "),e("p",[t._v("在pod的spec下面配置容忍")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("tolerations:\n- key: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"污点的key"')]),t._v("\n  value: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"污点的value"')]),t._v("\n  offect: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSchedule"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 污点产生的影响")]),t._v("\n  operator: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Equal"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 表是value与污点的value要相等，也可以设置为exist表示存在key即可，此时可以不用配置value")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("ul",[e("li",[t._v("Equal")])]),t._v(" "),e("p",[t._v("比较操作类型为equal，则意味着必须与污点值做匹配，key/value都必须相同，才表示能容忍该污点")]),t._v(" "),e("ul",[e("li",[t._v("Exist")])]),t._v(" "),e("p",[t._v("容忍与污点的比较只比较key，不比较value，不关心value是什么，只要key存在，就表示可以容忍")]),t._v(" "),e("p",[t._v("openstacktest-1   taints  node-role.kubernetes.io/master:PreferNoSchedule")]),t._v(" "),e("h2",{attrs:{id:"亲和力-affinity"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#亲和力-affinity"}},[t._v("#")]),t._v(" 亲和力 Affinity")]),t._v(" "),e("h3",{attrs:{id:"节点亲和力"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#节点亲和力"}},[t._v("#")]),t._v(" 节点亲和力")]),t._v(" "),e("p",[t._v("指定某一个pod想去哪个地方")]),t._v(" "),e("p",[t._v("亲和力相对于nodeSelector扩展性更高")]),t._v(" "),e("p",[t._v("亲和力（和绝对匹配，尽量匹配）")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230905114147024.png",alt:"image-20230905114147024"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230905115649370.png",alt:"image-20230905115649370"}})]),t._v(" "),e("h4",{attrs:{id:"案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[t._v("#")]),t._v(" 案例：")]),t._v(" "),e("ul",[e("li",[t._v("NodeAffinity")])]),t._v(" "),e("p",[e("strong",[t._v("RequiredDuringSechdulingIgnoredDuringExecution")])]),t._v(" "),e("p",[t._v("硬亲和力，即支持必须部署在指定的节点上，也支持必须不部署在指定的节点上。")]),t._v(" "),e("p",[e("strong",[t._v("PreferedDuringSchedulingIgnoreDuringExecution")])]),t._v(" "),e("p",[t._v("软亲和力，尽量部署在满足条件的节点上，或尽量不要部署在被匹配的节点上")]),t._v(" "),e("p",[t._v("matchExpression")]),t._v(" "),e("p",[t._v("Operator:")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("in :满足一个就行")])]),t._v(" "),e("li",[e("p",[t._v("not in：一个都不能满足")])]),t._v(" "),e("li",[e("p",[t._v("exists：存在就满足")])]),t._v(" "),e("li",[e("p",[t._v("doesNotExist 只有不存在，才满足")])]),t._v(" "),e("li",[e("p",[t._v("gt ： 必须大于节点的数值，才满足")])]),t._v(" "),e("li",[e("p",[t._v("lt：小于节点的数值，才满足")])]),t._v(" "),e("li",[e("p",[t._v("podAffinity")])])]),t._v(" "),e("h3",{attrs:{id:"pod亲和力"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pod亲和力"}},[t._v("#")]),t._v(" pod亲和力")]),t._v(" "),e("p",[t._v("对于node1，node2，node3中，node3里面有一个服务a，我的服务b准备部署，可以根据节点亲和力判断是配置在node3中还是配置在node1和node2中。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230905141938040.png",alt:"image-20230905141938040"}})])])}),[],!1,null,null,null);e.default=v.exports}}]);