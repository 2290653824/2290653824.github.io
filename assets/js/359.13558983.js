(window.webpackJsonp=window.webpackJsonp||[]).push([[359],{691:function(s,n,e){"use strict";e.r(n);var t=e(4),a=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"什么是kubevirt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是kubevirt"}},[s._v("#")]),s._v(" 什么是kubevirt")]),s._v(" "),n("p",[s._v("什么是k8s CRD")]),s._v(" "),n("blockquote",[n("p",[s._v('Kubernetes中的CRD代表"Custom Resource Definition"，即自定义资源定义。它是Kubernetes中的一个重要概念，用于扩展Kubernetes API，允许用户定义自己的自定义资源类型。')]),s._v(" "),n("p",[s._v("CRD允许您创建和管理自己的自定义资源对象，这些对象与Kubernetes内置资源（如Pod、Service、Deployment等）具有类似的生命周期管理能力。CRD的使用场景包括但不限于以下几种：")]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("自定义控制器")]),s._v(": 您可以创建自定义控制器来监视和管理自定义资源对象的状态，以便根据特定的应用需求自动执行操作。")]),s._v(" "),n("li",[n("strong",[s._v("自定义配置")]),s._v(": 您可以使用CRD定义自定义配置对象，以便将应用程序或服务的配置参数存储为自定义资源。这使得配置管理更加灵活和可扩展。")]),s._v(" "),n("li",[n("strong",[s._v("操作日志和审计")]),s._v(": 您可以创建CRD来记录操作日志或审计事件，以便更好地了解集群内的活动和故障排除。")]),s._v(" "),n("li",[n("strong",[s._v("多租户管理")]),s._v(": 如果您需要在集群中实现多租户隔离，CRD可以用于定义租户对象，以便更好地管理和隔离租户之间的资源。")])]),s._v(" "),n("p",[s._v("创建CRD通常需要以下步骤：")]),s._v(" "),n("ol",[n("li",[s._v("创建CRD定义，其中包括资源名称、字段结构和验证规则等信息。")]),s._v(" "),n("li",[s._v("使用"),n("code",[s._v("kubectl apply")]),s._v("或类似的工具将CRD定义应用到Kubernetes集群。")]),s._v(" "),n("li",[s._v("创建自定义资源对象（CR），这些对象遵循CRD定义的结构。")]),s._v(" "),n("li",[s._v("创建或扩展控制器来处理CR对象的生命周期。")])]),s._v(" "),n("p",[s._v("CRD为Kubernetes提供了很大的灵活性，使其能够适应各种不同的应用场景和需求。可以根据具体需求定义自定义资源，以便更好地管理和扩展Kubernetes集群。")])]),s._v(" "),n("p",[s._v("什么是libvirtd")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("libvirtd")]),s._v("（通常称为libvirt守护进程）是一个开源的虚拟化管理工具，它提供了一种抽象层，用于管理多种虚拟化技术和虚拟机。libvirt允许你统一地管理和监控不同类型的虚拟机，包括KVM、QEMU、Xen、LXC、OpenVZ等。")]),s._v(" "),n("p",[s._v("以下是libvirtd的一些主要功能和用途：")]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("虚拟机管理")]),s._v("：libvirtd允许你创建、启动、停止、暂停和删除虚拟机。这些虚拟机可以是基于KVM、QEMU或其他虚拟化技术的。")]),s._v(" "),n("li",[n("strong",[s._v("资源管理")]),s._v("：你可以使用libvirtd来管理虚拟机的资源分配，如CPU、内存、磁盘和网络。这使得你可以有效地控制和调整虚拟机的性能和资源使用。")]),s._v(" "),n("li",[n("strong",[s._v("网络管理")]),s._v("：libvirt提供了网络管理功能，允许你创建和配置虚拟网络，以便虚拟机可以与主机和其他虚拟机进行通信。")]),s._v(" "),n("li",[n("strong",[s._v("存储管理")]),s._v("：它还允许你管理虚拟机的存储，包括创建、删除和挂载虚拟磁盘。")]),s._v(" "),n("li",[n("strong",[s._v("远程管理")]),s._v("：libvirtd支持远程管理，这意味着你可以从远程计算机上管理虚拟机和宿主机。")]),s._v(" "),n("li",[n("strong",[s._v("支持多种虚拟化技术")]),s._v("：libvirt支持多种虚拟化技术，因此你可以使用它来管理不同类型的虚拟机，而无需了解每种技术的细节。")])]),s._v(" "),n("p",[s._v("总之，libvirtd是一个强大的虚拟化管理工具，适用于虚拟化环境中的资源管理、虚拟机创建和监控。它提供了一个方便的方式来管理各种虚拟化技术，使管理员能够更轻松地管理和维护虚拟化基础架构。它通常用于Linux系统上，作为虚拟化技术堆栈的一部分。")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/402922917",target:"_blank",rel:"noopener noreferrer"}},[s._v("后Kubernetes时代的虚拟机管理技术之kubevirt篇"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("virt-host-validate qemu")]),s._v(" "),n("p",[s._v("安装：")]),s._v(" "),n("p",[s._v("前提，已经安装了k8s")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("kubectl create "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" https://github.com/kubevirt/kubevirt/releases/download/v0.57.0/kubevirt-operator.yaml\n\nkubectl create "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" https://github.com/kubevirt/kubevirt/releases/download/v0.57.0/kubevirt-cr.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("查看pod启动情况")])]),s._v(" "),n("p",[n("code",[s._v("get pods -n kubevirt")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("root@openstackTest-1:~/kubevirt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n kubevirt")]),s._v("\nNAME                             READY   STATUS    RESTARTS   AGE\nvirt-api-679958f6c4-8tczm        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          42s\nvirt-api-679958f6c4-m6f9k        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          42s\nvirt-operator-84b569bcf4-q8btk   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5m28s\nvirt-operator-84b569bcf4-xkhbj   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5m28s\n\n\nroot@openstackTest-1:~/kubevirt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get kubevirt -n kubevirt")]),s._v("\nNAME       AGE     PHASE\nkubevirt   7m56s   Deployed\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("下载virtctl")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/kubevirt/kubevirt/releases/download/v0.57.0/virtctl-v0.57.0-linux-amd64 "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" virtctl\n--2023-09-04 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":50:27--  https://github.com/kubevirt/kubevirt/releases/download/v0.57.0/virtctl-v0.57.0-linux-amd64\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("创建虚拟机")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("apiVersion: kubevirt.io/v1\nkind: VirtualMachine\nmetadata:\n  name: testvm\nspec:\n  running: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  template:\n    metadata:\n      labels:\n        kubevirt.io/size: small\n        kubevirt.io/domain: testvm\n    spec:\n      domain:\n        devices:\n          disks:\n            - name: containerdisk\n              disk:\n                bus: virtio\n            - name: cloudinitdisk\n              disk:\n                bus: virtio\n          interfaces:\n          - name: default\n            masquerade: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        resources:\n          requests:\n            memory: 64M\n      networks:\n      - name: default\n        pod: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      volumes:\n        - name: containerdisk\n          containerDisk:\n            image: quay.io/kubevirt/cirros-container-disk-demo\n        - name: cloudinitdisk\n          cloudInitNoCloud:\n            userDataBase64: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SGkuXG4")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("p",[s._v("查看虚拟机状态")]),s._v(" "),n("p",[n("code",[s._v("kubectl get vms")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("root@openstackTest-1:~/kubevirt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get vms")]),s._v("\nNAME     AGE   STATUS    READY\ntestvm   75s   Stopped   False\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("启动虚拟机")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("root@openstackTest-1:~/kubevirt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virtctl start testvm")]),s._v("\nVM testvm was scheduled to start\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("发现虚拟机没有启动起立，返回以下内容")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(" - lastProbeTime: null\n    lastTransitionTime: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-09-04T16:24:50Z"')]),s._v("\n    message: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0/3 nodes are available: 3 node(s) didn'")]),s._v("'t match Pod"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("s "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" affinity/selector.\n      preemption: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/3 nodes are available: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" Preemption is not helpful "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" scheduling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("'\n    reason: Unschedulable\n    status: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"False"')]),s._v("\n    type: PodScheduled\n  guestOSInfo: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  phase: Scheduling\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("https://github.com/kubevirt/kubevirt/issues/7780")])])}),[],!1,null,null,null);n.default=a.exports}}]);