(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{412:function(s,a,n){"use strict";n.r(a);var e=n(4),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"countdownlatch-倒计时门闩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#countdownlatch-倒计时门闩"}},[s._v("#")]),s._v(" CountDownLatch(倒计时门闩)")]),s._v(" "),a("p",[s._v("倒计时门闩，只有倒计时门闩值变为0时，阻塞状态才会结束。")]),s._v(" "),a("h3",{attrs:{id:"使用示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("使用示例")])]),s._v(" "),a("ol",[a("li",[s._v("5个线程都完成工作后继续后续逻辑（主线程等待5个线程完成工作）")])]),s._v(" "),a("p",[s._v("用5个线程模拟5个工人工作，只有5个工人都完成工作后才能输出所有工作都完成。")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class WorkerCountDown {\n\n    private static Logger logger = LoggerFactory.getLogger(WorkerCountDown.class);\n\n    public static void main(String[] args) {\n        int workerSize = 5;\n        CountDownLatch workCount = new CountDownLatch(workerSize);\n        ExecutorService threadPool = Executors.newFixedThreadPool(workerSize);\n        for (int i = 0; i &lt; workerSize; i++) {\n            final int workerNum = i;\n            //5个工人输出完成工作后，扣减倒计时门闩数\n            threadPool.submit(() -> {\n                logger.info("worker[{}]完成手头的工作", workerNum);\n                workCount.countDown();\n            });\n        }\n\n        try {\n            //阻塞当前线程(主线程)往后走，只有倒计时门闩变为0之后才能继续后续逻辑\n            workCount.await();\n        } catch (InterruptedException e) {\n            logger.info("倒计时门闩阻塞失败，失败原因[{}]", e.getMessage(), e);\n        }\n\n        threadPool.shutdown();\n        while (!threadPool.isTerminated()) {\n\n        }\n\n        logger.info("所有工人都完成手头的工作了");\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("输出结果")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pool-1-thread-2] INFO com.guide.thread.base.WorkerCountDown - worker[1]完成手头的工作\n[pool-1-thread-3] INFO com.guide.thread.base.WorkerCountDown - worker[2]完成手头的工作\n[pool-1-thread-5] INFO com.guide.thread.base.WorkerCountDown - worker[4]完成手头的工作\n[pool-1-thread-1] INFO com.guide.thread.base.WorkerCountDown - worker[0]完成手头的工作\n[pool-1-thread-4] INFO com.guide.thread.base.WorkerCountDown - worker[3]完成手头的工作\n[main] INFO com.guide.thread.base.WorkerCountDown - 所有工人都完成手头的工作了\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ol",[a("li",[s._v("模拟运动员赛跑")])]),s._v(" "),a("p",[s._v("我们将一个个线程比作运动员，我们希望希望倒计时门闩变为0时，10个线程并发工作。（10个线程等待主线程完成工作）")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class Racing {\n\n    private static Logger logger = LoggerFactory.getLogger(Racing.class);\n\n    public static void main(String[] args) {\n\n        logger.info("百米跑比赛开始");\n\n        int playerNum = 10;\n        CountDownLatch gun = new CountDownLatch(1);\n        ExecutorService threadPool = Executors.newFixedThreadPool(playerNum);\n        for (int i = 0; i &lt; playerNum; i++) {\n            final int playNo = i;\n            threadPool.submit(() -> {\n                logger.info("[{}]号运动员已就绪", playNo);\n                try {\n                    gun.await();\n                } catch (InterruptedException e) {\n                    logger.info("[{}]号运动员线程阻塞失败，失败原因[{}]", playNo, e.getMessage(), e);\n                }\n                logger.info("[{}]号运动员已经到达重点", playNo);\n            });\n        }\n\n\n        gun.countDown();\n\n        threadPool.shutdown();\n        while (!threadPool.isTerminated()) {\n\n        }\n\n        logger.info("百米赛跑已结束");\n\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("输出结果")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[main] INFO com.guide.thread.base.Racing - 百米跑比赛开始\n[pool-1-thread-3] INFO com.guide.thread.base.Racing - [2]号运动员已就绪\n[pool-1-thread-9] INFO com.guide.thread.base.Racing - [8]号运动员已就绪\n[pool-1-thread-4] INFO com.guide.thread.base.Racing - [3]号运动员已就绪\n[pool-1-thread-7] INFO com.guide.thread.base.Racing - [6]号运动员已就绪\n[pool-1-thread-2] INFO com.guide.thread.base.Racing - [1]号运动员已就绪\n[pool-1-thread-8] INFO com.guide.thread.base.Racing - [7]号运动员已就绪\n[pool-1-thread-1] INFO com.guide.thread.base.Racing - [0]号运动员已就绪\n[pool-1-thread-5] INFO com.guide.thread.base.Racing - [4]号运动员已就绪\n[pool-1-thread-6] INFO com.guide.thread.base.Racing - [5]号运动员已就绪\n[pool-1-thread-10] INFO com.guide.thread.base.Racing - [9]号运动员已就绪\n[pool-1-thread-6] INFO com.guide.thread.base.Racing - [5]号运动员已经到达重点\n[pool-1-thread-5] INFO com.guide.thread.base.Racing - [4]号运动员已经到达重点\n[pool-1-thread-1] INFO com.guide.thread.base.Racing - [0]号运动员已经到达重点\n[pool-1-thread-8] INFO com.guide.thread.base.Racing - [7]号运动员已经到达重点\n[pool-1-thread-2] INFO com.guide.thread.base.Racing - [1]号运动员已经到达重点\n[pool-1-thread-7] INFO com.guide.thread.base.Racing - [6]号运动员已经到达重点\n[pool-1-thread-4] INFO com.guide.thread.base.Racing - [3]号运动员已经到达重点\n[pool-1-thread-9] INFO com.guide.thread.base.Racing - [8]号运动员已经到达重点\n[pool-1-thread-3] INFO com.guide.thread.base.Racing - [2]号运动员已经到达重点\n[pool-1-thread-10] INFO com.guide.thread.base.Racing - [9]号运动员已经到达重点\n[main] INFO com.guide.thread.base.Racing - 百米赛跑已结束\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"semaphore-信号量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#semaphore-信号量"}},[s._v("#")]),s._v(" Semaphore(信号量)")]),s._v(" "),a("p",[s._v("信号量常用于控制多线程争抢有些资源后才能工作的场景。例如我们给信号量设置资源总数为3，只有拿到3个资源的线程才能进行工作，其他线程必须等待使用使用资源的线程释放后才能进行争抢。")]),s._v(" "),a("h3",{attrs:{id:"信号量基础使用示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#信号量基础使用示例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("信号量基础使用示例")])]),s._v(" "),a("p",[s._v("如下所示，我们设置信号量初始化3个许可证，并且设置为公平"),a("code",[s._v("true")]),s._v(",这就意味着资源被线程争抢完后，后续线程必须阻塞等待，只有前一个线程用完许可资源释放足量空闲的资源后，才能继续争抢。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230724102905252.png",alt:"image-20230724102905252"}})]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class SemaphoreDemo {\n\n    //默认3个资源，并且公平争抢\n    private static Semaphore semaphore = new Semaphore(3,true);\n\n\n    private static Logger logger = LoggerFactory.getLogger(SemaphoreDemo.class);\n\n    public static void main(String[] args) {\n        int workSize = 5;\n        ExecutorService executorService = Executors.newFixedThreadPool(workSize);\n        for (int i = 0; i &lt; workSize; i++) {\n            executorService.submit(() -> {\n                try {\n                    semaphore.acquire(3);\n                    logger.info("进行业务逻辑处理");\n                    semaphore.release(3);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n\n        executorService.shutdown();\n        while (!executorService.isTerminated()) {\n\n        }\n\n\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[a("strong",[s._v("注意事项")])]),s._v(" "),a("ol",[a("li",[s._v("获取和释放的时候都可以指定数量，但是要保持一致。")]),s._v(" "),a("li",[s._v("公平性设置为"),a("strong",[s._v("true")]),s._v("会更加合理")]),s._v(" "),a("li",[s._v("并不必须由获取许可证的线程释放许可证。可以是A获取，B释放。")])]),s._v(" "),a("h2",{attrs:{id:"condition-条件对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#condition-条件对象"}},[s._v("#")]),s._v(" Condition(条件对象)")]),s._v(" "),a("p",[s._v("当A线程需要等待某个条件的时候，它就去执行"),a("code",[s._v("condition.await()")]),s._v("方法，一旦执行了"),a("code",[s._v("await()")]),s._v("方法，线程就会进入阻塞状态。")]),s._v(" "),a("p",[s._v("如果线程"),a("code",[s._v("B")]),s._v("执行"),a("code",[s._v("condition.signal()")]),s._v("方法，则"),a("code",[s._v("JVM")]),s._v("就会从被阻塞线程中找到等待该"),a("code",[s._v("condition")]),s._v("的线程。当线程A收到可执行信号的时候，他的线程状态就会变成"),a("code",[s._v("Runnable")]),s._v("可执行状态。")]),s._v(" "),a("h3",{attrs:{id:"基础使用示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础使用示例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("基础使用示例")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class ConditionObj {\n\n    private static Logger logger = LoggerFactory.getLogger(ConditionObj.class);\n\n\n    private ReentrantLock lock = new ReentrantLock();\n    //条件对象，操控线程的等待和通知\n    private Condition condition = lock.newCondition();\n\n    public void waitCondition() throws InterruptedException {\n        lock.lock();\n        try {\n            logger.info("等待达到条件后通知");\n            condition.await();\n            logger.info("收到通知，开始执行业务逻辑");\n        } finally {\n            lock.unlock();\n            logger.info("执行完成，释放锁");\n        }\n    }\n\n\n    public void notifyCondition() throws InterruptedException {\n        lock.lock();\n        try {\n            logger.info("达到条件发起通知");\n            condition.signal();\n            logger.info("发起通知结束");\n        } finally {\n            lock.unlock();\n            logger.info("发起通知执行完成，释放锁");\n        }\n    }\n\n\n    public static void main(String[] args) throws InterruptedException {\n        ConditionObj obj = new ConditionObj();\n\n        new Thread(() -> {\n            try {\n                obj.waitCondition();\n                //让出CPU时间片，交给主线程发起通知\n                Thread.sleep(3000);\n            } catch (InterruptedException e) {\n                logger.error("等待条件通知设置失败，失败原因 [{}]", e.getMessage(), e);\n            }\n        }).start();\n\n\n        Thread.sleep(3000);\n        obj.notifyCondition();\n    }\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br")])]),a("h3",{attrs:{id:"基于条件对象完成生产者、消费者模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于条件对象完成生产者、消费者模式"}},[s._v("#")]),s._v(" ** 基于条件对象完成生产者、消费者模式**")]),s._v(" "),a("p",[s._v("我们假设用一个队列存放一波生产者生产的资源，当资源满了通知消费者消费。当消费者消费空了，通知生产者生产。")]),s._v(" "),a("p",[s._v("所以这时候使用condition控制流程最合适。所以我们要定义两个信号，分别为:")]),s._v(" "),a("ol",[a("li",[s._v("资源未满(notFull): 生产者唤醒，消费者挂起。")]),s._v(" "),a("li",[s._v("资源为空(notEmpty):生产者挂起，消费者唤醒。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230724102915181.png",alt:"image-20230724102915181"}})]),s._v(" "),a("p",[s._v("最终示例代码如下")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class ProducerMode {\n    private static Logger logger = LoggerFactory.getLogger(ProducerMode.class);\n    //锁\n    private static ReentrantLock lock = new ReentrantLock();\n    // 资源未满\n    private Condition notFull = lock.newCondition();\n    //资源为空\n    private Condition notEmpty = lock.newCondition();\n\n    private Queue&lt;Integer> queue = new PriorityQueue&lt;>(10);\n    private int queueMaxSize = 10;\n\n    /**\n     * 生产者\n     */\n    private class Producer extends Thread {\n        @Override\n        public void run() {\n\n            while (true) {\n                lock.lock();\n\n                try {\n                    if (queueMaxSize == queue.size()) {\n                        logger.info("当前队列已满，通知消费者消费");\n                        //等待不满条件触发\n                        notFull.await();\n\n                    }\n\n                    queue.offer(1);\n                    logger.info("生产者补货，当前队列有 【{}】", queue.size());\n                    //通知消费者队列不空，可以消费\n                    notEmpty.signal();\n                } catch (Exception e) {\n                    logger.error("生产者报错,失败原因 [{}]", e.getMessage(), e);\n                } finally {\n                    lock.unlock();\n                }\n\n\n            }\n        }\n    }\n\n\n    /**\n     * 消费者\n     */\n    private class Consumer extends Thread {\n        @Override\n        public void run() {\n\n            while (true) {\n                lock.lock();\n\n                try {\n                    if (0 == queue.size()) {\n                        logger.info("当前队列已空，通知生产者补货");\n                        //等待不空条件达到\n                        notEmpty.await();\n\n                    }\n\n                    queue.poll();\n                    //通知消费者不满了\n                    notFull.signal();\n                    logger.info("消费者完成消费，当前队列还剩余 【{}】个元素", queue.size());\n                } catch (Exception e) {\n                    logger.error("生产者报错,失败原因 [{}]", e.getMessage(), e);\n                } finally {\n                    lock.unlock();\n                }\n\n\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        ProducerMode mode = new ProducerMode();\n        Producer producer = mode.new Producer();\n        Consumer consumer = mode.new Consumer();\n        producer.start();\n        consumer.start();\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br")])]),a("p",[s._v("输出结果")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【1】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【2】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【3】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【4】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【5】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【6】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【7】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【8】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【9】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 生产者补货，当前队列有 【10】\n[Thread-0] INFO com.guide.thread.base.ProducerMode - 当前队列已满，通知消费者消费\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【9】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【8】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【7】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【6】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【5】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【4】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【3】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【2】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【1】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 消费者完成消费，当前队列还剩余 【0】个元素\n[Thread-1] INFO com.guide.thread.base.ProducerMode - 当前队列已空，通知生产者补货\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"循环栅栏对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环栅栏对象"}},[s._v("#")]),s._v(" 循环栅栏对象")]),s._v(" "),a("p",[s._v("直到指定数量的线程都到达同一个点，然后才一起继续执行。")]),s._v(" "),a("h3",{attrs:{id:"基础示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础示例"}},[s._v("#")]),s._v(" 基础示例")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class CyclicBarrierDemo {\n\n    private static Logger logger = LoggerFactory.getLogger(CyclicBarrierDemo.class);\n\n\n    public static void main(String[] args) {\n        CyclicBarrier cyclicBarrier = new CyclicBarrier(5, () -> {\n            try {\n                Thread.sleep(3000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            logger.info("到齐5个人，准备触发");\n        });\n\n\n        int poolSize = 10;\n        ExecutorService threadPool = Executors.newFixedThreadPool(poolSize);\n\n        for (int i = 0; i &lt; poolSize; i++) {\n            threadPool.submit(() -> {\n                String name = Thread.currentThread().getName();\n                logger.info("线程[{}]，已准备就绪，等待一波人员到期就出发", name);\n                try {\n                    cyclicBarrier.await();\n                } catch (Exception e) {\n                    logger.info("线程阻塞失败，失败原因 [{}]", e.getMessage(), e);\n                }\n                logger.info("已就绪5个线程，[{}]准备触发", name);\n            });\n        }\n\n        threadPool.shutdown();\n        while (!threadPool.isTerminated()) {\n\n        }\n    }\n\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("输出结果")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pool-1-thread-6] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-6]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-9] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-9]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-8] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-8]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-1] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-1]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-5] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-5]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-10] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-10]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-2] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-2]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-7] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-7]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-4] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-4]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-3] INFO com.guide.thread.base.CyclicBarrierDemo - 线程[pool-1-thread-3]，已准备就绪，等待一波人员到期就出发\n[pool-1-thread-5] INFO com.guide.thread.base.CyclicBarrierDemo - 到齐5个人，准备触发\n[pool-1-thread-5] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-5]准备触发\n[pool-1-thread-3] INFO com.guide.thread.base.CyclicBarrierDemo - 到齐5个人，准备触发\n[pool-1-thread-3] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-3]准备触发\n[pool-1-thread-6] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-6]准备触发\n[pool-1-thread-9] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-9]准备触发\n[pool-1-thread-1] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-1]准备触发\n[pool-1-thread-8] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-8]准备触发\n[pool-1-thread-2] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-2]准备触发\n[pool-1-thread-7] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-7]准备触发\n[pool-1-thread-10] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-10]准备触发\n[pool-1-thread-4] INFO com.guide.thread.base.CyclicBarrierDemo - 已就绪5个线程，[pool-1-thread-4]准备触发\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"与countdownlatch区别-重点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与countdownlatch区别-重点"}},[s._v("#")]),s._v(" 与CountDownLatch区别(重点)")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("CountDownLatch")]),s._v("用户事件，循环栅栏作用于线程。")]),s._v(" "),a("li",[s._v("循环栅栏可重复使用，"),a("code",[s._v("CountDownLatch")]),s._v("则不能。")])]),s._v(" "),a("h2",{attrs:{id:"exchanger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exchanger"}},[s._v("#")]),s._v(" Exchanger")]),s._v(" "),a("p",[s._v("Exchanger（交换者）是一个用于线程间协作的工具类。Exchanger用于进行线程间的数据交换。它提供一个同步点，在这个同步点，两个线程可以交换彼此的数据。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://2290653824-github-io.oss-cn-hangzhou.aliyuncs.com/image-20230724104914802.png",alt:"image-20230724104914802"}})]),s._v(" "),a("p",[s._v("这两个线程通过 exchange方法交换数据，如果第一个线程先执行exchange()方法，它会一直等待第二个线程也执行exchange方法，当两个线程都到达同步点时，这两个线程就可以交换数据，将本线程生产出来的数据传递给对方。")]),s._v(" "),a("p",[s._v("Exchanger可以用于遗传算法，遗传算法里需要选出两个人作为交配对象，这时候会交换两人的数据，并使用交叉规则得出2个交配结果。Exchanger也可以用于校对工作，比如我们需要将纸制银行流水通过人工的方式录入成电子银行流水，为了避免错误，采用AB岗两人进行录入，录入到Excel之后，系统需要加载这两个Excel，并对两个Excel数据进行校对，看看是否录入一致。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExchangerTest")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exchanger")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" exgr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exchanger")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorService")]),s._v(" threadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("newFixedThreadPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"银行流水A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// A录入银行流水数据 ")]),s._v("\n                    exgr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"银行流水B"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// B录入银行流水数据 ")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exgr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"B"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A和B数据是否一致："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"，A录入的是："')]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"，B录入是："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("B")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("假如两个线程有一个没有执行exchange()方法，则会一直等待，如果担心有特殊情况发生，避免一直等待，可以使用"),a("code",[s._v("exchange(V x, long timeOut, TimeUnit unit)")]),s._v("设置最大等待时长。")])])}),[],!1,null,null,null);a.default=t.exports}}]);