<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kafka之消费者 | baby sword‘s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="java后端技术总结，生活记录。个人笔记">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.53c04193.css" as="style"><link rel="preload" href="/assets/js/app.7d33bb02.js" as="script"><link rel="preload" href="/assets/js/2.15f2967d.js" as="script"><link rel="preload" href="/assets/js/166.0734abd2.js" as="script"><link rel="prefetch" href="/assets/js/10.dabe1a63.js"><link rel="prefetch" href="/assets/js/100.a2015101.js"><link rel="prefetch" href="/assets/js/101.86d0ebe4.js"><link rel="prefetch" href="/assets/js/102.9d17991d.js"><link rel="prefetch" href="/assets/js/103.d013e413.js"><link rel="prefetch" href="/assets/js/104.4580e90e.js"><link rel="prefetch" href="/assets/js/105.c98e8247.js"><link rel="prefetch" href="/assets/js/106.9512d8d6.js"><link rel="prefetch" href="/assets/js/107.dc6dd50f.js"><link rel="prefetch" href="/assets/js/108.36e17e32.js"><link rel="prefetch" href="/assets/js/109.952d543d.js"><link rel="prefetch" href="/assets/js/11.7ad42e2d.js"><link rel="prefetch" href="/assets/js/110.aae101ed.js"><link rel="prefetch" href="/assets/js/111.9ad19a52.js"><link rel="prefetch" href="/assets/js/112.0c3843ec.js"><link rel="prefetch" href="/assets/js/113.c5d4208b.js"><link rel="prefetch" href="/assets/js/114.09b4516e.js"><link rel="prefetch" href="/assets/js/115.8c6bacae.js"><link rel="prefetch" href="/assets/js/116.f6cb99af.js"><link rel="prefetch" href="/assets/js/117.d888ae3d.js"><link rel="prefetch" href="/assets/js/118.e1612eca.js"><link rel="prefetch" href="/assets/js/119.3b12ca64.js"><link rel="prefetch" href="/assets/js/12.d0f226ac.js"><link rel="prefetch" href="/assets/js/120.7bff079e.js"><link rel="prefetch" href="/assets/js/121.4e029ab8.js"><link rel="prefetch" href="/assets/js/122.f2575eb6.js"><link rel="prefetch" href="/assets/js/123.af6bedbe.js"><link rel="prefetch" href="/assets/js/124.1d9ff52d.js"><link rel="prefetch" href="/assets/js/125.8ce6c45b.js"><link rel="prefetch" href="/assets/js/126.74738876.js"><link rel="prefetch" href="/assets/js/127.469dca9c.js"><link rel="prefetch" href="/assets/js/128.733a2f9b.js"><link rel="prefetch" href="/assets/js/129.e3046663.js"><link rel="prefetch" href="/assets/js/13.ca9cb7b7.js"><link rel="prefetch" href="/assets/js/130.5f8a399c.js"><link rel="prefetch" href="/assets/js/131.f66f486f.js"><link rel="prefetch" href="/assets/js/132.3fcb4a90.js"><link rel="prefetch" href="/assets/js/133.e6a7cbf8.js"><link rel="prefetch" href="/assets/js/134.bc8d2a8b.js"><link rel="prefetch" href="/assets/js/135.240c78e9.js"><link rel="prefetch" href="/assets/js/136.008aca90.js"><link rel="prefetch" href="/assets/js/137.8bbcd666.js"><link rel="prefetch" href="/assets/js/138.bf695fc2.js"><link rel="prefetch" href="/assets/js/139.c00c9dc2.js"><link rel="prefetch" href="/assets/js/14.3885beda.js"><link rel="prefetch" href="/assets/js/140.1a2eba1e.js"><link rel="prefetch" href="/assets/js/141.c8600326.js"><link rel="prefetch" href="/assets/js/142.129fdc97.js"><link rel="prefetch" href="/assets/js/143.1bcbaa9c.js"><link rel="prefetch" href="/assets/js/144.77983828.js"><link rel="prefetch" href="/assets/js/145.18c96830.js"><link rel="prefetch" href="/assets/js/146.062c1576.js"><link rel="prefetch" href="/assets/js/147.4dffe67b.js"><link rel="prefetch" href="/assets/js/148.0a12fdd2.js"><link rel="prefetch" href="/assets/js/149.644d9858.js"><link rel="prefetch" href="/assets/js/15.981df7e3.js"><link rel="prefetch" href="/assets/js/150.3a56182c.js"><link rel="prefetch" href="/assets/js/151.abbd46e4.js"><link rel="prefetch" href="/assets/js/152.c54e620b.js"><link rel="prefetch" href="/assets/js/153.d9a8477a.js"><link rel="prefetch" href="/assets/js/154.c0737606.js"><link rel="prefetch" href="/assets/js/155.273b61be.js"><link rel="prefetch" href="/assets/js/156.ac322b48.js"><link rel="prefetch" href="/assets/js/157.29da92a5.js"><link rel="prefetch" href="/assets/js/158.20aa63c2.js"><link rel="prefetch" href="/assets/js/159.cb2bfda8.js"><link rel="prefetch" href="/assets/js/16.851e8b6c.js"><link rel="prefetch" href="/assets/js/160.c31eb98d.js"><link rel="prefetch" href="/assets/js/161.ba3b58c4.js"><link rel="prefetch" href="/assets/js/162.822b912d.js"><link rel="prefetch" href="/assets/js/163.fb89cac8.js"><link rel="prefetch" href="/assets/js/164.2ec85d97.js"><link rel="prefetch" href="/assets/js/165.80d69bc7.js"><link rel="prefetch" href="/assets/js/167.12b046ed.js"><link rel="prefetch" href="/assets/js/168.b0d4db24.js"><link rel="prefetch" href="/assets/js/169.238c1564.js"><link rel="prefetch" href="/assets/js/17.71993e7e.js"><link rel="prefetch" href="/assets/js/170.a20084f6.js"><link rel="prefetch" href="/assets/js/171.f7beebbd.js"><link rel="prefetch" href="/assets/js/172.edc29fbe.js"><link rel="prefetch" href="/assets/js/173.3fc5869c.js"><link rel="prefetch" href="/assets/js/174.82f26aa5.js"><link rel="prefetch" href="/assets/js/175.595120d6.js"><link rel="prefetch" href="/assets/js/176.05d37828.js"><link rel="prefetch" href="/assets/js/177.cd7feb20.js"><link rel="prefetch" href="/assets/js/178.a5982934.js"><link rel="prefetch" href="/assets/js/179.8c485f51.js"><link rel="prefetch" href="/assets/js/18.cba9194a.js"><link rel="prefetch" href="/assets/js/180.c219aac7.js"><link rel="prefetch" href="/assets/js/181.dfb84650.js"><link rel="prefetch" href="/assets/js/182.27cb275e.js"><link rel="prefetch" href="/assets/js/183.f163af9d.js"><link rel="prefetch" href="/assets/js/184.b18298e6.js"><link rel="prefetch" href="/assets/js/185.80fccb48.js"><link rel="prefetch" href="/assets/js/186.77df58b4.js"><link rel="prefetch" href="/assets/js/187.2ef89f60.js"><link rel="prefetch" href="/assets/js/188.fa837c00.js"><link rel="prefetch" href="/assets/js/189.28bd30b9.js"><link rel="prefetch" href="/assets/js/19.81dac5f4.js"><link rel="prefetch" href="/assets/js/190.29e7f541.js"><link rel="prefetch" href="/assets/js/191.0ba2207c.js"><link rel="prefetch" href="/assets/js/192.36dea193.js"><link rel="prefetch" href="/assets/js/193.cb147e1d.js"><link rel="prefetch" href="/assets/js/194.569ebd0a.js"><link rel="prefetch" href="/assets/js/195.fe0c4ebf.js"><link rel="prefetch" href="/assets/js/196.7943b4f0.js"><link rel="prefetch" href="/assets/js/197.15498b32.js"><link rel="prefetch" href="/assets/js/198.bf082825.js"><link rel="prefetch" href="/assets/js/199.f76dadbf.js"><link rel="prefetch" href="/assets/js/20.45d8ffc5.js"><link rel="prefetch" href="/assets/js/200.80915aee.js"><link rel="prefetch" href="/assets/js/201.0fcd5a5e.js"><link rel="prefetch" href="/assets/js/202.ac356c7f.js"><link rel="prefetch" href="/assets/js/203.8b9abdf7.js"><link rel="prefetch" href="/assets/js/204.ceb5d675.js"><link rel="prefetch" href="/assets/js/205.292242cf.js"><link rel="prefetch" href="/assets/js/206.2e9cbdce.js"><link rel="prefetch" href="/assets/js/207.7a9094b4.js"><link rel="prefetch" href="/assets/js/208.c7ad7eab.js"><link rel="prefetch" href="/assets/js/209.681223ee.js"><link rel="prefetch" href="/assets/js/21.7a9f257f.js"><link rel="prefetch" href="/assets/js/210.3bbf8260.js"><link rel="prefetch" href="/assets/js/211.5bd34e61.js"><link rel="prefetch" href="/assets/js/212.dc330741.js"><link rel="prefetch" href="/assets/js/213.3cc734f7.js"><link rel="prefetch" href="/assets/js/214.91079873.js"><link rel="prefetch" href="/assets/js/215.25a0181b.js"><link rel="prefetch" href="/assets/js/216.3cb6f681.js"><link rel="prefetch" href="/assets/js/217.0187eee5.js"><link rel="prefetch" href="/assets/js/218.bb486cfa.js"><link rel="prefetch" href="/assets/js/219.5ca601a6.js"><link rel="prefetch" href="/assets/js/22.6aa340ac.js"><link rel="prefetch" href="/assets/js/220.f2fbfd29.js"><link rel="prefetch" href="/assets/js/221.c343eb87.js"><link rel="prefetch" href="/assets/js/222.eccb8faf.js"><link rel="prefetch" href="/assets/js/223.b6ee70d7.js"><link rel="prefetch" href="/assets/js/224.049967fd.js"><link rel="prefetch" href="/assets/js/225.e5573f45.js"><link rel="prefetch" href="/assets/js/226.f6133f9b.js"><link rel="prefetch" href="/assets/js/227.1d2bb9be.js"><link rel="prefetch" href="/assets/js/228.92c248b8.js"><link rel="prefetch" href="/assets/js/229.2da9b7fb.js"><link rel="prefetch" href="/assets/js/23.a2a5f82e.js"><link rel="prefetch" href="/assets/js/230.1ed17ebe.js"><link rel="prefetch" href="/assets/js/231.f9a8d324.js"><link rel="prefetch" href="/assets/js/232.d073b6b8.js"><link rel="prefetch" href="/assets/js/233.bec9cdbd.js"><link rel="prefetch" href="/assets/js/234.cb6a1e28.js"><link rel="prefetch" href="/assets/js/235.ebb74d27.js"><link rel="prefetch" href="/assets/js/236.24044479.js"><link rel="prefetch" href="/assets/js/237.f7c04397.js"><link rel="prefetch" href="/assets/js/238.affa4a25.js"><link rel="prefetch" href="/assets/js/239.2b15684a.js"><link rel="prefetch" href="/assets/js/24.4f94869e.js"><link rel="prefetch" href="/assets/js/240.524a5283.js"><link rel="prefetch" href="/assets/js/241.a6f85fbc.js"><link rel="prefetch" href="/assets/js/242.a5012b0f.js"><link rel="prefetch" href="/assets/js/243.f2872f9d.js"><link rel="prefetch" href="/assets/js/244.af8dce4a.js"><link rel="prefetch" href="/assets/js/245.913dd95f.js"><link rel="prefetch" href="/assets/js/246.46085f09.js"><link rel="prefetch" href="/assets/js/247.cab3066d.js"><link rel="prefetch" href="/assets/js/248.6ffe9bd2.js"><link rel="prefetch" href="/assets/js/249.940ac997.js"><link rel="prefetch" href="/assets/js/25.8beba237.js"><link rel="prefetch" href="/assets/js/250.24f5729f.js"><link rel="prefetch" href="/assets/js/251.040b7687.js"><link rel="prefetch" href="/assets/js/252.fce23e02.js"><link rel="prefetch" href="/assets/js/253.6aa072a9.js"><link rel="prefetch" href="/assets/js/254.fced3292.js"><link rel="prefetch" href="/assets/js/255.81bdb3ab.js"><link rel="prefetch" href="/assets/js/256.eee8f018.js"><link rel="prefetch" href="/assets/js/257.258e3d5f.js"><link rel="prefetch" href="/assets/js/258.53764d35.js"><link rel="prefetch" href="/assets/js/259.44220dff.js"><link rel="prefetch" href="/assets/js/26.38f820a6.js"><link rel="prefetch" href="/assets/js/260.a78371e6.js"><link rel="prefetch" href="/assets/js/261.e47bec83.js"><link rel="prefetch" href="/assets/js/262.cdc1b042.js"><link rel="prefetch" href="/assets/js/263.83db8a83.js"><link rel="prefetch" href="/assets/js/264.2f01d4cb.js"><link rel="prefetch" href="/assets/js/265.e174d060.js"><link rel="prefetch" href="/assets/js/266.96c46fc6.js"><link rel="prefetch" href="/assets/js/267.b73d8242.js"><link rel="prefetch" href="/assets/js/268.a71f8ffc.js"><link rel="prefetch" href="/assets/js/269.d962ab34.js"><link rel="prefetch" href="/assets/js/27.7eb3747a.js"><link rel="prefetch" href="/assets/js/270.09b33473.js"><link rel="prefetch" href="/assets/js/271.68955791.js"><link rel="prefetch" href="/assets/js/272.c673e920.js"><link rel="prefetch" href="/assets/js/273.a5e8096c.js"><link rel="prefetch" href="/assets/js/274.9df9cd64.js"><link rel="prefetch" href="/assets/js/275.8ad49720.js"><link rel="prefetch" href="/assets/js/276.31c0a4dc.js"><link rel="prefetch" href="/assets/js/277.fb617ede.js"><link rel="prefetch" href="/assets/js/278.f0919232.js"><link rel="prefetch" href="/assets/js/279.ac800bcf.js"><link rel="prefetch" href="/assets/js/28.632f9819.js"><link rel="prefetch" href="/assets/js/280.f4c522e5.js"><link rel="prefetch" href="/assets/js/281.819aa80e.js"><link rel="prefetch" href="/assets/js/282.235df8a4.js"><link rel="prefetch" href="/assets/js/283.246395f4.js"><link rel="prefetch" href="/assets/js/284.5b296a3d.js"><link rel="prefetch" href="/assets/js/285.67018b71.js"><link rel="prefetch" href="/assets/js/286.a6ef00c7.js"><link rel="prefetch" href="/assets/js/287.99e52f33.js"><link rel="prefetch" href="/assets/js/288.18c31c85.js"><link rel="prefetch" href="/assets/js/289.2b552251.js"><link rel="prefetch" href="/assets/js/29.bfe31680.js"><link rel="prefetch" href="/assets/js/290.4b447987.js"><link rel="prefetch" href="/assets/js/291.3baa6247.js"><link rel="prefetch" href="/assets/js/292.8f5062ef.js"><link rel="prefetch" href="/assets/js/293.27c0a1dc.js"><link rel="prefetch" href="/assets/js/294.b0e5601c.js"><link rel="prefetch" href="/assets/js/295.f9b5b950.js"><link rel="prefetch" href="/assets/js/296.8a4a804f.js"><link rel="prefetch" href="/assets/js/297.01257458.js"><link rel="prefetch" href="/assets/js/298.4f017ceb.js"><link rel="prefetch" href="/assets/js/299.2da46571.js"><link rel="prefetch" href="/assets/js/3.65858833.js"><link rel="prefetch" href="/assets/js/30.1002dcb7.js"><link rel="prefetch" href="/assets/js/300.04bb66c3.js"><link rel="prefetch" href="/assets/js/301.9d789323.js"><link rel="prefetch" href="/assets/js/302.0905baf4.js"><link rel="prefetch" href="/assets/js/303.c6c45c69.js"><link rel="prefetch" href="/assets/js/304.00ef9abe.js"><link rel="prefetch" href="/assets/js/305.677e68b7.js"><link rel="prefetch" href="/assets/js/306.d0835ab7.js"><link rel="prefetch" href="/assets/js/307.bae3749e.js"><link rel="prefetch" href="/assets/js/308.ee85cd01.js"><link rel="prefetch" href="/assets/js/309.9d1f2a4b.js"><link rel="prefetch" href="/assets/js/31.558ae079.js"><link rel="prefetch" href="/assets/js/310.265d04c7.js"><link rel="prefetch" href="/assets/js/311.17cbe447.js"><link rel="prefetch" href="/assets/js/312.346fc5ee.js"><link rel="prefetch" href="/assets/js/313.76199886.js"><link rel="prefetch" href="/assets/js/314.d1057d8a.js"><link rel="prefetch" href="/assets/js/315.23751dda.js"><link rel="prefetch" href="/assets/js/316.d1e575c4.js"><link rel="prefetch" href="/assets/js/317.c2a8bc29.js"><link rel="prefetch" href="/assets/js/318.c547f900.js"><link rel="prefetch" href="/assets/js/319.3b387670.js"><link rel="prefetch" href="/assets/js/32.6f1977bb.js"><link rel="prefetch" href="/assets/js/320.0e4c3b38.js"><link rel="prefetch" href="/assets/js/321.6521e785.js"><link rel="prefetch" href="/assets/js/322.1f13f126.js"><link rel="prefetch" href="/assets/js/323.be785ecc.js"><link rel="prefetch" href="/assets/js/324.2d6515ef.js"><link rel="prefetch" href="/assets/js/325.0ab7f9ac.js"><link rel="prefetch" href="/assets/js/326.9b8a19a0.js"><link rel="prefetch" href="/assets/js/327.a6f2ffa3.js"><link rel="prefetch" href="/assets/js/328.ffb78689.js"><link rel="prefetch" href="/assets/js/329.caf6b6ea.js"><link rel="prefetch" href="/assets/js/33.373c3b91.js"><link rel="prefetch" href="/assets/js/330.f23dce5f.js"><link rel="prefetch" href="/assets/js/331.72924748.js"><link rel="prefetch" href="/assets/js/332.3836e7f7.js"><link rel="prefetch" href="/assets/js/333.67e7409c.js"><link rel="prefetch" href="/assets/js/334.b724e2e8.js"><link rel="prefetch" href="/assets/js/335.a3b2da56.js"><link rel="prefetch" href="/assets/js/336.2b428412.js"><link rel="prefetch" href="/assets/js/337.359508c5.js"><link rel="prefetch" href="/assets/js/338.b2326734.js"><link rel="prefetch" href="/assets/js/339.3bf7fea4.js"><link rel="prefetch" href="/assets/js/34.490080fd.js"><link rel="prefetch" href="/assets/js/340.d318bc78.js"><link rel="prefetch" href="/assets/js/341.2e4d7494.js"><link rel="prefetch" href="/assets/js/342.3dd76710.js"><link rel="prefetch" href="/assets/js/343.e06d2cd3.js"><link rel="prefetch" href="/assets/js/344.89f98670.js"><link rel="prefetch" href="/assets/js/345.ae8d10b7.js"><link rel="prefetch" href="/assets/js/346.2ca232aa.js"><link rel="prefetch" href="/assets/js/347.7093141c.js"><link rel="prefetch" href="/assets/js/348.4ded54aa.js"><link rel="prefetch" href="/assets/js/349.f2f3de7a.js"><link rel="prefetch" href="/assets/js/35.303e0d83.js"><link rel="prefetch" href="/assets/js/350.88f21b2b.js"><link rel="prefetch" href="/assets/js/351.df3bf6ec.js"><link rel="prefetch" href="/assets/js/352.5487b192.js"><link rel="prefetch" href="/assets/js/353.46746b90.js"><link rel="prefetch" href="/assets/js/354.44942fe7.js"><link rel="prefetch" href="/assets/js/355.c1941c58.js"><link rel="prefetch" href="/assets/js/356.08b96daf.js"><link rel="prefetch" href="/assets/js/357.61de5029.js"><link rel="prefetch" href="/assets/js/358.dd8ffb5f.js"><link rel="prefetch" href="/assets/js/359.13558983.js"><link rel="prefetch" href="/assets/js/36.a0d30943.js"><link rel="prefetch" href="/assets/js/360.2ad56070.js"><link rel="prefetch" href="/assets/js/361.3793119e.js"><link rel="prefetch" href="/assets/js/362.8f627cfe.js"><link rel="prefetch" href="/assets/js/363.47c7e111.js"><link rel="prefetch" href="/assets/js/364.1550afcc.js"><link rel="prefetch" href="/assets/js/365.8b746335.js"><link rel="prefetch" href="/assets/js/366.0b1fa772.js"><link rel="prefetch" href="/assets/js/367.ee23b98a.js"><link rel="prefetch" href="/assets/js/368.e438a39c.js"><link rel="prefetch" href="/assets/js/369.4a61dd03.js"><link rel="prefetch" href="/assets/js/37.4284cc0c.js"><link rel="prefetch" href="/assets/js/370.69adb26c.js"><link rel="prefetch" href="/assets/js/371.0192e779.js"><link rel="prefetch" href="/assets/js/372.6d850781.js"><link rel="prefetch" href="/assets/js/373.eb913a40.js"><link rel="prefetch" href="/assets/js/374.a1770de3.js"><link rel="prefetch" href="/assets/js/375.5493fcc6.js"><link rel="prefetch" href="/assets/js/376.9e13ab67.js"><link rel="prefetch" href="/assets/js/377.f9dee5a7.js"><link rel="prefetch" href="/assets/js/378.dade2491.js"><link rel="prefetch" href="/assets/js/379.707a72b7.js"><link rel="prefetch" href="/assets/js/38.a5f4c0b4.js"><link rel="prefetch" href="/assets/js/380.a754e171.js"><link rel="prefetch" href="/assets/js/381.0e200507.js"><link rel="prefetch" href="/assets/js/382.bff69b7e.js"><link rel="prefetch" href="/assets/js/383.0e26f22d.js"><link rel="prefetch" href="/assets/js/384.70cfdd5d.js"><link rel="prefetch" href="/assets/js/385.7cd56e59.js"><link rel="prefetch" href="/assets/js/386.8d8ae20c.js"><link rel="prefetch" href="/assets/js/387.017c1a90.js"><link rel="prefetch" href="/assets/js/388.003eda57.js"><link rel="prefetch" href="/assets/js/389.e9c2ebd4.js"><link rel="prefetch" href="/assets/js/39.d70df4df.js"><link rel="prefetch" href="/assets/js/390.ee4577b4.js"><link rel="prefetch" href="/assets/js/391.295ea24c.js"><link rel="prefetch" href="/assets/js/392.cd9b2c07.js"><link rel="prefetch" href="/assets/js/393.83e0324c.js"><link rel="prefetch" href="/assets/js/394.c5c6ee2a.js"><link rel="prefetch" href="/assets/js/395.5e92d62c.js"><link rel="prefetch" href="/assets/js/396.45440149.js"><link rel="prefetch" href="/assets/js/397.2e9c4d79.js"><link rel="prefetch" href="/assets/js/398.2faad846.js"><link rel="prefetch" href="/assets/js/399.d28827bb.js"><link rel="prefetch" href="/assets/js/4.be154c6d.js"><link rel="prefetch" href="/assets/js/40.0e7741b1.js"><link rel="prefetch" href="/assets/js/400.f47d0892.js"><link rel="prefetch" href="/assets/js/401.81b1faad.js"><link rel="prefetch" href="/assets/js/402.5dcee620.js"><link rel="prefetch" href="/assets/js/403.ca06d49f.js"><link rel="prefetch" href="/assets/js/404.0108fa08.js"><link rel="prefetch" href="/assets/js/405.c209c80d.js"><link rel="prefetch" href="/assets/js/406.22242ecd.js"><link rel="prefetch" href="/assets/js/407.636d72f6.js"><link rel="prefetch" href="/assets/js/408.2114030b.js"><link rel="prefetch" href="/assets/js/409.0376024e.js"><link rel="prefetch" href="/assets/js/41.12ed2989.js"><link rel="prefetch" href="/assets/js/410.1777965c.js"><link rel="prefetch" href="/assets/js/411.ef129704.js"><link rel="prefetch" href="/assets/js/412.94623570.js"><link rel="prefetch" href="/assets/js/413.ab7078ca.js"><link rel="prefetch" href="/assets/js/414.9af06b0d.js"><link rel="prefetch" href="/assets/js/415.e7de3e45.js"><link rel="prefetch" href="/assets/js/416.1a6c50b3.js"><link rel="prefetch" href="/assets/js/417.76759517.js"><link rel="prefetch" href="/assets/js/418.2dff2af0.js"><link rel="prefetch" href="/assets/js/419.4ecbfc19.js"><link rel="prefetch" href="/assets/js/42.9ce2dafa.js"><link rel="prefetch" href="/assets/js/420.7c34868f.js"><link rel="prefetch" href="/assets/js/421.538335ca.js"><link rel="prefetch" href="/assets/js/422.da47dc21.js"><link rel="prefetch" href="/assets/js/423.e3b38e9c.js"><link rel="prefetch" href="/assets/js/424.04a76082.js"><link rel="prefetch" href="/assets/js/425.419f9989.js"><link rel="prefetch" href="/assets/js/426.fffcc7ef.js"><link rel="prefetch" href="/assets/js/427.9e079a21.js"><link rel="prefetch" href="/assets/js/428.ce33c968.js"><link rel="prefetch" href="/assets/js/429.a4e784c3.js"><link rel="prefetch" href="/assets/js/43.444176d4.js"><link rel="prefetch" href="/assets/js/430.acdd537f.js"><link rel="prefetch" href="/assets/js/431.3d619af2.js"><link rel="prefetch" href="/assets/js/432.f73efd71.js"><link rel="prefetch" href="/assets/js/433.a4cfcb90.js"><link rel="prefetch" href="/assets/js/44.6b486ceb.js"><link rel="prefetch" href="/assets/js/45.2b0cc8b1.js"><link rel="prefetch" href="/assets/js/46.fd2da8aa.js"><link rel="prefetch" href="/assets/js/47.f7b70d96.js"><link rel="prefetch" href="/assets/js/48.5cc6e7e9.js"><link rel="prefetch" href="/assets/js/49.3ba51b5e.js"><link rel="prefetch" href="/assets/js/5.5aa9e0f7.js"><link rel="prefetch" href="/assets/js/50.cfb28ca0.js"><link rel="prefetch" href="/assets/js/51.1241594b.js"><link rel="prefetch" href="/assets/js/52.3fae4eef.js"><link rel="prefetch" href="/assets/js/53.553bfcb3.js"><link rel="prefetch" href="/assets/js/54.2662d576.js"><link rel="prefetch" href="/assets/js/55.94f132f1.js"><link rel="prefetch" href="/assets/js/56.c48de3a0.js"><link rel="prefetch" href="/assets/js/57.9205b377.js"><link rel="prefetch" href="/assets/js/58.618d72ce.js"><link rel="prefetch" href="/assets/js/59.bf2a8650.js"><link rel="prefetch" href="/assets/js/6.1063792f.js"><link rel="prefetch" href="/assets/js/60.2a047c47.js"><link rel="prefetch" href="/assets/js/61.d47fd11d.js"><link rel="prefetch" href="/assets/js/62.8c29dffd.js"><link rel="prefetch" href="/assets/js/63.16bb986d.js"><link rel="prefetch" href="/assets/js/64.bc64102f.js"><link rel="prefetch" href="/assets/js/65.1169c72f.js"><link rel="prefetch" href="/assets/js/66.824d09da.js"><link rel="prefetch" href="/assets/js/67.ce84321c.js"><link rel="prefetch" href="/assets/js/68.8595c270.js"><link rel="prefetch" href="/assets/js/69.89e05461.js"><link rel="prefetch" href="/assets/js/7.bccc53b9.js"><link rel="prefetch" href="/assets/js/70.8fbede4d.js"><link rel="prefetch" href="/assets/js/71.01a73ce4.js"><link rel="prefetch" href="/assets/js/72.1e0dd7f1.js"><link rel="prefetch" href="/assets/js/73.24f77f07.js"><link rel="prefetch" href="/assets/js/74.0c83a59d.js"><link rel="prefetch" href="/assets/js/75.bd6435e0.js"><link rel="prefetch" href="/assets/js/76.94a80511.js"><link rel="prefetch" href="/assets/js/77.a27d1809.js"><link rel="prefetch" href="/assets/js/78.83ab434c.js"><link rel="prefetch" href="/assets/js/79.cf8518ea.js"><link rel="prefetch" href="/assets/js/8.45f7d402.js"><link rel="prefetch" href="/assets/js/80.596962e9.js"><link rel="prefetch" href="/assets/js/81.63120495.js"><link rel="prefetch" href="/assets/js/82.21ad56f5.js"><link rel="prefetch" href="/assets/js/83.baab9377.js"><link rel="prefetch" href="/assets/js/84.f53f30b8.js"><link rel="prefetch" href="/assets/js/85.8523fba7.js"><link rel="prefetch" href="/assets/js/86.db32bca6.js"><link rel="prefetch" href="/assets/js/87.1154c1cd.js"><link rel="prefetch" href="/assets/js/88.3fe0517a.js"><link rel="prefetch" href="/assets/js/89.ba98eb57.js"><link rel="prefetch" href="/assets/js/9.84f6f752.js"><link rel="prefetch" href="/assets/js/90.7abbd7d9.js"><link rel="prefetch" href="/assets/js/91.62d46791.js"><link rel="prefetch" href="/assets/js/92.3738d8e0.js"><link rel="prefetch" href="/assets/js/93.558070f9.js"><link rel="prefetch" href="/assets/js/94.3c8015f9.js"><link rel="prefetch" href="/assets/js/95.4071db60.js"><link rel="prefetch" href="/assets/js/96.26f85934.js"><link rel="prefetch" href="/assets/js/97.5b1f6f77.js"><link rel="prefetch" href="/assets/js/98.0bd39397.js"><link rel="prefetch" href="/assets/js/99.51095dbe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53c04193.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="baby sword‘s blog" class="logo"> <span class="site-name can-hide">baby sword‘s blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><a href="/javakownledge/" class="link-title">java</a> <span class="title" style="display:none;">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javabasic/" class="nav-link">java基础</a></li><li class="dropdown-item"><!----> <a href="/javaadvance/" class="nav-link">java进阶</a></li></ul></div></div><div class="nav-item"><a href="/bigdata/" class="nav-link">大数据</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>mysql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysqlIndex/" class="nav-link">mysql索引</a></li><li class="dropdown-subitem"><a href="/mysqllog/" class="nav-link">mysql日志</a></li></ul></li><li class="dropdown-item"><h4>redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/singleredis/" class="nav-link">单机下的redis</a></li><li class="dropdown-subitem"><a href="/mostredis/" class="nav-link">集群下的redis</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见框架" class="dropdown-title"><a href="/structure/" class="link-title">常见框架</a> <span class="title" style="display:none;">常见框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/structure/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/structure/springboot/" class="nav-link">springboot</a></li><li class="dropdown-item"><!----> <a href="/structure/RPC/" class="nav-link">RPC</a></li><li class="dropdown-item"><!----> <a href="/structure/netty/" class="nav-link">netty</a></li><li class="dropdown-item"><!----> <a href="/structure/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/structure/maven/" class="nav-link">maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middleware/messageQueue/" class="nav-link">消息队列</a></li><li class="dropdown-item"><!----> <a href="/middleware/kafka/" class="nav-link">kafka</a></li><li class="dropdown-item"><!----> <a href="/middleware/zookeeper/" class="nav-link">zookeeper</a></li><li class="dropdown-item"><!----> <a href="/middleware/rocketmq/" class="nav-link">rocketmq</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计模式" class="dropdown-title"><a href="/designmode/" class="link-title">设计模式</a> <span class="title" style="display:none;">设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9685d5/" class="nav-link">七大设计原则</a></li><li class="dropdown-item"><!----> <a href="/create/" class="nav-link">创建型模式</a></li><li class="dropdown-item"><!----> <a href="/structural/" class="nav-link">结构型模式</a></li><li class="dropdown-item"><!----> <a href="/action/" class="nav-link">行为型模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><a href="/microservice/" class="link-title">微服务</a> <span class="title" style="display:none;">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/eureka/" class="nav-link">eureka</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nacos/" class="nav-link">nacos</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/computer/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operationsystem/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><a href="/work/" class="link-title">工作</a> <span class="title" style="display:none;">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/privateProject/" class="nav-link">个人项目</a></li><li class="dropdown-item"><!----> <a href="/privateInterviewExperience/" class="nav-link">个人面试面经</a></li><li class="dropdown-item"><!----> <a href="/stereotypedMemory/" class="nav-link">八股记忆</a></li><li class="dropdown-item"><!----> <a href="/workAccumulation/" class="nav-link">工作积累</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91dacf/404" class="nav-link">逻辑题</a></li><li class="dropdown-item"><h4>面试</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/91dacf/404" class="nav-link">百度后端实习二面</a></li></ul></li></ul></div></div> <a href="https://github.com/2290653824/myVuePressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/myAvator.png"> <div class="blogger-info"><h3>zhengjian</h3> <span>不敢承担失去的风险，是不可能抓住梦想的</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><a href="/javakownledge/" class="link-title">java</a> <span class="title" style="display:none;">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javabasic/" class="nav-link">java基础</a></li><li class="dropdown-item"><!----> <a href="/javaadvance/" class="nav-link">java进阶</a></li></ul></div></div><div class="nav-item"><a href="/bigdata/" class="nav-link">大数据</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>mysql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysqlIndex/" class="nav-link">mysql索引</a></li><li class="dropdown-subitem"><a href="/mysqllog/" class="nav-link">mysql日志</a></li></ul></li><li class="dropdown-item"><h4>redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/singleredis/" class="nav-link">单机下的redis</a></li><li class="dropdown-subitem"><a href="/mostredis/" class="nav-link">集群下的redis</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见框架" class="dropdown-title"><a href="/structure/" class="link-title">常见框架</a> <span class="title" style="display:none;">常见框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/structure/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/structure/springboot/" class="nav-link">springboot</a></li><li class="dropdown-item"><!----> <a href="/structure/RPC/" class="nav-link">RPC</a></li><li class="dropdown-item"><!----> <a href="/structure/netty/" class="nav-link">netty</a></li><li class="dropdown-item"><!----> <a href="/structure/mybatis/" class="nav-link">mybatis</a></li><li class="dropdown-item"><!----> <a href="/structure/maven/" class="nav-link">maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middleware/messageQueue/" class="nav-link">消息队列</a></li><li class="dropdown-item"><!----> <a href="/middleware/kafka/" class="nav-link">kafka</a></li><li class="dropdown-item"><!----> <a href="/middleware/zookeeper/" class="nav-link">zookeeper</a></li><li class="dropdown-item"><!----> <a href="/middleware/rocketmq/" class="nav-link">rocketmq</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计模式" class="dropdown-title"><a href="/designmode/" class="link-title">设计模式</a> <span class="title" style="display:none;">设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9685d5/" class="nav-link">七大设计原则</a></li><li class="dropdown-item"><!----> <a href="/create/" class="nav-link">创建型模式</a></li><li class="dropdown-item"><!----> <a href="/structural/" class="nav-link">结构型模式</a></li><li class="dropdown-item"><!----> <a href="/action/" class="nav-link">行为型模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><a href="/microservice/" class="link-title">微服务</a> <span class="title" style="display:none;">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SpringCloud</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/eureka/" class="nav-link">eureka</a></li></ul></li><li class="dropdown-item"><h4>SpringCloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nacos/" class="nav-link">nacos</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/computer/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operationsystem/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><a href="/work/" class="link-title">工作</a> <span class="title" style="display:none;">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/privateProject/" class="nav-link">个人项目</a></li><li class="dropdown-item"><!----> <a href="/privateInterviewExperience/" class="nav-link">个人面试面经</a></li><li class="dropdown-item"><!----> <a href="/stereotypedMemory/" class="nav-link">八股记忆</a></li><li class="dropdown-item"><!----> <a href="/workAccumulation/" class="nav-link">工作积累</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91dacf/404" class="nav-link">逻辑题</a></li><li class="dropdown-item"><h4>面试</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/91dacf/404" class="nav-link">百度后端实习二面</a></li></ul></li></ul></div></div> <a href="https://github.com/2290653824/myVuePressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>消息队列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/3e8038/" class="sidebar-link">如何安装kafka</a></li><li><a href="/pages/0c7d5a/" class="sidebar-link">kafka基础</a></li><li><a href="/pages/aa0248/" class="sidebar-link">常见命令行指令</a></li><li><a href="/pages/8c97a0/" class="sidebar-link">kafka可视化界面</a></li><li><a href="/pages/fc37f3/" class="sidebar-link">使用kafka时遇到的一些问题</a></li><li><a href="/pages/3a71bd/" class="sidebar-link">ProducerConfig</a></li><li><a href="/pages/b2eea9/" class="sidebar-link">kafka之生产者</a></li><li><a href="/pages/c9ead5/" class="sidebar-link">kafka消息丢失</a></li><li><a href="/pages/3334d8/" class="sidebar-link">kafka之broker</a></li><li><a href="/pages/91dacf/" aria-current="page" class="active sidebar-link">kafka之消费者</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_1-采用何种方式进行消费" class="sidebar-link">1. 采用何种方式进行消费</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_2-consumer的初始化-当启动一个消费者时-会做些什么" class="sidebar-link">2. consumer的初始化？当启动一个消费者时，会做些什么</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_3-consumer主要流程" class="sidebar-link">3. consumer主要流程!img</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_4-消费者组机制-重点" class="sidebar-link">4. 消费者组机制（重点）</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_5-rebalance-重分配机制" class="sidebar-link">5. rebalance 重分配机制</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_6-rebalance流程" class="sidebar-link">6. rebalance流程</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_7-consumer之位移提交机制" class="sidebar-link">7. Consumer之位移提交机制</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_8-位移提交的方式" class="sidebar-link">8.位移提交的方式</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_9-consumer-offsets存储" class="sidebar-link">9. _consumeroffsets存储</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_10-consumer-offsets创建过程" class="sidebar-link">10. _consumeroffsets创建过程</a></li><li class="sidebar-sub-header level2"><a href="/pages/91dacf/#_11-consumer消费进度监控" class="sidebar-link">11. consumer消费进度监控</a></li></ul></li><li><a href="/pages/bfb0f6/" class="sidebar-link">消费者源码</a></li><li><a href="/pages/f457ee/" class="sidebar-link">消费者的多线程方式</a></li><li><a href="/pages/d64aad/" class="sidebar-link">kafka之缓冲区</a></li><li><a href="/pages/83aa0f/" class="sidebar-link">kafka源码</a></li><li><a href="/pages/a8dddf/" class="sidebar-link">kafka个人技术分享</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>zookeeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>rocketMq</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/middleware/#中间件" data-v-06225672>中间件</a></li><li data-v-06225672><a href="/middleware/#kafka" data-v-06225672>kafka</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/xugaoyi" target="_blank" title="作者" class="beLink" data-v-06225672>xugaoyi</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-01-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">kafka之消费者<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="_1-采用何种方式进行消费"><a href="#_1-采用何种方式进行消费" class="header-anchor">#</a> 1. 采用何种方式进行消费</h2> <p><strong>Kafka Consumer 采用的是主动拉取 Broker 数据进行消费的即 Pull 模式</strong></p> <p>为什么不采用push模式？broker无法感知消费者消费消息的速度，可能会导致consumer的消息堆积</p> <p><strong>采用pull一定好吗？</strong></p> <p>如果 Kafka Broker 没有消息，这时每次 Consumer 拉取的都是空数据, 可能会一直循环返回空数据。 针对这个问题，Consumer 在每次调用 Poll() 消费数据的时候，顺带一个 timeout 参数，当返回空数据的时候，会在 Long Polling 中进行阻塞，等待 timeout 再去消费，直到数据到达。</p> <h2 id="_2-consumer的初始化-当启动一个消费者时-会做些什么"><a href="#_2-consumer的初始化-当启动一个消费者时-会做些什么" class="header-anchor">#</a> 2. consumer的初始化？当启动一个消费者时，会做些什么</h2> <p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/29475739/1668572061308-51ca5418-0cae-4994-a489-f30d4f1df4d7.jpeg" alt="img"></p> <ol><li><ol><li>构造 Propertity 对象，进行 Consumer 相关的配置；</li> <li>创建 KafkaConsumer 的对象 Consumer；</li> <li>订阅相应的 Topic 列表；</li> <li>调用 Consumer 的 poll() 方法拉取订阅的消息</li></ol></li></ol> <h2 id="_3-consumer主要流程"><a href="#_3-consumer主要流程" class="header-anchor">#</a> 3. consumer主要流程<img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668572201988-706f83d1-682e-4f2f-9e02-2adc66dcfd58.png" alt="img"></h2> <h2 id="_4-消费者组机制-重点"><a href="#_4-消费者组机制-重点" class="header-anchor">#</a> 4. 消费者组机制（重点）</h2> <p>a. 如果让单个消费者去消费一个topic，这样肯定是不满足kafka高性能的要求的。所以就设定了一个消费者组，让消费者组中的消费者去消费同一个topic。</p> <p>b. 同时如果一个消费者挂了，那么消费topic的行动就停止了，这不是对于容错性有一定的影响吗，我们希望当一个消费者挂了过后，另一个消费者可以仍消费一个topic中的信息，这样我们就可以依靠同一个消费组中的消费者消费同一个消费者</p> <p>消费组的特点：</p> <ol><li><ol><li>每个 Consumer Group 有一个或者多个 Consumer</li> <li>每个 Consumer Group 拥有一个公共且唯一的 Group ID</li> <li>Consumer Group 在消费 Topic 的时候，Topic 的每个 Partition 只能分配给组内的某个 Consumer，只要被任何 Consumer 消费一次, 那么这条数据就可以认为被当前 Consumer Group 消费成功</li></ol></li></ol> <p>那么消费组中是怎么为每个消费者分配消费的partion分区呢？</p> <ol><li>partion分配策略机制</li></ol> <p>kafka客户端提供了3种分配策略</p> <ul><li><p>RangeAssignor <strong>（<strong><strong>按照Kafka默认的消费逻辑设定，一个分区只能被同一个消费组（ConsumerGroup）内的一个消费者消费</strong></strong>）</strong></p> <p><strong>RangeAssignor 是 Kafka 默认的分区分配算法，它是按照 Topic 的维度进行分配的</strong>，对于每个 Topic，首先对 Partition 按照分区ID进行排序，然后对订阅这个 Topic 的 Consumer Group 中的 Consumer 再进行排序，之后尽量<strong>均衡的按照范围区段</strong>将分区分配给 Consumer。此时可能会造成先分配分区的 Consumer 进程的任务过重（分区数无法被消费者数量整除）。</p></li></ul> <p>案例如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573041690-b05a0606-c934-4769-a0eb-3be4f5e8ea95.png" alt="img"><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573044557-c33406c8-cd99-4c07-a026-9b8f4d149daa.png" alt="img"><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573047359-d884932d-2d0c-4c66-a8b5-b9e9b460219e.png" alt="img"></p> <p>另一种展示如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573182168-31631dd7-f0e3-4437-bfaf-5bdfeca286ce.png" alt="img"></p> <p>另一种展示：</p> <p>对于每个被订阅的Topic，设Consumer总数为c，Partition总数为p，那么RangeAssignor会根据p / c的结果得出一个区间值r，以及余数值p % c，记为m。</p> <p>将所有Consumer按照预设好的Member ID字典序排序，从第一个Consumer开始顺序分配，前m个Consumer分配连续的(r + 1)个Partition，后(c - m)个Consumer分配连续的r个Partition。</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573676630-0d5d9641-2eb7-4f1b-afa4-cfc641607077.png" alt="img"></p> <p>如果多增加2个topic：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573704926-3d8298df-a3b5-4a25-8faa-869946beee61.png" alt="img"></p> <p>当一个topic中partion数小于订阅它的consumer数时，会出现consumer失效</p> <p>问题：</p> <p><strong>这种分配方式明显的问题就是随着消费者订阅的Topic的数量的增加，不均衡的问题会越来越严重。</strong></p> <ul><li><p><strong>RoundRobinAssignor</strong></p> <p>RoundRobinAssignor 的分区分配策略是将 Consumer Group 内订阅的所有 Topic 的 Partition 及所有 Consumer 进行排序后按照顺序尽量均衡的一个一个进行分配。如果 Consumer Group 内，每个 Consumer 订阅都订阅了相同的Topic，那么分配结果是均衡的。如果订阅 Topic 是不同的，那么分配结果是不保证“尽量均衡”的，因为某些 Consumer 可能不参与一些 Topic 的分配。</p></li></ul> <p>案例1：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573923052-d692886d-cd9d-4ff8-a741-0a000a0eac74.png" alt="img"></p> <p>案例2：</p> <p>将所有主题的分区组成 TopicAndPartition 列表，然后对 TopicAndPartition 列表按照 hashCode 进行排序，然后平均分配<img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574039800-8f4f5b84-9153-4e62-abd4-b1f130a73972.png" alt="img">给每一个消费者的线程。</p> <p>多个Topic的情况也类似：<img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574051306-e31275ca-7eed-43cf-bf09-af707c5fe2fa.png" alt="img"></p> <p>由于分配时是按所有Partition来的，所以即使Topic之间Partition的数量是不平均的，分配结果也是基本平均的，克服了RangeAssignor的缺点。</p> <p>缺点： <strong>当组内每个订阅的 Topic 是不同情况，这样就可能会造成分区订阅的倾斜:</strong></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668573956576-09a4e004-d4b5-431f-adb1-f005a41b0169.png" alt="img"></p> <p>如果同一个消费组内的消费者所订阅的信息是不相同的，那么在执行分区分配的时候就不是完全的轮询分配，有可能会导致分区分配的不均匀。如果某个消费者没有订阅消费组内的某个topic，那么在分配分区的时候此消费者将分配不到这个topic的任何分区。</p> <p>案例：opic t0、t1、t2分别有1、2、3个Partition，而Consumer c0订阅了t0，c1订阅了t0~t1，c2订阅了t0~t2</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574159188-abe7ad44-e7c7-45a0-b49f-7fe08f13cbce.png" alt="img"></p> <ul><li>StickAssignor（较为复杂，但也是精髓所在）</li></ul> <p><strong>StickyAssignor 分区分配算法</strong>是 Kafka Java 客户端提供的分配策略中最复杂的一种，可以通过 partition.assignment.strategy 参数去设置，从 0.11 版本开始引入，目的就是在执行新分配时，尽量在上一次分配结果上少做调整，其主要实现了以下2个目标：</p> <p><strong>1)、Topic Partition 的分配要尽量均衡。</strong></p> <p><strong>2)、当 Rebalance(重分配，后面会详细分析) 发生时，尽量与上一次分配结果保持一致。</strong></p> <p><strong>注意：当两个目标发生冲突的时候，优先保证第一个目标，这样可以使分配更加均匀，其中第一个目标是3种分配策略都尽量去尝试完成的， 而第二个目标才是该算法的精髓所在。</strong></p> <p>案例讲解1:</p> <p>​       <strong>1）组内每个 Consumer 订阅的 Topic 是相同情况，RoundRobinAssignor 跟StickyAssignor 分配一致：</strong><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574325515-81d591c7-ff34-463a-b26e-f772b91c562c.png" alt="img"></p> <p>​        <strong>当上述情况发生 Rebalance 情况后，可能分配会不太一样，假如这时候C1发生故障下线：</strong></p> <p><strong>RoundRobinAssignor：</strong><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574508778-4067e440-3d9e-4710-a3bb-643e7deafa9d.png" alt="img"></p> <p><strong>StickyAssignor：</strong></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574546472-4e055958-0249-443d-9878-828fcf9647bc.png" alt="img"></p> <p>​       <strong>结论: 从上面 Rebalance 后的结果可以看出，虽然两种分配策略最后都是均匀分配的，但是 RoundRoubinAssignor 完全是重新分配了一遍，而 StickyAssignor 则是在原先的基础上达到了均匀的状态。</strong></p> <p><strong>2)</strong> <strong>当组内每个</strong> <strong>Consumer</strong> <strong>订阅的 Topic 是不同情况</strong>**😗*</p> <p><strong>RoundRobinAssignor：</strong></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574681733-ff8c73b7-4f03-4936-b917-79105d4abbf3.png" alt="img"></p> <p>​        <strong>StickyAssignor：</strong></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574759160-30bb93e6-29dc-42c8-83ef-a81adc64e8ae.png" alt="img"></p> <p>​      <strong>当上述情况发生 Rebalance 情况后，可能分配会不太一样，假如这时候C1发生故障下线：</strong></p> <p><strong>RoundRobinAssignor：</strong></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574783879-b42a3d82-34c7-4c42-9fe5-1e247cf72f42.png" alt="img"></p> <p><strong>StickyAssignor：</strong></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668574792705-bc5ca65f-6776-47e0-9978-7d644f4d75a5.png" alt="img"></p> <p>​     从上面结果可以看出，RoundRoubin 的分配策略在 Rebalance (重分配)之后造成了严重的分配倾斜。<strong>因此在生产环境上如果想要减少重分配带来的开销，可以选用 StickyAssignor 的分区分配策略。</strong></p> <h2 id="_5-rebalance-重分配机制"><a href="#_5-rebalance-重分配机制" class="header-anchor">#</a> 5. rebalance 重分配机制</h2> <p>Consumer Group 来说，可能随时都会有 Consumer 加入或退出，那么 Consumer 列表的变化必定会引起 Partition 的重新分配。我们将这个分配过程叫做 <strong>Consumer Rebalance，但是这个分配过程需要借助 Broker 端的 Coordinator 协调者组件，在 Coordinator 的帮助下完成整个消费者组的分区重分配</strong>，<strong>也是通过监听ZooKeeper 的 /admin/reassign_partitions 节点触发的。</strong></p> <p>重分配触发三种条件：</p> <ol><li>当 Consumer Group 组成员数量发生变化(主动加入或者主动离组，故障下线等)</li> <li>当订阅主题数量发生变化</li> <li>当订阅主题的分区数发生变化</li></ol> <p>rebalance如何通知其他consumer进程</p> <p>Rebalance 的通知机制就是<strong>靠 Consumer 端的心跳线程</strong>，它会定期发送心跳请求到 Broker 端的 Coordinator,当协调者决定开启 Rebalance 后，它会将“REBALANCE_IN_PROGRESS”封装</p> <p>进心跳请求的响应中发送给 Consumer ,当 Consumer 发现心跳响应中包含了“REBALANCE_IN_PROGRESS”，就知道 Rebalance 开始了。</p> <p>rebalance协议：</p> <p>​         其实 Rebalance 本质上也是一组协议。Consumer Group 与 Coordinator 共同使用它来完成 Consumer Group 的 Rebalance。下面我看看这5种协议都是什么，完成了什么功能：</p> <ol><li>Heartbeat请求：Consumer 需要定期给 Coordinator 发送心跳来证明自己还活着。</li> <li>LeaveGroup请求：主动告诉 Coordinator 要离开 Consumer Group</li> <li>SyncGroup请求：Group Leader Consumer 把分配方案告诉组内所有成员</li> <li>JoinGroup请求：成员请求加入组</li> <li>DescribeGroup请求：显示组的所有信息，包括成员信息，协议名称，分配方案，订阅信息等。通常该请求是给管理员使用。<strong>Coordinator 在 Rebalance 的时候主要用到了前面4种请求</strong></li></ol> <p><strong>Consumer Group状态机</strong></p> <p>​       Rebalance 一旦发生，必定会涉及到 Consumer Group 的状态流转，此时 Kafka 为我们设计了一套完整的状态机机制，来帮助 Broker Coordinator 完成整个重平衡流程。了解整个状态流转过程可以帮助我们深入理解 Consumer Group 的设计原理。</p> <ul><li>Empty状态：</li></ul> <p>​     Empty 状态表示当前组内无成员， 但是可能存在 Consumer Group 已提交的位移数据，且未过期，这种状态只能响应 JoinGroup 请求。</p> <ul><li>Dead状态</li></ul> <p>​    Dead 状态表示组内已经没有任何成员的状态，组内的元数据已经被 Broker Coordinator 移除，这种状态响应各种请求都是一个Response：UNKNOWN_MEMBER_ID。</p> <ul><li>PreparingRebalance</li></ul> <p>​     PreparingRebalance 状态表示准备开始新的 Rebalance, 等待组内所有成员重新加入组内</p> <ul><li>CompletingRebalance</li></ul> <p>​     CompletingRebalance 状态表示组内成员都已经加入成功，正在等待分配方案，旧版本中叫“AwaitingSync”。</p> <ul><li>Stable</li></ul> <p>​     Stable 状态表示 Rebalance 已经完成， 组内 Consumer 可以开始消费了。</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668575562977-8f03d7d7-e56b-4cca-a82e-075e4a3cbd56.png" alt="img"></p> <h2 id="_6-rebalance流程"><a href="#_6-rebalance流程" class="header-anchor">#</a> 6. rebalance流程</h2> <p><strong>Rebalance 主要分为两个步骤：加入组(对应JoinGroup请求)和等待 Leader Consumer 分配方案(SyncGroup 请求)。</strong></p> <p>​      1)、JoinGroup 请求: 组内所有成员向 Coordinator 发送 JoinGroup 请求，请求加入组，顺带会上报自己订阅的 Topic，这样 Coordinator 就能收集到所有成员的 JoinGroup 请求和订阅 Topic 信息，Coordinator 就会从这些成员中选择一个担任这个Consumer Group 的 Leader(一般情况下，第一个发送请求的 Consumer 会成为 Leader)，<strong>这里说的Leader 是指具体的某一个 consumer，它的任务就是收集所有成员的订阅 Topic 信息，然后制定具体的消费分区分配方案</strong>。待选出 Leader 后，Coordinator 会把 Consumer Group 的订阅 Topic 信息封装进 JoinGroup 请求的 Response 中，然后发给 Leader ，然后由 Leader 统一做出分配方案后，进入到下一步，如下图：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668590822857-0d81e9fa-b534-4572-815d-dd979c1f8db8.png" alt="img">       2)、SyncGroup 请求:  Leader 开始分配消费方案，<strong>即哪个 Consumer 负责消费哪些 Topic 的哪些 Partition</strong>。一旦完成分配，Leader 会将这个分配方案封装进 SyncGroup 请求中发给 Coordinator ，其他成员也会发 SyncGroup 请求，只是内容为空，待 Coordinator 接收到分配方案之后会把方案封装进 SyncGroup 的 Response 中发给组内各成员, 这样各自就知道应该消费哪些 Partition 了，如下图：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668591086594-e25241e5-3e96-4f7a-938b-0f68f8504564.png" alt="img"></p> <p><strong>Rebalance场景分析</strong></p> <p><strong>①</strong>场景一：新成员(c1)加入组</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668591467645-e3668365-df35-4413-9be6-26ba0d12a949.png" alt="img"></p> <p>② 场景二：成员(c2)主动离组</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668591630215-5af9a2dc-b0a7-4a5e-bb32-e9ad89712bd6.png" alt="img"></p> <p>③       场景三：成员(c2)超时被踢出组</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668591664874-ec3489ff-6887-4b60-84b7-4a981130a643.png" alt="img"></p> <p>④ 场景四：成员(c2)提交位移数据</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668591677500-e1e32eb3-1c58-43b1-9c86-f69bd189e922.png" alt="img"></p> <p>在超时前，完成位移的提交</p> <p>rebalance会产生哪些问题？</p> <p>三、rebalance的影响</p> <p>Rebalance对我们数据的影响主要有以下几点：</p> <p>1、可能重复消费: Consumer被踢出消费组，可能还没有提交offset，Rebalance时会Partition重新分配其它Consumer,会造成重复消费，虽有幂等操作但耗费消费资源，亦增加集群压力</p> <p>2、集群不稳定：Rebalance扩散到整个ConsumerGroup的所有消费者，因为一个消费者的退出，导致整个Group进行了Rebalance，并在一个比较慢的时间内达到稳定状态，影响面较大</p> <p>3、影响消费速度：频繁的Rebalance反而降低了消息的消费速度，大部分时间都在重复消费和Rebalance</p> <h2 id="_7-consumer之位移提交机制"><a href="#_7-consumer之位移提交机制" class="header-anchor">#</a> 7. Consumer之位移提交机制</h2> <p>上面聊完消费者组 Rebalance 机制后，我们来聊聊 Consumer 的位移提交机制，在聊位移提交之前，我们回顾一下 <strong>位移</strong> 和 <strong>消费者位移</strong> 之间的区别。通常所说的位移是指 Topic Partition 在 Broker 端的存储偏移量，而消费者位移则是指某个 Consumer Group 在不同 Topic Partition 上面的消费偏移量（也可以理解为消费进度），<strong>它记录了 Consumer 要消费的下一条消息的位移</strong>。</p> <p><strong>Consumer 需要向 Kafka 上报自己的位移数据信息，我们将这个上报过程叫做提交位移（Committing Offsets）</strong>。它是为了保证 Consumer的消费进度正常，当 Consumer 发生故障重启后， 可以直接从之前提交的 Offset 位置开始进行消费而不用重头再来一遍（Kafka 认为小于提交的 Offset 的消息都已经成功消费了），Kafka 设计了这个机制来保障消费进度。<strong>我们知道 Consumer 可以同时去消费多个分区的数据，所以位移提交是按照分区的粒度进行上报的，也就是说</strong> <strong>Consumer 需要为分配给它的每个分区提交各自的位移数据。</strong></p> <h2 id="_8-位移提交的方式"><a href="#_8-位移提交的方式" class="header-anchor">#</a> 8.位移提交的方式</h2> <p><strong>自动提交产生的消息丢失和消息重复问题</strong></p> <p>从用户的角度：自动提交、手动提交</p> <p>从kafka角度：同步提交、异步提交</p> <p>①自动提交</p> <p><strong>自动提交是指</strong> **Kafka Consumer 在后台默默地帮我们提交位移，用户不需要关心这个事情。**启用自动提交位移，在 初始化 KafkaConsumer 的时候，通过设置参数 <strong>enable.auto.commit = true</strong> (默认为true)，开启之后还需要另外一个参数进行配合即 <strong>auto.commit.interval.ms</strong>，这个参数表示 Kafka Consumer 每隔 X 秒自动提交一次位移，这个值默认是5秒。</p> <p>自动提交看起来是挺美好的, 那么**自动提交会不会出现消费数据丢失的情况呢？**在设置了 <strong>enable.auto.commit = true</strong> 的时候，Kafka 会保证在开始调用 Poll() 方法时，提交上一批消息的位移，再处理下一批消息, 因此它能保证不出现消费丢失的情况。</p> <p>其实也还是会<strong>出现消息丢失</strong>的情况，比如consumer拉取0-100条信息，自动提交间隔为5s，当过去5s后，消费者提交位移101，但是只处理了逻辑50条，如果此时consumer宕机，下次拉取数据是从101开始，那么51-100的数据就会丢失，因为这些数据没有被逻辑处理过。</p> <p>但<strong>自动提交位移也有设计缺陷，那就是它可能会出现重复消费</strong>。<strong>就是在自动提交间隔之间发生 Rebalance 的时候，此时 Offset 还未提交，待 Rebalance 完成后， 所有 Consumer 需要将发生 Rebalance 前的消息进行重新消费一次。</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>在默认情况下，Consumer 每 5 秒自动提交一次位移。现在，我们假设提交位移之后的 3 秒发生了 Rebalance 操作。在 Rebalance 之后，所有 Consumer 从上一次提交的位移处继续消费，但该位移已经是 3 秒前的位移数据了，故在 Rebalance 发生前 3 秒消费的所有数据都要重新再消费一次。虽然你能够通过减少 auto.commit.interval.ms 的值来提高提交频率，但这么做只能缩小重复消费的时间窗口，不可能完全消除它。这是自动提交机制的一个缺陷。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>②手动提交</strong></p> <p>与自动提交相对应的就是手动提交了。开启手动提交位移的方法就是在初始化KafkaConsumer 的时候设置参数 **enable.auto.commit = false，**但是只设置为 false 还不行，它只是告诉 Kafka Consumer 不用自动提交位移了，你还需要在处理完消息之后调用相应的  Consumer API 手动进行提交位移，<strong>对于手动提交位移，又分为同步提交和异步提交。</strong></p> <p><strong>1)、同步提交API：</strong></p> <p>**KafkaConsumer#commitSync()，**该方法会提交由 KafkaConsumer#poll() 方法返回的最新位移值，它是一个同步操作，会一直阻塞等待直到位移被成功提交才返回，如果提交的过程中出现异常，该方法会将异常抛出。这里我们知道在调用 <strong>commitSync() 方法的时机</strong>是在处理完 Poll() 方法返回所有消息之后进行提交，如果过早的提交了位移就会出现消费数据丢失的情况。</p> <p><strong>2)、异步提交API：</strong></p> <p>**KafkaConsumer#commitAsync()，**该方法是异步方式进行提交的，调用 commitAsync() 之后，它会立即返回，并不会阻塞，因此不会影响 Consumer 的 TPS。另外 Kafka 针对它提供了callback，方便我们来实现提交之后的逻辑，比如记录日志或异常处理等等。由于它是一个异步操作， 假如出现问题是不会进行重试的，这时候重试位移值可能已不是最新值，所以重试无意义。</p> <p><strong>3)、混合提交模式：</strong></p> <p>**从上面分析可以得出 commitSync 和 commitAsync 都有自己的缺陷，**我们需要将 commitSync 和 commitAsync 组合使用才能到达最理想的效果，既不影响 Consumer TPS，又能利用 commitSync 的自动重试功能来避免一些瞬时错误（网络抖动，GC，Rebalance 问题)，<strong>在生产环境中建议大家使用混合提交模式来提高 Consumer的健壮性</strong>。</p> <h2 id="_9-consumer-offsets存储"><a href="#_9-consumer-offsets存储" class="header-anchor">#</a> 9. __consumer_offsets存储</h2> <p><strong>kafka高版本中为什么将位移提交信息放在kafka中？</strong></p> <p>消费者消费完数据后需要提交位移，那么将位移提交在哪儿呢？以何种方式存储呢？</p> <p>我们知道 Kafka 旧版本（0.8版本之前）是重度依赖 Zookeeper 来实现各种各样的协调管理，当然旧版本的 Consumer Group 是把位移保存在 ZooKeeper 中，减少 Broker 端状态存储开销，鉴于 Zookeeper 的存储架构设计来说， 它不适合频繁写更新，而 Consumer Group 的位移提交又是高频写操作，这样会拖慢 ZooKeeper 集群的性能， <strong>于是在新版 Kafka 中， 社区重新设计了 Consumer Group 的位移管理方式，采用了将位移保存在 Kafka 内部（这是因为 Kafka Topic 天然支持高频写且持久化），这就是所谓大名鼎鼎的__consumer_offsets</strong>。</p> <div class="language- extra-class"><pre><code>__consumer_offsets：用来保存 Kafka Consumer 提交的位移信息，另外它是由 Kafka 自动创建的，和普通的 Topic 相同，它的消息格式也是 Kafka 自己定义的，我们无法进行修改。这里我们很好奇它的消息格式究竟是怎么样的，让我们来一起分析并揭开它的神秘面纱吧。
</code></pre></div><p><strong>具体的消息格式：</strong></p> <ol><li>所谓的消息格式我们可以简单理解为是一个 KV 对。Key 和 Value 分别表示消息的键值和消息体。</li> <li>那么 Key 存什么呢？既然是存储 Consumer 的位移信息，在 Kafka 中，Consumer 数量会很多，那么必须有字段来标识这个位移数据是属于哪个 Consumer的，怎么来标识 Consumer 字段呢？前面在讲解 Consumer Group 的时候我们知道它共享一个公共且唯一的<strong>Group ID</strong>，那么只保存它就可以了吗？我们知道 Consumer 提交位移是在分区的维度进行的，很显然，key中还应该保存 Consumer 要提交位移的分区。</li> <li>总结：<strong>位移主题的 Key 中应该保存 3 部分内容：&lt;Group ID，主题名，分区号 &gt;</strong></li></ol> <p><strong>这里说明一下，前面我们页说明了每个消费者会提交其消费的所有partion的位移。即所有消费都是从partion中取数据，所以我们不需要记录具体某个消费者的信息，只需要记录消费者组的信息，一个消费者只需要拿到当前消费者组id以及其订阅的topic和自己对应的partion，就可以知道当前消费者应该消费哪条消息。</strong></p> <ol><li>value 可以简单认为存储的是offset值，当然底层还存储其他一些元数据，帮助 Kafka 来完成一些其他操作，比如删除过期位移数据等。</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668610100305-0c4f0ca5-983c-43b9-9a33-4da023727074.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668610106458-8e053b3b-7e76-4120-93d8-2257a125bbe1.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29475739/1668610110692-9115d6ed-e75a-4616-8092-73cd2adef72a.png" alt="img"></p> <h2 id="_10-consumer-offsets创建过程"><a href="#_10-consumer-offsets创建过程" class="header-anchor">#</a> 10. __consumer_offsets创建过程</h2> <p>聊完消息格式后， 我们来聊聊  <strong>__consumer_offsets 是怎么被创建出来的呢？ 当 Kafka 集群中的第一个 Consumer 启动时，Kafka 会自动创建__consumer_offsets</strong>。前面说过，它就是普通的 Topic， 它也有对应的分区数，如果由 Kafka 自动创建的，那么分区数又是怎么设置的呢？这个依赖 <strong>Broker 端参数 offsets.topic.num.partitions</strong> (默认值是50)，因此 Kafka 会自动创建一个有 50 个分区的__consumer_offsets 。这就是我们在 Kafka 日志路径下看到有很多 __consumer_offsets-xxx 这样的目录的原因。既然有分区数，必然就会有对应的副本数，这个是依赖 Broker 端另一个参数 <strong>offsets.topic.replication.factor</strong>(默认值为3)。总结一下，<strong>如果__consumer_offsets 由 Kafka 自动创建的，那么该 Topic 的分区数是 50，副本数是 3，<strong>而具体 Group 的消费情况要存储到哪个 Partition ，根据</strong>abs(GroupId.hashCode()) % NumPartitions</strong> **来计算的，**这样就可以保证 Consumer Offset 信息与 Consumer Group 对应的 Coordinator 处于同一个 Broker 节点上。</p> <p>查看__consumer_offsets数据</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//1.查看 kafka 消费者组列表：</span>
<span class="token punctuation">.</span>/bin<span class="token operator">/</span>kafka<span class="token operator">-</span>consumer<span class="token operator">-</span>groups<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server <span class="token operator">&lt;</span>kafka<span class="token operator">-</span>ip<span class="token operator">&gt;</span><span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>list

<span class="token comment">//2.查看 kafka 中某一个消费者组(test-group-1)的消费情况：</span>
<span class="token punctuation">.</span>/bin<span class="token operator">/</span>kafka<span class="token operator">-</span>consumer<span class="token operator">-</span>groups<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server <span class="token operator">&lt;</span>kafka<span class="token operator">-</span>ip<span class="token operator">&gt;</span><span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>group test<span class="token operator">-</span>group<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">--</span>describe

<span class="token comment">//3.计算 group.id 对应的 partition 的公式为：</span>
<span class="token function">abs</span><span class="token punctuation">(</span><span class="token class-name">GroupId</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token class-name">NumPartitions</span> <span class="token comment">//其中GroupId:test-group-1 NumPartitions:50</span>

<span class="token comment">//3.找到 group.id 对应的 partition 后，就可以指定分区消费了</span>
<span class="token comment">//kafka 0.11以后</span>
<span class="token punctuation">.</span>/bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>consumer<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server message<span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topic __consumer_offsets <span class="token operator">--</span>formatter <span class="token string">&quot;kafka.coordinator.group.GroupMetadataManager\$OffsetsMessageFormatter&quot;</span> <span class="token operator">--</span>partition xx
<span class="token comment">//kafka 0.11以前</span>
<span class="token punctuation">.</span>/bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>consumer<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server message<span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topic __consumer_offsets <span class="token operator">--</span>formatter <span class="token string">&quot;kafka.coordinator.GroupMetadataManager\$OffsetsMessageFormatter&quot;</span> <span class="token operator">--</span>partition xx

<span class="token comment">//4.获取指定consumer group的位移信息 </span>
<span class="token comment">//kafka 0.11以后</span>
kafka<span class="token operator">-</span>simple<span class="token operator">-</span>consumer<span class="token operator">-</span>shell<span class="token punctuation">.</span>sh <span class="token operator">--</span>topic __consumer_offsets <span class="token operator">--</span>partition xx <span class="token operator">--</span>broker<span class="token operator">-</span>list <span class="token operator">&lt;</span>kafka<span class="token operator">-</span>ip<span class="token operator">&gt;</span><span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>formatter <span class="token string">&quot;kafka.coordinator.group.GroupMetadataManager\$OffsetsMessageFormatter&quot;</span>
<span class="token comment">//kafka 0.11以前</span>
kafka<span class="token operator">-</span>simple<span class="token operator">-</span>consumer<span class="token operator">-</span>shell<span class="token punctuation">.</span>sh <span class="token operator">--</span>topic __consumer_offsets <span class="token operator">--</span>partition xx <span class="token operator">--</span>broker<span class="token operator">-</span>list <span class="token operator">&lt;</span>kafka<span class="token operator">-</span>ip<span class="token operator">&gt;</span><span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>formatter <span class="token string">&quot;kafka.coordinator.GroupMetadataManager\$OffsetsMessageFormatter&quot;</span>

<span class="token comment">//5.脚本执行后输出的元数据信息 </span>
<span class="token comment">//格式：[消费者组 : 消费的topic : 消费的分区] :: [offset位移], [offset提交时间], [元数据过期时间]</span>
<span class="token punctuation">[</span>order<span class="token operator">-</span>group<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>topic<span class="token operator">-</span>order<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token punctuation">[</span><span class="token class-name">OffsetMetadata</span><span class="token punctuation">[</span><span class="token number">36672</span><span class="token punctuation">,</span><span class="token constant">NO_METADATA</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name">CommitTime</span> <span class="token number">1633694193000</span><span class="token punctuation">,</span><span class="token class-name">ExpirationTime</span> <span class="token number">1633866993000</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_11-consumer消费进度监控"><a href="#_11-consumer消费进度监控" class="header-anchor">#</a> 11. consumer消费进度监控</h2> <p>上面聊完 Consumer的各个实现细节，我们来聊聊对于 Consumer 来说，最重要的事情即<strong>消费进度的监控</strong>, 或者说<strong>监控其滞后程度</strong>（Consumer 当前落后于 Producer 的程度），这里有个专业名词叫 <strong>Consumer Lag</strong>。举例说明: Kafka Producer 向某 Topic 成功生产了 1000 万条消息，这时 Consumer 当前消费了 900 万条消息，那么可以认为 Consumer 滞后了 100 万条消息，即 Lag 等于 100 万。</p> <p><strong>对 Consumer 来说，Lag 应该算是最重要的监控指标了</strong>。它直接反映了一个 Consumer 的运行情况。Lag 值越小表示该 Consumer 能够及时的消费 Producer 生产出来的消息，滞后程度很小；如果该值有增大的趋势说明可能会有堆积，严重会拖慢下游的处理速度。</p> <p>对于这么重要的指标，我们该怎么监控它呢？主要有 以下几 种方法：</p> <ol><li>使用 Kafka 自带的命令行工具 kafka-consumer-groups 脚本</li> <li>使用 Kafka Java Consumer API 编程</li> <li>使用 Kafka 自带的 JMX 监控指标</li> <li>如果是云产品的话， 可以直接使用云产品自带的监控功能</li></ol></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/2290653824/myVuePressBlog/edit/master/docs/50.中间件/54.kafka/30.kafka之消费者.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/02/22, 14:03:19</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3334d8/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">kafka之broker</div></a> <a href="/pages/bfb0f6/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">消费者源码</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3334d8/" class="prev">kafka之broker</a></span> <span class="next"><a href="/pages/bfb0f6/">消费者源码</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/e837ca/"><div>
            spark基础
            <!----></div></a> <span class="date">02-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/41416f/"><div>
            mysql读写分离和分库分表
            <!----></div></a> <span class="date">02-22</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/c19608/"><div>
            数据库迁移
            <!----></div></a> <span class="date">02-22</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="2290653824@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/2290653824" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=430175831" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.7d33bb02.js" defer></script><script src="/assets/js/2.15f2967d.js" defer></script><script src="/assets/js/166.0734abd2.js" defer></script>
  </body>
</html>
